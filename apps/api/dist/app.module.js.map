{"version":3,"sources":["../src/app.module.ts"],"sourcesContent":["import { Module } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { ThrottlerModule, ThrottlerGuard } from '@nestjs/throttler';\nimport { BullModule } from '@nestjs/bullmq';\nimport { APP_GUARD, APP_FILTER, APP_INTERCEPTOR } from '@nestjs/core';\nimport { PrismaModule } from '@crypto-erp/database';\nimport configuration from './config/configuration.js';\nimport { GlobalExceptionFilter } from './common/filters/http-exception.filter.js';\nimport { AuthModule } from './modules/auth/auth.module.js';\nimport { UsersModule } from './modules/users/users.module.js';\nimport { CompaniesModule } from './modules/companies/companies.module.js';\nimport { AccountingModule } from './modules/accounting/accounting.module.js';\nimport { InvoicingModule } from './modules/invoicing/invoicing.module.js';\nimport { CryptoModule } from './modules/crypto/crypto.module.js';\nimport { AiModule } from './modules/ai/ai.module.js';\nimport { FiscalModule } from './modules/fiscal/fiscal.module.js';\nimport { AnalyticsModule } from './modules/analytics/analytics.module.js';\nimport { PaymentsModule } from './modules/payments/payments.module.js';\nimport { MonitoringModule } from './modules/monitoring/monitoring.module.js';\nimport { MetricsInterceptor } from './modules/monitoring/metrics.interceptor.js';\nimport { CommonModule } from './common/common.module.js';\nimport { OnboardingModule } from './modules/onboarding/onboarding.module.js';\nimport { CacheModule } from './common/cache/cache.module.js';\nimport { OAuthModule } from './modules/oauth/oauth.module.js';\nimport { IntegrationsModule } from './modules/integrations/integrations.module.js';\nimport { WhiteLabelModule } from './modules/white-label/white-label.module.js';\nimport { PartnersModule } from './modules/partners/partners.module.js';\n\n@Module({\n  imports: [\n    // Configuration\n    ConfigModule.forRoot({\n      isGlobal: true,\n      load: [configuration],\n      envFilePath: ['.env.local', '.env'],\n    }),\n\n    // Rate limiting\n    ThrottlerModule.forRoot([\n      {\n        name: 'short',\n        ttl: 1000,\n        limit: 10,\n      },\n      {\n        name: 'medium',\n        ttl: 10000,\n        limit: 50,\n      },\n      {\n        name: 'long',\n        ttl: 60000,\n        limit: 100,\n      },\n    ]),\n\n    // BullMQ for background job queues\n    BullModule.forRootAsync({\n      imports: [ConfigModule],\n      inject: [ConfigService],\n      useFactory: (config: ConfigService) => ({\n        connection: {\n          host: config.get<string>('REDIS_HOST', 'localhost'),\n          port: config.get<number>('REDIS_PORT', 6379),\n          password: config.get<string>('REDIS_PASSWORD', undefined),\n          db: config.get<number>('REDIS_DB', 0),\n        },\n        defaultJobOptions: {\n          removeOnComplete: 100,\n          removeOnFail: 500,\n          attempts: 3,\n          backoff: {\n            type: 'exponential',\n            delay: 2000,\n          },\n        },\n      }),\n    }),\n    BullModule.registerQueue(\n      { name: 'blockchain-sync' },\n      { name: 'price-update' },\n      { name: 'verifactu-send' },\n      { name: 'journal-entry' },\n    ),\n\n    // Database\n    PrismaModule,\n\n    // Cache\n    CacheModule,\n\n    // Common (health checks, etc.)\n    CommonModule,\n\n    // Feature modules\n    AuthModule,\n    UsersModule,\n    CompaniesModule,\n    AccountingModule,\n    InvoicingModule,\n    CryptoModule,\n    AiModule,\n    FiscalModule,\n    AnalyticsModule,\n    PaymentsModule,\n    MonitoringModule,\n    OnboardingModule,\n    OAuthModule,\n    IntegrationsModule,\n    WhiteLabelModule,\n    PartnersModule,\n  ],\n  providers: [\n    // Global exception filter\n    {\n      provide: APP_FILTER,\n      useClass: GlobalExceptionFilter,\n    },\n    // Global rate limiting guard\n    {\n      provide: APP_GUARD,\n      useClass: ThrottlerGuard,\n    },\n    // Global metrics interceptor\n    {\n      provide: APP_INTERCEPTOR,\n      useClass: MetricsInterceptor,\n    },\n  ],\n})\nexport class AppModule {}"],"names":["AppModule","imports","ConfigModule","forRoot","isGlobal","load","configuration","envFilePath","ThrottlerModule","name","ttl","limit","BullModule","forRootAsync","inject","ConfigService","useFactory","config","connection","host","get","port","password","undefined","db","defaultJobOptions","removeOnComplete","removeOnFail","attempts","backoff","type","delay","registerQueue","PrismaModule","CacheModule","CommonModule","AuthModule","UsersModule","CompaniesModule","AccountingModule","InvoicingModule","CryptoModule","AiModule","FiscalModule","AnalyticsModule","PaymentsModule","MonitoringModule","OnboardingModule","OAuthModule","IntegrationsModule","WhiteLabelModule","PartnersModule","providers","provide","APP_FILTER","useClass","GlobalExceptionFilter","APP_GUARD","ThrottlerGuard","APP_INTERCEPTOR","MetricsInterceptor"],"mappings":";;;;+BAkIaA;;;eAAAA;;;wBAlIU;wBACqB;2BACI;wBACrB;sBAC4B;0BAC1B;sEACH;qCACY;4BACX;6BACC;iCACI;kCACC;iCACD;8BACH;0BACJ;8BACI;iCACG;gCACD;kCACE;oCACE;8BACN;kCACI;6BACL;6BACA;oCACO;kCACF;gCACF;;;;;;;;;;;;AAwGxB,IAAA,AAAMA,YAAN,MAAMA;AAAW;;;QArGtBC,SAAS;YACP,gBAAgB;YAChBC,oBAAY,CAACC,OAAO,CAAC;gBACnBC,UAAU;gBACVC,MAAM;oBAACC,sBAAa;iBAAC;gBACrBC,aAAa;oBAAC;oBAAc;iBAAO;YACrC;YAEA,gBAAgB;YAChBC,0BAAe,CAACL,OAAO,CAAC;gBACtB;oBACEM,MAAM;oBACNC,KAAK;oBACLC,OAAO;gBACT;gBACA;oBACEF,MAAM;oBACNC,KAAK;oBACLC,OAAO;gBACT;gBACA;oBACEF,MAAM;oBACNC,KAAK;oBACLC,OAAO;gBACT;aACD;YAED,mCAAmC;YACnCC,kBAAU,CAACC,YAAY,CAAC;gBACtBZ,SAAS;oBAACC,oBAAY;iBAAC;gBACvBY,QAAQ;oBAACC,qBAAa;iBAAC;gBACvBC,YAAY,CAACC,SAA2B,CAAA;wBACtCC,YAAY;4BACVC,MAAMF,OAAOG,GAAG,CAAS,cAAc;4BACvCC,MAAMJ,OAAOG,GAAG,CAAS,cAAc;4BACvCE,UAAUL,OAAOG,GAAG,CAAS,kBAAkBG;4BAC/CC,IAAIP,OAAOG,GAAG,CAAS,YAAY;wBACrC;wBACAK,mBAAmB;4BACjBC,kBAAkB;4BAClBC,cAAc;4BACdC,UAAU;4BACVC,SAAS;gCACPC,MAAM;gCACNC,OAAO;4BACT;wBACF;oBACF,CAAA;YACF;YACAnB,kBAAU,CAACoB,aAAa,CACtB;gBAAEvB,MAAM;YAAkB,GAC1B;gBAAEA,MAAM;YAAe,GACvB;gBAAEA,MAAM;YAAiB,GACzB;gBAAEA,MAAM;YAAgB;YAG1B,WAAW;YACXwB,sBAAY;YAEZ,QAAQ;YACRC,wBAAW;YAEX,+BAA+B;YAC/BC,0BAAY;YAEZ,kBAAkB;YAClBC,sBAAU;YACVC,wBAAW;YACXC,gCAAe;YACfC,kCAAgB;YAChBC,gCAAe;YACfC,0BAAY;YACZC,kBAAQ;YACRC,0BAAY;YACZC,gCAAe;YACfC,8BAAc;YACdC,kCAAgB;YAChBC,kCAAgB;YAChBC,wBAAW;YACXC,sCAAkB;YAClBC,kCAAgB;YAChBC,8BAAc;SACf;QACDC,WAAW;YACT,0BAA0B;YAC1B;gBACEC,SAASC,gBAAU;gBACnBC,UAAUC,0CAAqB;YACjC;YACA,6BAA6B;YAC7B;gBACEH,SAASI,eAAS;gBAClBF,UAAUG,yBAAc;YAC1B;YACA,6BAA6B;YAC7B;gBACEL,SAASM,qBAAe;gBACxBJ,UAAUK,sCAAkB;YAC9B;SACD"}