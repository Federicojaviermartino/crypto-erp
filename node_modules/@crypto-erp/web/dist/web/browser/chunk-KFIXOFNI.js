import{c as J}from"./chunk-R5763NNK.js";import{a as P,b as E,c as j,d as I,f as O,g as G,h as V,i as L,j as $,k as R,l as q,m as H,n as z,p as K,q as Q,s as U}from"./chunk-OE3B74VB.js";import{a as W}from"./chunk-JU2KEDBD.js";import"./chunk-FXBJWTCM.js";import{Da as v,Fa as s,Fb as w,Gb as B,Ha as N,Ja as h,La as D,Ma as x,Na as C,Oa as t,Pa as e,Qa as d,Ra as T,Sa as c,Ta as p,U as S,Za as i,_a as f,aa as F,ab as k,ba as A,fb as M,hb as _,jb as y,ra as l,sa as b,xa as g}from"./chunk-2V2B4KT2.js";import"./chunk-35PI25VP.js";var X=(o,m)=>m.id;function Y(o,m){if(o&1&&(t(0,"option",31),i(1),e()),o&2){let n=m.$implicit;s("value",n.code),l(),k("",n.code," - ",n.name,"")}}function Z(o,m){if(o&1){let n=T();t(0,"button",36),c("click",function(){F(n);let r=p().$index,u=p();return A(u.removeLine(r))}),i(1,"\xD7"),e()}}function ee(o,m){if(o&1&&(t(0,"tr",19)(1,"td")(2,"select",29)(3,"option",30),i(4,"Seleccionar cuenta"),e(),x(5,Y,2,3,"option",31,X),e()(),t(7,"td"),d(8,"input",32),e(),t(9,"td"),d(10,"input",33),e(),t(11,"td"),d(12,"input",34),e(),t(13,"td"),v(14,Z,2,0,"button",35),e()()),o&2){let n=m.$index,a=p();s("formGroupName",n),l(5),C(a.accounts()),l(9),h(14,a.linesArray.length>2?14:-1)}}function te(o,m){o&1&&i(0," \u2713 Cuadrado ")}function ne(o,m){o&1&&i(0," \u26A0 Descuadrado ")}function ie(o,m){if(o&1&&(t(0,"div",23),i(1),e()),o&2){let n=p();l(),f(n.error())}}var pe=(()=>{class o{fb;api;router;form;accounts=g([]);saving=g(!1);error=g(null);postAfterSave=!1;constructor(n,a,r){this.fb=n,this.api=a,this.router=r,this.form=this.fb.group({date:[new Date().toISOString().split("T")[0],E.required],description:[""],reference:[""],lines:this.fb.array([])}),this.addLine(),this.addLine()}ngOnInit(){this.loadAccounts()}get linesArray(){return this.form.get("lines")}loadAccounts(){this.api.get("/accounts",{isActive:!0}).subscribe({next:n=>this.accounts.set(n)})}addLine(){this.linesArray.push(this.fb.group({accountCode:["",E.required],description:[""],debit:[0],credit:[0]}))}removeLine(n){this.linesArray.removeAt(n)}totalDebit(){return this.linesArray.controls.reduce((n,a)=>n+(a.get("debit")?.value||0),0)}totalCredit(){return this.linesArray.controls.reduce((n,a)=>n+(a.get("credit")?.value||0),0)}difference(){return Math.abs(this.totalDebit()-this.totalCredit())}isBalanced(){return this.difference()<.01&&this.totalDebit()>0}cancel(){this.router.navigate(["/accounting/journal-entries"])}saveAndPost(){this.postAfterSave=!0,this.onSubmit()}onSubmit(){if(!this.isBalanced()){this.error.set("El asiento debe estar cuadrado");return}this.saving.set(!0),this.error.set(null),this.api.post("/journal-entries",this.form.value).subscribe({next:n=>{this.postAfterSave?this.api.patch(`/journal-entries/${n.id}/post`,{}).subscribe({next:()=>this.router.navigate(["/accounting/journal-entries"]),error:a=>{this.saving.set(!1),this.error.set(a.error?.message||"Error al publicar")}}):this.router.navigate(["/accounting/journal-entries"])},error:n=>{this.saving.set(!1),this.postAfterSave=!1,this.error.set(n.error?.message||"Error al guardar")}})}static \u0275fac=function(a){return new(a||o)(b(Q),b(W),b(J))};static \u0275cmp=S({type:o,selectors:[["app-journal-entry-form"]],standalone:!0,features:[M],decls:75,vars:21,consts:[[1,"page"],[1,"page-header"],[3,"ngSubmit","formGroup"],[1,"card","mb-lg"],[1,"card-body"],[1,"form-row"],[1,"form-group"],[1,"form-label"],["type","date","formControlName","date",1,"form-input"],[1,"form-group",2,"flex","2"],["type","text","formControlName","description","placeholder","Descripci\xF3n del asiento",1,"form-input"],["type","text","formControlName","reference","placeholder","Ref. documento",1,"form-input"],[1,"card-header","d-flex","justify-between","align-center"],["type","button",1,"btn","btn-sm","btn-secondary",3,"click"],[1,"card-body",2,"padding","0"],[1,"table"],[2,"width","150px"],[2,"width","50px"],["formArrayName","lines"],[3,"formGroupName"],["colspan","2",1,"text-right"],[1,"text-right"],["colspan","2",1,"text-center"],[1,"alert","alert-danger","mb-lg"],[1,"d-flex","gap-md","justify-between"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","gap-md"],["type","submit",1,"btn","btn-secondary",3,"disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],["formControlName","accountCode",1,"form-select"],["value",""],[3,"value"],["type","text","formControlName","description","placeholder","Descripci\xF3n",1,"form-input"],["type","number","formControlName","debit","step","0.01","min","0",1,"form-input","text-right"],["type","number","formControlName","credit","step","0.01","min","0",1,"form-input","text-right"],["type","button",1,"btn","btn-sm","btn-danger"],["type","button",1,"btn","btn-sm","btn-danger",3,"click"]],template:function(a,r){a&1&&(t(0,"div",0)(1,"header",1)(2,"h1"),i(3,"Nuevo Asiento Contable"),e()(),t(4,"form",2),c("ngSubmit",function(){return r.onSubmit()}),t(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),i(10,"Fecha"),e(),d(11,"input",8),e(),t(12,"div",9)(13,"label",7),i(14,"Descripci\xF3n"),e(),d(15,"input",10),e(),t(16,"div",6)(17,"label",7),i(18,"Referencia"),e(),d(19,"input",11),e()()()(),t(20,"div",3)(21,"div",12)(22,"h3"),i(23,"L\xEDneas del Asiento"),e(),t(24,"button",13),c("click",function(){return r.addLine()}),i(25," + A\xF1adir L\xEDnea "),e()(),t(26,"div",14)(27,"table",15)(28,"thead")(29,"tr")(30,"th"),i(31,"Cuenta"),e(),t(32,"th"),i(33,"Descripci\xF3n"),e(),t(34,"th",16),i(35,"Debe"),e(),t(36,"th",16),i(37,"Haber"),e(),d(38,"th",17),e()(),t(39,"tbody",18),x(40,ee,15,2,"tr",19,D),e(),t(42,"tfoot")(43,"tr")(44,"td",20)(45,"strong"),i(46,"Totales:"),e()(),t(47,"td",21)(48,"strong"),i(49),_(50,"number"),e()(),t(51,"td",21)(52,"strong"),i(53),_(54,"number"),e()(),d(55,"td"),e(),t(56,"tr")(57,"td",20),i(58,"Diferencia:"),e(),t(59,"td",22)(60,"strong"),i(61),_(62,"number"),e(),v(63,te,1,0)(64,ne,1,0),e(),d(65,"td"),e()()()()(),v(66,ie,2,1,"div",23),t(67,"div",24)(68,"button",25),c("click",function(){return r.cancel()}),i(69,"Cancelar"),e(),t(70,"div",26)(71,"button",27),i(72," Guardar Borrador "),e(),t(73,"button",28),c("click",function(){return r.saveAndPost()}),i(74," Guardar y Publicar "),e()()()()()),a&2&&(l(4),s("formGroup",r.form),l(36),C(r.linesArray.controls),l(9),f(y(50,12,r.totalDebit(),"1.2-2")),l(4),f(y(54,15,r.totalCredit(),"1.2-2")),l(6),N("text-danger",!r.isBalanced())("text-success",r.isBalanced()),l(2),f(y(62,18,r.difference(),"1.2-2")),l(2),h(63,r.isBalanced()?63:64),l(3),h(66,r.error()?66:-1),l(5),s("disabled",r.saving()||!r.isBalanced()),l(2),s("disabled",r.saving()||!r.isBalanced()))},dependencies:[B,w,U,O,H,z,P,G,q,j,I,K,V,R,L,$],styles:[".page[_ngcontent-%COMP%]{padding:var(--spacing-xl);max-width:1200px}.page-header[_ngcontent-%COMP%]{margin-bottom:var(--spacing-lg)}.form-row[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.alert[_ngcontent-%COMP%]{padding:var(--spacing-md);border-radius:var(--radius-md)}.alert-danger[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b;border:1px solid #fecaca}"]})}return o})();export{pe as JournalEntryFormComponent};
