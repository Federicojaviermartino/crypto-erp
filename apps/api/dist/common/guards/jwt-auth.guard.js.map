{"version":3,"sources":["../../../src/common/guards/jwt-auth.guard.ts"],"sourcesContent":["import {\n  Injectable,\n  ExecutionContext,\n  UnauthorizedException,\n} from '@nestjs/common';\nimport { AuthGuard } from '@nestjs/passport';\nimport { Reflector } from '@nestjs/core';\nimport { IS_PUBLIC_KEY } from '../decorators/public.decorator.js';\n\n/**\n * JWT authentication guard.\n * Validates access token and attaches user to request.\n * Respects @Public() decorator for open endpoints.\n */\n@Injectable()\nexport class JwtAuthGuard extends AuthGuard('jwt') {\n  constructor(private reflector: Reflector) {\n    super();\n  }\n\n  canActivate(context: ExecutionContext) {\n    const isPublic = this.reflector.getAllAndOverride<boolean>(IS_PUBLIC_KEY, [\n      context.getHandler(),\n      context.getClass(),\n    ]);\n\n    if (isPublic) {\n      return true;\n    }\n\n    return super.canActivate(context);\n  }\n\n  handleRequest<TUser>(\n    err: Error | null,\n    user: TUser | false,\n    info: Error | undefined,\n  ): TUser {\n    if (err || !user) {\n      if (info?.name === 'TokenExpiredError') {\n        throw new UnauthorizedException('Access token has expired');\n      }\n      if (info?.name === 'JsonWebTokenError') {\n        throw new UnauthorizedException('Invalid access token');\n      }\n      throw new UnauthorizedException('Authentication required');\n    }\n    return user;\n  }\n}"],"names":["JwtAuthGuard","AuthGuard","canActivate","context","isPublic","reflector","getAllAndOverride","IS_PUBLIC_KEY","getHandler","getClass","handleRequest","err","user","info","name","UnauthorizedException"],"mappings":";;;;+BAeaA;;;eAAAA;;;wBAXN;0BACmB;sBACA;iCACI;;;;;;;;;;AAQvB,IAAA,AAAMA,eAAN,MAAMA,qBAAqBC,IAAAA,mBAAS,EAAC;IAK1CC,YAAYC,OAAyB,EAAE;QACrC,MAAMC,WAAW,IAAI,CAACC,SAAS,CAACC,iBAAiB,CAAUC,8BAAa,EAAE;YACxEJ,QAAQK,UAAU;YAClBL,QAAQM,QAAQ;SACjB;QAED,IAAIL,UAAU;YACZ,OAAO;QACT;QAEA,OAAO,KAAK,CAACF,YAAYC;IAC3B;IAEAO,cACEC,GAAiB,EACjBC,IAAmB,EACnBC,IAAuB,EAChB;QACP,IAAIF,OAAO,CAACC,MAAM;YAChB,IAAIC,MAAMC,SAAS,qBAAqB;gBACtC,MAAM,IAAIC,6BAAqB,CAAC;YAClC;YACA,IAAIF,MAAMC,SAAS,qBAAqB;gBACtC,MAAM,IAAIC,6BAAqB,CAAC;YAClC;YACA,MAAM,IAAIA,6BAAqB,CAAC;QAClC;QACA,OAAOH;IACT;IAhCA,YAAY,AAAQP,SAAoB,CAAE;QACxC,KAAK,SADaA,YAAAA;IAEpB;AA+BF"}