{"version":3,"sources":["../../../src/modules/oauth/scopes.ts"],"sourcesContent":["/**\n * OAuth 2.0 Scopes Definition\n * Defines all available scopes for third-party API access\n *\n * Scope naming convention: <resource>:<action>\n * - resource: invoices, contacts, crypto, accounting, analytics, etc.\n * - action: read, write, delete\n *\n * Usage in OAuth apps:\n * - Apps request scopes during authorization\n * - Users grant permissions to apps\n * - API endpoints require specific scopes via @RequireScopes() decorator\n */\n\nexport const OAUTH_SCOPES = {\n  // Invoice scopes\n  INVOICES_READ: 'invoices:read',\n  INVOICES_WRITE: 'invoices:write',\n  INVOICES_DELETE: 'invoices:delete',\n\n  // Contact scopes\n  CONTACTS_READ: 'contacts:read',\n  CONTACTS_WRITE: 'contacts:write',\n  CONTACTS_DELETE: 'contacts:delete',\n\n  // Crypto scopes\n  CRYPTO_READ: 'crypto:read',\n  CRYPTO_WRITE: 'crypto:write',\n\n  // Accounting scopes\n  ACCOUNTING_READ: 'accounting:read',\n  ACCOUNTING_WRITE: 'accounting:write',\n\n  // Analytics scopes\n  ANALYTICS_READ: 'analytics:read',\n\n  // Company scopes\n  COMPANY_READ: 'company:read',\n  COMPANY_WRITE: 'company:write',\n\n  // User scopes\n  USERS_READ: 'users:read',\n  USERS_WRITE: 'users:write',\n\n  // Webhooks scopes\n  WEBHOOKS_READ: 'webhooks:read',\n  WEBHOOKS_WRITE: 'webhooks:write',\n\n  // Full access (dangerous - requires explicit user consent)\n  FULL_ACCESS: '*',\n} as const;\n\nexport type OAuthScope = typeof OAUTH_SCOPES[keyof typeof OAUTH_SCOPES];\n\n/**\n * Scope descriptions for display to users during authorization\n */\nexport const SCOPE_DESCRIPTIONS: Record<string, string> = {\n  [OAUTH_SCOPES.INVOICES_READ]: 'Read invoices and their details',\n  [OAUTH_SCOPES.INVOICES_WRITE]: 'Create and update invoices',\n  [OAUTH_SCOPES.INVOICES_DELETE]: 'Delete invoices',\n\n  [OAUTH_SCOPES.CONTACTS_READ]: 'Read customer and supplier contacts',\n  [OAUTH_SCOPES.CONTACTS_WRITE]: 'Create and update contacts',\n  [OAUTH_SCOPES.CONTACTS_DELETE]: 'Delete contacts',\n\n  [OAUTH_SCOPES.CRYPTO_READ]: 'Read cryptocurrency wallets and transactions',\n  [OAUTH_SCOPES.CRYPTO_WRITE]: 'Create and update crypto transactions',\n\n  [OAUTH_SCOPES.ACCOUNTING_READ]: 'Read accounting data (journal entries, accounts)',\n  [OAUTH_SCOPES.ACCOUNTING_WRITE]: 'Create and update journal entries',\n\n  [OAUTH_SCOPES.ANALYTICS_READ]: 'Read analytics and reports',\n\n  [OAUTH_SCOPES.COMPANY_READ]: 'Read company information and settings',\n  [OAUTH_SCOPES.COMPANY_WRITE]: 'Update company information and settings',\n\n  [OAUTH_SCOPES.USERS_READ]: 'Read user information',\n  [OAUTH_SCOPES.USERS_WRITE]: 'Manage users and permissions',\n\n  [OAUTH_SCOPES.WEBHOOKS_READ]: 'Read webhook subscriptions',\n  [OAUTH_SCOPES.WEBHOOKS_WRITE]: 'Create and manage webhook subscriptions',\n\n  [OAUTH_SCOPES.FULL_ACCESS]: 'Full access to all resources (requires explicit consent)',\n};\n\n/**\n * Scope groups for common use cases\n */\nexport const SCOPE_GROUPS = {\n  INVOICING: [\n    OAUTH_SCOPES.INVOICES_READ,\n    OAUTH_SCOPES.INVOICES_WRITE,\n    OAUTH_SCOPES.CONTACTS_READ,\n  ],\n  ACCOUNTING: [\n    OAUTH_SCOPES.ACCOUNTING_READ,\n    OAUTH_SCOPES.ACCOUNTING_WRITE,\n    OAUTH_SCOPES.INVOICES_READ,\n  ],\n  CRYPTO_PORTFOLIO: [\n    OAUTH_SCOPES.CRYPTO_READ,\n    OAUTH_SCOPES.CRYPTO_WRITE,\n  ],\n  REPORTING: [\n    OAUTH_SCOPES.ANALYTICS_READ,\n    OAUTH_SCOPES.INVOICES_READ,\n    OAUTH_SCOPES.ACCOUNTING_READ,\n  ],\n  READ_ONLY: [\n    OAUTH_SCOPES.INVOICES_READ,\n    OAUTH_SCOPES.CONTACTS_READ,\n    OAUTH_SCOPES.CRYPTO_READ,\n    OAUTH_SCOPES.ACCOUNTING_READ,\n    OAUTH_SCOPES.ANALYTICS_READ,\n    OAUTH_SCOPES.COMPANY_READ,\n  ],\n};\n\n/**\n * Helper to check if a scope grants access to a resource and action\n */\nexport function checkScope(\n  grantedScopes: string[],\n  requiredScope: string,\n): boolean {\n  // Check for full access wildcard\n  if (grantedScopes.includes(OAUTH_SCOPES.FULL_ACCESS)) {\n    return true;\n  }\n\n  // Check for exact match\n  if (grantedScopes.includes(requiredScope)) {\n    return true;\n  }\n\n  // Check for wildcard within resource (e.g., \"invoices:*\")\n  const [resource] = requiredScope.split(':');\n  if (grantedScopes.includes(`${resource}:*`)) {\n    return true;\n  }\n\n  return false;\n}\n\n/**\n * Helper to validate scope format\n */\nexport function isValidScope(scope: string): boolean {\n  if (scope === OAUTH_SCOPES.FULL_ACCESS) {\n    return true;\n  }\n\n  const parts = scope.split(':');\n  if (parts.length !== 2) {\n    return false;\n  }\n\n  const [resource, action] = parts;\n  const validActions = ['read', 'write', 'delete', '*'];\n\n  return resource.length > 0 && validActions.includes(action);\n}\n\n/**\n * Get all valid scopes\n */\nexport function getAllScopes(): string[] {\n  return Object.values(OAUTH_SCOPES);\n}\n"],"names":["OAUTH_SCOPES","SCOPE_DESCRIPTIONS","SCOPE_GROUPS","checkScope","getAllScopes","isValidScope","INVOICES_READ","INVOICES_WRITE","INVOICES_DELETE","CONTACTS_READ","CONTACTS_WRITE","CONTACTS_DELETE","CRYPTO_READ","CRYPTO_WRITE","ACCOUNTING_READ","ACCOUNTING_WRITE","ANALYTICS_READ","COMPANY_READ","COMPANY_WRITE","USERS_READ","USERS_WRITE","WEBHOOKS_READ","WEBHOOKS_WRITE","FULL_ACCESS","INVOICING","ACCOUNTING","CRYPTO_PORTFOLIO","REPORTING","READ_ONLY","grantedScopes","requiredScope","includes","resource","split","scope","parts","length","action","validActions","Object","values"],"mappings":"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"}