{"version":3,"sources":["../../../src/modules/analytics/analytics.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Query,\n  Headers,\n  BadRequestException,\n} from '@nestjs/common';\nimport { AnalyticsService } from './analytics.service.js';\n\n@Controller('analytics')\nexport class AnalyticsController {\n  constructor(private readonly analyticsService: AnalyticsService) {}\n\n  private getCompanyId(headers: Record<string, string>): string {\n    const companyId = headers['x-company-id'];\n    if (!companyId) {\n      throw new BadRequestException('X-Company-Id header is required');\n    }\n    return companyId;\n  }\n\n  @Get('dashboard')\n  async getDashboardMetrics(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    return this.analyticsService.getDashboardMetrics(companyId);\n  }\n\n  @Get('portfolio')\n  async getPortfolioOverview(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    return this.analyticsService.getPortfolioOverview(companyId);\n  }\n\n  @Get('transactions/stats')\n  async getTransactionStats(\n    @Headers() headers: Record<string, string>,\n    @Query('startDate') startDateStr?: string,\n    @Query('endDate') endDateStr?: string,\n  ) {\n    const companyId = this.getCompanyId(headers);\n    const startDate = startDateStr ? new Date(startDateStr) : undefined;\n    const endDate = endDateStr ? new Date(endDateStr) : undefined;\n\n    return this.analyticsService.getTransactionStats(companyId, startDate, endDate);\n  }\n\n  @Get('charts/monthly')\n  async getMonthlyData(\n    @Headers() headers: Record<string, string>,\n    @Query('months') monthsStr?: string,\n  ) {\n    const companyId = this.getCompanyId(headers);\n    const months = monthsStr ? parseInt(monthsStr, 10) : 12;\n\n    if (isNaN(months) || months < 1 || months > 24) {\n      throw new BadRequestException('Months must be between 1 and 24');\n    }\n\n    return this.analyticsService.getMonthlyData(companyId, months);\n  }\n\n  // ============================================================================\n  // PHASE 4 - ADVANCED ANALYTICS ENDPOINTS\n  // ============================================================================\n\n  /**\n   * Get revenue analytics (MRR, ARR, total revenue, growth)\n   * GET /analytics/revenue?startDate=2025-01-01&endDate=2025-12-31\n   */\n  @Get('revenue')\n  async getRevenueMetrics(\n    @Headers() headers: Record<string, string>,\n    @Query('startDate') startDateStr?: string,\n    @Query('endDate') endDateStr?: string,\n  ) {\n    const companyId = this.getCompanyId(headers);\n\n    // Default to current month if not provided\n    const now = new Date();\n    const startDate = startDateStr\n      ? new Date(startDateStr)\n      : new Date(now.getFullYear(), now.getMonth(), 1);\n    const endDate = endDateStr\n      ? new Date(endDateStr)\n      : now;\n\n    return this.analyticsService.getRevenueMetrics(companyId, startDate, endDate);\n  }\n\n  /**\n   * Get user behavior analytics (active users, churn rate)\n   * GET /analytics/users?startDate=2025-01-01&endDate=2025-12-31\n   */\n  @Get('users')\n  async getUserMetrics(\n    @Headers() headers: Record<string, string>,\n    @Query('startDate') startDateStr?: string,\n    @Query('endDate') endDateStr?: string,\n  ) {\n    const companyId = this.getCompanyId(headers);\n\n    const now = new Date();\n    const startDate = startDateStr\n      ? new Date(startDateStr)\n      : new Date(now.getFullYear(), now.getMonth(), 1);\n    const endDate = endDateStr\n      ? new Date(endDateStr)\n      : now;\n\n    return this.analyticsService.getUserMetrics(companyId, startDate, endDate);\n  }\n}\n"],"names":["AnalyticsController","getCompanyId","headers","companyId","BadRequestException","getDashboardMetrics","analyticsService","getPortfolioOverview","getTransactionStats","startDateStr","endDateStr","startDate","Date","undefined","endDate","getMonthlyData","monthsStr","months","parseInt","isNaN","getRevenueMetrics","now","getFullYear","getMonth","getUserMetrics"],"mappings":";;;;+BAUaA;;;eAAAA;;;wBAJN;kCAC0B;;;;;;;;;;;;;;;AAG1B,IAAA,AAAMA,sBAAN,MAAMA;IAGHC,aAAaC,OAA+B,EAAU;QAC5D,MAAMC,YAAYD,OAAO,CAAC,eAAe;QACzC,IAAI,CAACC,WAAW;YACd,MAAM,IAAIC,2BAAmB,CAAC;QAChC;QACA,OAAOD;IACT;IAEA,MACME,oBAAoB,AAAWH,OAA+B,EAAE;QACpE,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,OAAO,IAAI,CAACI,gBAAgB,CAACD,mBAAmB,CAACF;IACnD;IAEA,MACMI,qBAAqB,AAAWL,OAA+B,EAAE;QACrE,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,OAAO,IAAI,CAACI,gBAAgB,CAACC,oBAAoB,CAACJ;IACpD;IAEA,MACMK,oBACJ,AAAWN,OAA+B,EAC1C,AAAoBO,YAAqB,EACzC,AAAkBC,UAAmB,EACrC;QACA,MAAMP,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,MAAMS,YAAYF,eAAe,IAAIG,KAAKH,gBAAgBI;QAC1D,MAAMC,UAAUJ,aAAa,IAAIE,KAAKF,cAAcG;QAEpD,OAAO,IAAI,CAACP,gBAAgB,CAACE,mBAAmB,CAACL,WAAWQ,WAAWG;IACzE;IAEA,MACMC,eACJ,AAAWb,OAA+B,EAC1C,AAAiBc,SAAkB,EACnC;QACA,MAAMb,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,MAAMe,SAASD,YAAYE,SAASF,WAAW,MAAM;QAErD,IAAIG,MAAMF,WAAWA,SAAS,KAAKA,SAAS,IAAI;YAC9C,MAAM,IAAIb,2BAAmB,CAAC;QAChC;QAEA,OAAO,IAAI,CAACE,gBAAgB,CAACS,cAAc,CAACZ,WAAWc;IACzD;IAEA,+EAA+E;IAC/E,yCAAyC;IACzC,+EAA+E;IAE/E;;;GAGC,GACD,MACMG,kBACJ,AAAWlB,OAA+B,EAC1C,AAAoBO,YAAqB,EACzC,AAAkBC,UAAmB,EACrC;QACA,MAAMP,YAAY,IAAI,CAACF,YAAY,CAACC;QAEpC,2CAA2C;QAC3C,MAAMmB,MAAM,IAAIT;QAChB,MAAMD,YAAYF,eACd,IAAIG,KAAKH,gBACT,IAAIG,KAAKS,IAAIC,WAAW,IAAID,IAAIE,QAAQ,IAAI;QAChD,MAAMT,UAAUJ,aACZ,IAAIE,KAAKF,cACTW;QAEJ,OAAO,IAAI,CAACf,gBAAgB,CAACc,iBAAiB,CAACjB,WAAWQ,WAAWG;IACvE;IAEA;;;GAGC,GACD,MACMU,eACJ,AAAWtB,OAA+B,EAC1C,AAAoBO,YAAqB,EACzC,AAAkBC,UAAmB,EACrC;QACA,MAAMP,YAAY,IAAI,CAACF,YAAY,CAACC;QAEpC,MAAMmB,MAAM,IAAIT;QAChB,MAAMD,YAAYF,eACd,IAAIG,KAAKH,gBACT,IAAIG,KAAKS,IAAIC,WAAW,IAAID,IAAIE,QAAQ,IAAI;QAChD,MAAMT,UAAUJ,aACZ,IAAIE,KAAKF,cACTW;QAEJ,OAAO,IAAI,CAACf,gBAAgB,CAACkB,cAAc,CAACrB,WAAWQ,WAAWG;IACpE;IAnGA,YAAY,AAAiBR,gBAAkC,CAAE;aAApCA,mBAAAA;IAAqC;AAoGpE"}