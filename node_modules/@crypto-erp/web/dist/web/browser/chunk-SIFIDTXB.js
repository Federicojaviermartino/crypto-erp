import{c as F}from"./chunk-R5763NNK.js";import{a as A,b as c,c as M,d as I,f as V,g as O,h as P,k as R,l as w,m as D,n as k,p as G,q as U,s as j}from"./chunk-OE3B74VB.js";import{a as q}from"./chunk-JU2KEDBD.js";import"./chunk-FXBJWTCM.js";import{Da as v,Fa as f,Gb as N,Ja as g,Ma as x,Na as C,Oa as t,Pa as e,Qa as o,Sa as b,Ta as E,U as h,Za as n,_a as _,ab as y,fb as T,ra as m,sa as p,xa as u}from"./chunk-2V2B4KT2.js";import{a as S}from"./chunk-35PI25VP.js";var B=(a,s)=>s.id;function H(a,s){if(a&1&&(t(0,"option",19),n(1),e()),a&2){let i=s.$implicit;f("value",i.id),m(),y("",i.symbol," - ",i.name,"")}}function W(a,s){if(a&1&&(t(0,"div",28),n(1),e()),a&2){let i=E();m(),_(i.error())}}function L(a,s){a&1&&(o(0,"span",32),n(1," Guardando... "))}function Y(a,s){a&1&&n(0," Guardar Transacci\xF3n ")}var te=(()=>{class a{fb;api;router;form;assets=u([]);saving=u(!1);error=u(null);constructor(i,r,l){this.fb=i,this.api=r,this.router=l;let d=new Date;d.setMinutes(d.getMinutes()-d.getTimezoneOffset()),this.form=this.fb.group({type:["BUY",c.required],assetId:["",c.required],date:[d.toISOString().slice(0,16),c.required],amount:[null,[c.required,c.min(0)]],pricePerUnit:[null],fiatValue:[null],exchange:[""],txHash:[""],fee:[null],notes:[""]}),this.form.get("amount")?.valueChanges.subscribe(()=>this.calculateFiatValue()),this.form.get("pricePerUnit")?.valueChanges.subscribe(()=>this.calculateFiatValue())}ngOnInit(){this.loadAssets()}loadAssets(){this.api.get("/crypto/assets").subscribe({next:i=>this.assets.set(i)})}calculateFiatValue(){let i=this.form.get("amount")?.value,r=this.form.get("pricePerUnit")?.value;i&&r&&this.form.patchValue({fiatValue:i*r},{emitEvent:!1})}cancel(){this.router.navigate(["/crypto/transactions"])}onSubmit(){if(this.form.invalid){this.form.markAllAsTouched();return}this.saving.set(!0),this.error.set(null);let i=S({},this.form.value);i.date=new Date(i.date).toISOString(),this.api.post("/crypto/transactions",i).subscribe({next:()=>{this.router.navigate(["/crypto/transactions"])},error:r=>{this.saving.set(!1),this.error.set(r.error?.message||"Error al guardar")}})}static \u0275fac=function(r){return new(r||a)(p(U),p(q),p(F))};static \u0275cmp=h({type:a,selectors:[["app-transaction-form"]],standalone:!0,features:[T],decls:77,vars:4,consts:[[1,"page"],[1,"page-header"],[3,"ngSubmit","formGroup"],[1,"card","mb-lg"],[1,"card-body"],[1,"form-row"],[1,"form-group"],[1,"form-label"],["formControlName","type",1,"form-select"],["value","BUY"],["value","SELL"],["value","SWAP"],["value","TRANSFER_IN"],["value","TRANSFER_OUT"],["value","STAKING_REWARD"],["value","AIRDROP"],["value","MINING"],["formControlName","assetId",1,"form-select"],["value",""],[3,"value"],["type","datetime-local","formControlName","date",1,"form-input"],["type","number","formControlName","amount","step","0.00000001","min","0","placeholder","0.00000000",1,"form-input"],["type","number","formControlName","pricePerUnit","step","0.01","min","0","placeholder","0.00",1,"form-input"],["type","number","formControlName","fiatValue","step","0.01","min","0","placeholder","Calculado autom\xE1ticamente",1,"form-input"],["type","text","formControlName","exchange","placeholder","Ej: Binance, Coinbase, MetaMask",1,"form-input"],["type","text","formControlName","txHash","placeholder","0x...",1,"form-input"],["type","number","formControlName","fee","step","0.00000001","min","0","placeholder","0.00000000",1,"form-input"],["formControlName","notes","rows","2","placeholder","Notas adicionales",1,"form-textarea"],[1,"alert","alert-danger","mb-lg"],[1,"d-flex","gap-md","justify-between"],["type","button",1,"btn","btn-secondary",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"spinner"]],template:function(r,l){r&1&&(t(0,"div",0)(1,"header",1)(2,"h1"),n(3,"Nueva Transacci\xF3n Crypto"),e()(),t(4,"form",2),b("ngSubmit",function(){return l.onSubmit()}),t(5,"div",3)(6,"div",4)(7,"div",5)(8,"div",6)(9,"label",7),n(10,"Tipo de Transacci\xF3n *"),e(),t(11,"select",8)(12,"option",9),n(13,"Compra"),e(),t(14,"option",10),n(15,"Venta"),e(),t(16,"option",11),n(17,"Intercambio"),e(),t(18,"option",12),n(19,"Transferencia Entrada"),e(),t(20,"option",13),n(21,"Transferencia Salida"),e(),t(22,"option",14),n(23,"Recompensa Staking"),e(),t(24,"option",15),n(25,"Airdrop"),e(),t(26,"option",16),n(27,"Miner\xEDa"),e()()(),t(28,"div",6)(29,"label",7),n(30,"Activo *"),e(),t(31,"select",17)(32,"option",18),n(33,"Seleccionar activo"),e(),x(34,H,2,3,"option",19,B),e()(),t(36,"div",6)(37,"label",7),n(38,"Fecha y Hora *"),e(),o(39,"input",20),e()(),t(40,"div",5)(41,"div",6)(42,"label",7),n(43,"Cantidad *"),e(),o(44,"input",21),e(),t(45,"div",6)(46,"label",7),n(47,"Precio por Unidad (\u20AC)"),e(),o(48,"input",22),e(),t(49,"div",6)(50,"label",7),n(51,"Valor Total (\u20AC)"),e(),o(52,"input",23),e()(),t(53,"div",5)(54,"div",6)(55,"label",7),n(56,"Exchange/Wallet"),e(),o(57,"input",24),e(),t(58,"div",6)(59,"label",7),n(60,"Hash de Transacci\xF3n"),e(),o(61,"input",25),e(),t(62,"div",6)(63,"label",7),n(64,"Comisi\xF3n (en cripto)"),e(),o(65,"input",26),e()(),t(66,"div",6)(67,"label",7),n(68,"Notas"),e(),o(69,"textarea",27),e()()(),v(70,W,2,1,"div",28),t(71,"div",29)(72,"button",30),b("click",function(){return l.cancel()}),n(73,"Cancelar"),e(),t(74,"button",31),v(75,L,2,0)(76,Y,1,0),e()()()()),r&2&&(m(4),f("formGroup",l.form),m(30),C(l.assets()),m(36),g(70,l.error()?70:-1),m(4),f("disabled",l.saving()),m(),g(75,l.saving()?75:76))},dependencies:[N,j,V,D,k,A,O,w,M,I,G,P,R],styles:[".page[_ngcontent-%COMP%]{padding:var(--spacing-xl);max-width:900px}.form-row[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.alert[_ngcontent-%COMP%]{padding:var(--spacing-md);border-radius:var(--radius-md)}.alert-danger[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}"]})}return a})();export{te as TransactionFormComponent};
