{"version":3,"sources":["../src/worker.module.ts"],"sourcesContent":["import { Module, Logger } from '@nestjs/common';\nimport { ConfigModule, ConfigService } from '@nestjs/config';\nimport { BullModule } from '@nestjs/bullmq';\nimport { ScheduleModule } from '@nestjs/schedule';\nimport { PrismaService } from '@crypto-erp/database';\n\n// Processors\nimport { BlockchainSyncProcessor } from './processors/blockchain-sync.processor.js';\nimport { PriceUpdateProcessor } from './processors/price-update.processor.js';\nimport { VerifactuSendProcessor } from './processors/verifactu-send.processor.js';\nimport { JournalEntryProcessor } from './processors/journal-entry.processor.js';\nimport { AiCategorizeProcessor } from './processors/ai-categorize.processor.js';\nimport { EmailSendProcessor } from './processors/email-send.processor.js';\n\n// Queue names - exported for use in API\nexport const QUEUE_NAMES = {\n  BLOCKCHAIN_SYNC: 'blockchain-sync',\n  PRICE_UPDATE: 'price-update',\n  VERIFACTU_SEND: 'verifactu-send',\n  JOURNAL_ENTRY: 'journal-entry',\n  AI_CATEGORIZE: 'ai-categorize',\n  EMAIL_SEND: 'email-send',\n} as const;\n\n@Module({\n  imports: [\n    // Environment configuration\n    ConfigModule.forRoot({\n      isGlobal: true,\n      envFilePath: ['.env', '.env.local'],\n    }),\n\n    // Schedule module for cron jobs\n    ScheduleModule.forRoot(),\n\n    // BullMQ configuration with Redis connection\n    BullModule.forRootAsync({\n      imports: [ConfigModule],\n      inject: [ConfigService],\n      useFactory: (config: ConfigService) => ({\n        connection: {\n          host: config.get<string>('REDIS_HOST', 'localhost'),\n          port: config.get<number>('REDIS_PORT', 6379),\n          password: config.get<string>('REDIS_PASSWORD', undefined),\n          db: config.get<number>('REDIS_DB', 0),\n        },\n        defaultJobOptions: {\n          removeOnComplete: 100, // Keep last 100 completed jobs\n          removeOnFail: 500,     // Keep last 500 failed jobs\n          attempts: 3,\n          backoff: {\n            type: 'exponential',\n            delay: 2000,\n          },\n        },\n      }),\n    }),\n\n    // Register queues\n    BullModule.registerQueue(\n      { name: QUEUE_NAMES.BLOCKCHAIN_SYNC },\n      { name: QUEUE_NAMES.PRICE_UPDATE },\n      { name: QUEUE_NAMES.VERIFACTU_SEND },\n      { name: QUEUE_NAMES.JOURNAL_ENTRY },\n      { name: QUEUE_NAMES.AI_CATEGORIZE },\n      { name: QUEUE_NAMES.EMAIL_SEND },\n    ),\n  ],\n  providers: [\n    PrismaService,\n    Logger,\n    // Processors\n    BlockchainSyncProcessor,\n    PriceUpdateProcessor,\n    VerifactuSendProcessor,\n    JournalEntryProcessor,\n    AiCategorizeProcessor,\n    EmailSendProcessor,\n  ],\n})\nexport class WorkerModule {}\n"],"names":["QUEUE_NAMES","WorkerModule","BLOCKCHAIN_SYNC","PRICE_UPDATE","VERIFACTU_SEND","JOURNAL_ENTRY","AI_CATEGORIZE","EMAIL_SEND","imports","ConfigModule","forRoot","isGlobal","envFilePath","ScheduleModule","BullModule","forRootAsync","inject","ConfigService","useFactory","config","connection","host","get","port","password","undefined","db","defaultJobOptions","removeOnComplete","removeOnFail","attempts","backoff","type","delay","registerQueue","name","providers","PrismaService","Logger","BlockchainSyncProcessor","PriceUpdateProcessor","VerifactuSendProcessor","JournalEntryProcessor","AiCategorizeProcessor","EmailSendProcessor"],"mappings":";;;;;;;;;;;QAeaA;eAAAA;;QAiEAC;eAAAA;;;wBAhFkB;wBACa;wBACjB;0BACI;0BACD;yCAGU;sCACH;wCACE;uCACD;uCACA;oCACH;;;;;;;AAG5B,MAAMD,cAAc;IACzBE,iBAAiB;IACjBC,cAAc;IACdC,gBAAgB;IAChBC,eAAe;IACfC,eAAe;IACfC,YAAY;AACd;AA0DO,IAAA,AAAMN,eAAN,MAAMA;AAAc;;;QAvDzBO,SAAS;YACP,4BAA4B;YAC5BC,oBAAY,CAACC,OAAO,CAAC;gBACnBC,UAAU;gBACVC,aAAa;oBAAC;oBAAQ;iBAAa;YACrC;YAEA,gCAAgC;YAChCC,wBAAc,CAACH,OAAO;YAEtB,6CAA6C;YAC7CI,kBAAU,CAACC,YAAY,CAAC;gBACtBP,SAAS;oBAACC,oBAAY;iBAAC;gBACvBO,QAAQ;oBAACC,qBAAa;iBAAC;gBACvBC,YAAY,CAACC,SAA2B,CAAA;wBACtCC,YAAY;4BACVC,MAAMF,OAAOG,GAAG,CAAS,cAAc;4BACvCC,MAAMJ,OAAOG,GAAG,CAAS,cAAc;4BACvCE,UAAUL,OAAOG,GAAG,CAAS,kBAAkBG;4BAC/CC,IAAIP,OAAOG,GAAG,CAAS,YAAY;wBACrC;wBACAK,mBAAmB;4BACjBC,kBAAkB;4BAClBC,cAAc;4BACdC,UAAU;4BACVC,SAAS;gCACPC,MAAM;gCACNC,OAAO;4BACT;wBACF;oBACF,CAAA;YACF;YAEA,kBAAkB;YAClBnB,kBAAU,CAACoB,aAAa,CACtB;gBAAEC,MAAMnC,YAAYE,eAAe;YAAC,GACpC;gBAAEiC,MAAMnC,YAAYG,YAAY;YAAC,GACjC;gBAAEgC,MAAMnC,YAAYI,cAAc;YAAC,GACnC;gBAAE+B,MAAMnC,YAAYK,aAAa;YAAC,GAClC;gBAAE8B,MAAMnC,YAAYM,aAAa;YAAC,GAClC;gBAAE6B,MAAMnC,YAAYO,UAAU;YAAC;SAElC;QACD6B,WAAW;YACTC,uBAAa;YACbC,cAAM;YACN,aAAa;YACbC,gDAAuB;YACvBC,0CAAoB;YACpBC,8CAAsB;YACtBC,4CAAqB;YACrBC,4CAAqB;YACrBC,sCAAkB;SACnB"}