{"version":3,"sources":["../../../src/modules/invitations/invitations.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Delete,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n} from '@nestjs/common';\nimport { InvitationsService } from './invitations.service';\nimport { CreateInvitationDto } from './dto/create-invitation.dto';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { GetUser } from '../auth/decorators/get-user.decorator';\nimport { GetCompany } from '../auth/decorators/get-company.decorator';\nimport { UserRole, InvitationStatus } from '@prisma/client';\n\n@Controller('invitations')\n@UseGuards(JwtAuthGuard)\nexport class InvitationsController {\n  constructor(private readonly invitationsService: InvitationsService) {}\n\n  /**\n   * Create a new invitation\n   * Only ADMIN and OWNER can invite users\n   */\n  @Post()\n  @UseGuards(RolesGuard)\n  @Roles(UserRole.ADMIN, UserRole.OWNER)\n  async create(\n    @GetUser('id') userId: string,\n    @GetCompany() companyId: string,\n    @Body() dto: CreateInvitationDto,\n  ) {\n    return this.invitationsService.createInvitation(companyId, userId, dto);\n  }\n\n  /**\n   * Accept an invitation by token\n   */\n  @Post(':token/accept')\n  async accept(@Param('token') token: string, @GetUser('id') userId: string) {\n    return this.invitationsService.acceptInvitation(token, userId);\n  }\n\n  /**\n   * Cancel an invitation\n   * Only ADMIN, OWNER, or the inviter can cancel\n   */\n  @Delete(':id')\n  @UseGuards(RolesGuard)\n  @Roles(UserRole.ADMIN, UserRole.OWNER)\n  async cancel(\n    @Param('id') id: string,\n    @GetUser('id') userId: string,\n    @GetCompany() companyId: string,\n  ) {\n    return this.invitationsService.cancelInvitation(id, userId, companyId);\n  }\n\n  /**\n   * List all invitations for current company\n   */\n  @Get()\n  @UseGuards(RolesGuard)\n  @Roles(UserRole.ADMIN, UserRole.OWNER, UserRole.ACCOUNTANT)\n  async list(\n    @GetCompany() companyId: string,\n    @Query('status') status?: InvitationStatus,\n  ) {\n    return this.invitationsService.findByCompany(companyId, status);\n  }\n\n  /**\n   * Get invitation details by token (public endpoint for accepting)\n   */\n  @Get('token/:token')\n  async getByToken(@Param('token') token: string) {\n    return this.invitationsService.findByToken(token);\n  }\n}\n"],"names":["InvitationsController","create","userId","companyId","dto","invitationsService","createInvitation","accept","token","acceptInvitation","cancel","id","cancelInvitation","list","status","findByCompany","getByToken","findByToken","ADMIN","OWNER","ACCOUNTANT"],"mappings":";;;;+BAqBaA;;;eAAAA;;;wBAZN;oCAC4B;qCACC;8BACP;4BACF;gCACL;kCACE;qCACG;wBACgB;;;;;;;;;;;;;;;AAIpC,IAAA,AAAMA,wBAAN,MAAMA;IAGX;;;GAGC,GACD,MAGMC,OACJ,AAAeC,MAAc,EAC7B,AAAcC,SAAiB,EAC/B,AAAQC,GAAwB,EAChC;QACA,OAAO,IAAI,CAACC,kBAAkB,CAACC,gBAAgB,CAACH,WAAWD,QAAQE;IACrE;IAEA;;GAEC,GACD,MACMG,OAAO,AAAgBC,KAAa,EAAE,AAAeN,MAAc,EAAE;QACzE,OAAO,IAAI,CAACG,kBAAkB,CAACI,gBAAgB,CAACD,OAAON;IACzD;IAEA;;;GAGC,GACD,MAGMQ,OACJ,AAAaC,EAAU,EACvB,AAAeT,MAAc,EAC7B,AAAcC,SAAiB,EAC/B;QACA,OAAO,IAAI,CAACE,kBAAkB,CAACO,gBAAgB,CAACD,IAAIT,QAAQC;IAC9D;IAEA;;GAEC,GACD,MAGMU,KACJ,AAAcV,SAAiB,EAC/B,AAAiBW,MAAyB,EAC1C;QACA,OAAO,IAAI,CAACT,kBAAkB,CAACU,aAAa,CAACZ,WAAWW;IAC1D;IAEA;;GAEC,GACD,MACME,WAAW,AAAgBR,KAAa,EAAE;QAC9C,OAAO,IAAI,CAACH,kBAAkB,CAACY,WAAW,CAACT;IAC7C;IA3DA,YAAY,AAAiBH,kBAAsC,CAAE;aAAxCA,qBAAAA;IAAyC;AA4DxE;;;;gDApDkBa,wBAAgBC;;;;;;;;;;;;;;;;;;;;;;;;;;gDAuBhBD,wBAAgBC;;;;;;;;;;;;;;;gDAchBD,wBAAgBC,wBAAgBC"}