{"version":3,"sources":["../../../src/modules/monitoring/monitoring.module.ts"],"sourcesContent":["import { Module } from '@nestjs/common';\nimport { PrometheusModule, makeCounterProvider, makeHistogramProvider, makeGaugeProvider } from '@willsoto/nestjs-prometheus';\nimport { MetricsService } from './metrics.service.js';\nimport { MetricsInterceptor } from './metrics.interceptor.js';\nimport { MetricsController } from './metrics.controller.js';\n\n@Module({\n  imports: [\n    PrometheusModule.register({\n      path: '/metrics',\n      defaultMetrics: {\n        enabled: true,\n        config: {\n          prefix: 'crypto_erp_',\n        },\n      },\n    }),\n  ],\n  controllers: [MetricsController],\n  providers: [\n    // HTTP Metrics\n    makeCounterProvider({\n      name: 'http_requests_total',\n      help: 'Total number of HTTP requests',\n      labelNames: ['method', 'route', 'status_code'],\n    }),\n    makeHistogramProvider({\n      name: 'http_request_duration_seconds',\n      help: 'HTTP request duration in seconds',\n      labelNames: ['method', 'route'],\n      buckets: [0.01, 0.05, 0.1, 0.5, 1, 2, 5],\n    }),\n\n    // Database Metrics\n    makeHistogramProvider({\n      name: 'db_query_duration_seconds',\n      help: 'Database query duration in seconds',\n      labelNames: ['operation'],\n      buckets: [0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1],\n    }),\n    makeGaugeProvider({\n      name: 'db_connections_active',\n      help: 'Number of active database connections',\n      labelNames: ['pool'],\n    }),\n\n    // Business Metrics\n    makeCounterProvider({\n      name: 'invoices_created_total',\n      help: 'Total number of invoices created',\n      labelNames: ['company_id', 'type'],\n    }),\n    makeCounterProvider({\n      name: 'crypto_transactions_synced_total',\n      help: 'Total number of crypto transactions synced',\n      labelNames: ['blockchain', 'type'],\n    }),\n    makeCounterProvider({\n      name: 'ai_messages_total',\n      help: 'Total number of AI messages processed',\n      labelNames: ['company_id', 'provider'],\n    }),\n    makeCounterProvider({\n      name: 'verifactu_submissions_total',\n      help: 'Total number of Verifactu submissions',\n      labelNames: ['company_id', 'status'],\n    }),\n\n    // Queue Metrics\n    makeCounterProvider({\n      name: 'queue_jobs_total',\n      help: 'Total number of queue jobs processed',\n      labelNames: ['queue', 'status'],\n    }),\n    makeGaugeProvider({\n      name: 'queue_jobs_active',\n      help: 'Number of active queue jobs',\n      labelNames: ['queue'],\n    }),\n    makeCounterProvider({\n      name: 'queue_jobs_failed_total',\n      help: 'Total number of failed queue jobs',\n      labelNames: ['queue'],\n    }),\n\n    // Subscription Metrics\n    makeGaugeProvider({\n      name: 'subscriptions_active',\n      help: 'Number of active subscriptions',\n    }),\n    makeCounterProvider({\n      name: 'subscriptions_churned_total',\n      help: 'Total number of churned subscriptions',\n      labelNames: ['plan', 'reason'],\n    }),\n    makeGaugeProvider({\n      name: 'revenue_mrr',\n      help: 'Monthly Recurring Revenue in EUR',\n    }),\n\n    MetricsService,\n    MetricsInterceptor,\n  ],\n  exports: [MetricsService, MetricsInterceptor],\n})\nexport class MonitoringModule {}\n"],"names":["MonitoringModule","imports","PrometheusModule","register","path","defaultMetrics","enabled","config","prefix","controllers","MetricsController","providers","makeCounterProvider","name","help","labelNames","makeHistogramProvider","buckets","makeGaugeProvider","MetricsService","MetricsInterceptor","exports"],"mappings":";;;;+BAyGaA;;;eAAAA;;;wBAzGU;kCACyE;gCACjE;oCACI;mCACD;;;;;;;AAqG3B,IAAA,AAAMA,mBAAN,MAAMA;AAAkB;;;QAlG7BC,SAAS;YACPC,kCAAgB,CAACC,QAAQ,CAAC;gBACxBC,MAAM;gBACNC,gBAAgB;oBACdC,SAAS;oBACTC,QAAQ;wBACNC,QAAQ;oBACV;gBACF;YACF;SACD;QACDC,aAAa;YAACC,oCAAiB;SAAC;QAChCC,WAAW;YACT,eAAe;YACfC,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAU;oBAAS;iBAAc;YAChD;YACAC,IAAAA,uCAAqB,EAAC;gBACpBH,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAU;iBAAQ;gBAC/BE,SAAS;oBAAC;oBAAM;oBAAM;oBAAK;oBAAK;oBAAG;oBAAG;iBAAE;YAC1C;YAEA,mBAAmB;YACnBD,IAAAA,uCAAqB,EAAC;gBACpBH,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;iBAAY;gBACzBE,SAAS;oBAAC;oBAAO;oBAAO;oBAAM;oBAAM;oBAAK;oBAAK;iBAAE;YAClD;YACAC,IAAAA,mCAAiB,EAAC;gBAChBL,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;iBAAO;YACtB;YAEA,mBAAmB;YACnBH,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAc;iBAAO;YACpC;YACAH,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAc;iBAAO;YACpC;YACAH,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAc;iBAAW;YACxC;YACAH,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAc;iBAAS;YACtC;YAEA,gBAAgB;YAChBH,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAS;iBAAS;YACjC;YACAG,IAAAA,mCAAiB,EAAC;gBAChBL,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;iBAAQ;YACvB;YACAH,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;iBAAQ;YACvB;YAEA,uBAAuB;YACvBG,IAAAA,mCAAiB,EAAC;gBAChBL,MAAM;gBACNC,MAAM;YACR;YACAF,IAAAA,qCAAmB,EAAC;gBAClBC,MAAM;gBACNC,MAAM;gBACNC,YAAY;oBAAC;oBAAQ;iBAAS;YAChC;YACAG,IAAAA,mCAAiB,EAAC;gBAChBL,MAAM;gBACNC,MAAM;YACR;YAEAK,8BAAc;YACdC,sCAAkB;SACnB;QACDC,SAAS;YAACF,8BAAc;YAAEC,sCAAkB;SAAC"}