import{c as m}from"./chunk-R5763NNK.js";import{a as d}from"./chunk-FXBJWTCM.js";import{I as n,L as u,Lb as g,Q as i,i as o,tb as p,u as s,xa as a}from"./chunk-2V2B4KT2.js";var l="access_token",c="refresh_token",h="company_id",U=(()=>{class r{http;router;apiUrl=d.apiUrl;currentUserSignal=a(null);currentCompanyIdSignal=a(null);currentUser=this.currentUserSignal.asReadonly();currentCompanyId=this.currentCompanyIdSignal.asReadonly();isAuthenticated=p(()=>!!this.currentUserSignal());constructor(t,e){this.http=t,this.router=e,this.loadStoredCompanyId()}login(t){return this.http.post(`${this.apiUrl}/auth/login`,t).pipe(n(e=>this.handleAuthResponse(e)))}register(t){return this.http.post(`${this.apiUrl}/auth/register`,t).pipe(n(e=>this.handleAuthResponse(e)))}refreshToken(){let t=this.getRefreshToken();return t?this.http.post(`${this.apiUrl}/auth/refresh`,{refreshToken:t}).pipe(n(e=>{this.setTokens(e)}),s(()=>(this.logout(),o(null)))):o(null)}loadCurrentUser(){return this.getAccessToken()?this.http.get(`${this.apiUrl}/auth/me`).pipe(n(e=>this.currentUserSignal.set(e)),s(()=>(this.logout(),o(null)))):o(null)}logout(){localStorage.removeItem(l),localStorage.removeItem(c),this.currentUserSignal.set(null),this.router.navigate(["/auth/login"])}setCompanyId(t){localStorage.setItem(h,t),this.currentCompanyIdSignal.set(t)}getAccessToken(){return localStorage.getItem(l)}getRefreshToken(){return localStorage.getItem(c)}getCompanyId(){return localStorage.getItem(h)}handleAuthResponse(t){this.setTokens({accessToken:t.accessToken,refreshToken:t.refreshToken}),this.currentUserSignal.set(t.user)}setTokens(t){localStorage.setItem(l,t.accessToken),localStorage.setItem(c,t.refreshToken)}loadStoredCompanyId(){let t=localStorage.getItem(h);t&&this.currentCompanyIdSignal.set(t)}static \u0275fac=function(e){return new(e||r)(i(g),i(m))};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();export{U as a};
