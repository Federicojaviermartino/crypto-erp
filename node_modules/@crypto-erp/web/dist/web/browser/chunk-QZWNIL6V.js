import{a as D,c as R,e as G,l as $,m as j,n as X,r as Y}from"./chunk-OE3B74VB.js";import{a as H}from"./chunk-JU2KEDBD.js";import"./chunk-FXBJWTCM.js";import{$a as x,Da as u,Db as N,Ea as V,Fa as C,Fb as I,Gb as z,Ha as A,Ja as _,Ma as W,Na as k,Oa as t,Pa as n,Qa as h,Ra as w,Sa as g,Ta as s,U as T,Za as a,_a as M,aa as m,ba as p,bb as f,cb as v,db as y,fb as B,hb as S,jb as E,oa as L,ra as r,sa as F,xa as b}from"./chunk-2V2B4KT2.js";import{a as P,b as O}from"./chunk-35PI25VP.js";var U=(l,c)=>c.id,q=(l,c)=>c.contract_ticker_symbol;function K(l,c){l&1&&h(0,"span",5)}function J(l,c){l&1&&(t(0,"div",7),h(1,"span",9),n())}function Q(l,c){l&1&&(t(0,"span",19),h(1,"span",28),a(2," Sincronizando "),n())}function Z(l,c){l&1&&(t(0,"span",29),a(1,"Sincronizado"),n())}function ee(l,c){if(l&1&&(t(0,"span",30),a(1,"Error"),n()),l&2){let e=s().$implicit;C("title",e.syncError||"")}}function te(l,c){l&1&&(t(0,"span",31),a(1,"Pendiente"),n())}function ne(l,c){if(l&1&&(t(0,"p",24),a(1),S(2,"date"),n()),l&2){let e=s().$implicit;r(),x(" Ultima sync: ",E(2,1,e.lastSyncAt,"dd/MM/yyyy HH:mm")," ")}}function ie(l,c){if(l&1){let e=w();t(0,"div",13)(1,"div",14)(2,"div",15)(3,"span",16),a(4),n(),t(5,"span",17),a(6),n()(),t(7,"div",18),u(8,Q,3,0,"span",19)(9,Z,2,0)(10,ee,2,1)(11,te,2,0),n()(),t(12,"div",20)(13,"h3",21),a(14),n(),t(15,"p",22),a(16),t(17,"button",23),g("click",function(){let i=m(e).$implicit,d=s(2);return p(d.copyAddress(i.address))}),a(18,"Copiar"),n()(),u(19,ne,3,4,"p",24),n(),t(20,"div",25)(21,"button",26),g("click",function(){let i=m(e).$implicit,d=s(2);return p(d.syncWallet(i))}),a(22," Sincronizar "),n(),t(23,"button",27),g("click",function(){let i=m(e).$implicit,d=s(2);return p(d.viewBalances(i))}),a(24," Ver Balances "),n(),t(25,"button",27),g("click",function(){let i=m(e).$implicit,d=s(2);return p(d.editWallet(i))}),a(26," Editar "),n()()()}if(l&2){let e=c.$implicit,o=s(2);A("syncing",e.syncStatus==="SYNCING"),r(3),V("data-chain",e.chain),r(),x(" ",o.getChainName(e.chain)," "),r(2),M(o.getWalletType(e.type)),r(2),_(8,e.syncStatus==="SYNCING"?8:e.syncStatus==="SYNCED"?9:e.syncStatus==="ERROR"?10:11),r(6),M(e.label||"Sin nombre"),r(),C("title",e.address),r(),x(" ",o.truncateAddress(e.address)," "),r(3),_(19,e.lastSyncAt?19:-1),r(2),C("disabled",e.syncStatus==="SYNCING")}}function ae(l,c){if(l&1){let e=w();t(0,"div",12)(1,"span",32),a(2,"+"),n(),t(3,"h3"),a(4,"No hay wallets configuradas"),n(),t(5,"p"),a(6,"Agrega tu primera wallet para comenzar a sincronizar transacciones"),n(),t(7,"button",6),g("click",function(){m(e);let i=s(2);return p(i.showModal=!0)}),a(8," Agregar Wallet "),n()()}}function le(l,c){if(l&1&&(t(0,"div",10),W(1,ie,27,11,"div",11,U,!1,ae,9,0,"div",12),n()),l&2){let e=s();r(),k(e.wallets())}}function oe(l,c){l&1&&h(0,"span",5)}function re(l,c){if(l&1){let e=w();t(0,"div",33),g("click",function(){m(e);let i=s();return p(i.closeModal())}),t(1,"div",34),g("click",function(i){return m(e),p(i.stopPropagation())}),t(2,"div",35)(3,"h3"),a(4),n(),t(5,"button",36),g("click",function(){m(e);let i=s();return p(i.closeModal())}),a(6,"\xD7"),n()(),t(7,"div",37)(8,"div",38)(9,"label",39),a(10,"Direccion *"),n(),t(11,"input",40),y("ngModelChange",function(i){m(e);let d=s();return v(d.walletForm.address,i)||(d.walletForm.address=i),p(i)}),n()(),t(12,"div",41)(13,"div",38)(14,"label",39),a(15,"Blockchain *"),n(),t(16,"select",42),y("ngModelChange",function(i){m(e);let d=s();return v(d.walletForm.chain,i)||(d.walletForm.chain=i),p(i)}),t(17,"option",43),a(18,"Seleccionar"),n(),t(19,"option",44),a(20,"Ethereum"),n(),t(21,"option",45),a(22,"Polygon"),n(),t(23,"option",46),a(24,"BNB Chain"),n(),t(25,"option",47),a(26,"Arbitrum"),n(),t(27,"option",48),a(28,"Optimism"),n(),t(29,"option",49),a(30,"Base"),n(),t(31,"option",50),a(32,"Avalanche"),n()()(),t(33,"div",38)(34,"label",39),a(35,"Tipo"),n(),t(36,"select",51),y("ngModelChange",function(i){m(e);let d=s();return v(d.walletForm.type,i)||(d.walletForm.type=i),p(i)}),t(37,"option",52),a(38,"Externa"),n(),t(39,"option",53),a(40,"Exchange"),n(),t(41,"option",54),a(42,"DeFi"),n(),t(43,"option",55),a(44,"Cold Storage"),n()()()(),t(45,"div",38)(46,"label",39),a(47,"Etiqueta"),n(),t(48,"input",56),y("ngModelChange",function(i){m(e);let d=s();return v(d.walletForm.label,i)||(d.walletForm.label=i),p(i)}),n()(),t(49,"div",38)(50,"label",39),a(51,"Codigo Contable"),n(),t(52,"input",57),y("ngModelChange",function(i){m(e);let d=s();return v(d.walletForm.accountCode,i)||(d.walletForm.accountCode=i),p(i)}),n(),t(53,"small",58),a(54,"Cuenta contable para asientos automaticos"),n()()(),t(55,"div",59)(56,"button",60),g("click",function(){m(e);let i=s();return p(i.closeModal())}),a(57,"Cancelar"),n(),t(58,"button",61),g("click",function(){m(e);let i=s();return p(i.saveWallet())}),u(59,oe,1,0,"span",5),a(60),n()()()()}if(l&2){let e=s();r(4),x("",e.editingWallet?"Editar":"Agregar"," Wallet"),r(7),f("ngModel",e.walletForm.address),C("disabled",!!e.editingWallet),r(5),f("ngModel",e.walletForm.chain),C("disabled",!!e.editingWallet),r(20),f("ngModel",e.walletForm.type),r(12),f("ngModel",e.walletForm.label),r(4),f("ngModel",e.walletForm.accountCode),r(6),C("disabled",e.saving()),r(),_(59,e.saving()?59:-1),r(),x(" ",e.editingWallet?"Guardar":"Agregar"," ")}}function se(l,c){l&1&&(t(0,"div",63),h(1,"span",9),n())}function ce(l,c){if(l&1&&h(0,"img",68),l&2){let e=s().$implicit;C("src",e.logo_url,L)}}function de(l,c){if(l&1&&(t(0,"tr")(1,"td")(2,"div",67),u(3,ce,1,1,"img",68),t(4,"strong"),a(5),n()()(),t(6,"td",65),a(7),n(),t(8,"td",65),a(9),S(10,"number"),n()()),l&2){let e=c.$implicit,o=s(3);r(3),_(3,e.logo_url?3:-1),r(2),M(e.contract_ticker_symbol),r(2),M(o.formatBalance(e.balance)),r(2),x("",E(10,4,e.quote,"1.2-2")," EUR")}}function me(l,c){l&1&&(t(0,"tr")(1,"td",69),a(2," No hay balances disponibles "),n()())}function pe(l,c){if(l&1&&(t(0,"div",66),a(1," Total: "),t(2,"strong"),a(3),S(4,"number"),n()()),l&2){let e=s(3);r(3),x("",E(4,1,e.totalValue(),"1.2-2")," EUR")}}function ge(l,c){if(l&1&&(t(0,"table",64)(1,"thead")(2,"tr")(3,"th"),a(4,"Token"),n(),t(5,"th",65),a(6,"Balance"),n(),t(7,"th",65),a(8,"Valor EUR"),n()()(),t(9,"tbody"),W(10,de,11,7,"tr",null,q,!1,me,3,0,"tr"),n()(),u(13,pe,5,4,"div",66)),l&2){let e=s(2);r(10),k(e.balances()),r(3),_(13,e.totalValue()?13:-1)}}function _e(l,c){if(l&1){let e=w();t(0,"div",33),g("click",function(){m(e);let i=s();return p(i.showBalancesModal=!1)}),t(1,"div",62),g("click",function(i){return m(e),p(i.stopPropagation())}),t(2,"div",35)(3,"h3"),a(4),n(),t(5,"button",36),g("click",function(){m(e);let i=s();return p(i.showBalancesModal=!1)}),a(6,"\xD7"),n()(),t(7,"div",37),u(8,se,2,0,"div",63)(9,ge,14,2),n()()()}if(l&2){let e=s();r(4),x("Balances: ",e.selectedWallet.label||e.truncateAddress(e.selectedWallet.address),""),r(4),_(8,e.loadingBalances()?8:9)}}var ue={ethereum:"Ethereum",polygon:"Polygon",bsc:"BNB Chain",arbitrum:"Arbitrum",optimism:"Optimism",base:"Base",avalanche:"Avalanche"},Ce={EXTERNAL:"Externa",EXCHANGE:"Exchange",DEFI:"DeFi",COLD:"Cold Storage"},Se=(()=>{class l{api;wallets=b([]);balances=b([]);loading=b(!0);loadingBalances=b(!1);saving=b(!1);syncingAll=b(!1);totalValue=b(0);showModal=!1;showBalancesModal=!1;editingWallet=null;selectedWallet=null;walletForm={address:"",chain:"",label:"",type:"EXTERNAL",accountCode:""};constructor(e){this.api=e}ngOnInit(){this.loadWallets()}loadWallets(){this.loading.set(!0),this.api.get("/crypto/wallets").subscribe({next:e=>{this.wallets.set(e.wallets||[]),this.loading.set(!1)},error:()=>this.loading.set(!1)})}saveWallet(){!this.walletForm.address||!this.walletForm.chain||(this.saving.set(!0),this.editingWallet?this.api.put(`/crypto/wallets/${this.editingWallet.id}`,{label:this.walletForm.label,type:this.walletForm.type,accountCode:this.walletForm.accountCode||null}).subscribe({next:()=>{this.saving.set(!1),this.closeModal(),this.loadWallets()},error:()=>this.saving.set(!1)}):this.api.post("/crypto/wallets",this.walletForm).subscribe({next:()=>{this.saving.set(!1),this.closeModal(),this.loadWallets()},error:()=>this.saving.set(!1)}))}editWallet(e){this.editingWallet=e,this.walletForm={address:e.address,chain:e.chain,label:e.label||"",type:e.type,accountCode:""},this.showModal=!0}syncWallet(e){this.wallets.update(o=>o.map(i=>i.id===e.id?O(P({},i),{syncStatus:"SYNCING"}):i)),this.api.post(`/crypto/sync/wallet/${e.id}`,{}).subscribe({next:()=>this.loadWallets(),error:()=>this.loadWallets()})}syncAllWallets(){this.syncingAll.set(!0),this.api.post("/crypto/sync/all",{}).subscribe({next:()=>{this.syncingAll.set(!1),this.loadWallets()},error:()=>{this.syncingAll.set(!1),this.loadWallets()}})}viewBalances(e){this.selectedWallet=e,this.showBalancesModal=!0,this.loadingBalances.set(!0),this.api.get(`/crypto/wallets/${e.id}/balances`).subscribe({next:o=>{this.balances.set(o.balances||[]),this.totalValue.set(o.totalValueEur||0),this.loadingBalances.set(!1)},error:()=>{this.balances.set([]),this.totalValue.set(0),this.loadingBalances.set(!1)}})}closeModal(){this.showModal=!1,this.editingWallet=null,this.walletForm={address:"",chain:"",label:"",type:"EXTERNAL",accountCode:""}}getChainName(e){return ue[e]||e}getWalletType(e){return Ce[e]||e}truncateAddress(e){return`${e.slice(0,6)}...${e.slice(-4)}`}formatBalance(e){let o=parseFloat(e);return o>=1e6?`${(o/1e6).toFixed(2)}M`:o>=1e3?`${(o/1e3).toFixed(2)}K`:o<1e-4?"<0.0001":o.toFixed(4)}copyAddress(e){navigator.clipboard.writeText(e)}static \u0275fac=function(o){return new(o||l)(F(H))};static \u0275cmp=T({type:l,selectors:[["app-wallets-list"]],standalone:!0,features:[B],decls:17,vars:5,consts:[[1,"page"],[1,"page-header"],[1,"text-muted"],[1,"header-actions"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"spinner-sm"],[1,"btn","btn-primary",3,"click"],[1,"text-center","p-xl"],[1,"modal-backdrop"],[1,"spinner"],[1,"wallets-grid"],[1,"wallet-card",3,"syncing"],[1,"empty-state"],[1,"wallet-card"],[1,"wallet-header"],[1,"wallet-chain"],[1,"chain-badge"],[1,"wallet-type"],[1,"wallet-status"],[1,"status-badge","syncing"],[1,"wallet-body"],[1,"wallet-label"],[1,"wallet-address",3,"title"],[1,"copy-btn",3,"click"],[1,"wallet-sync-time"],[1,"wallet-actions"],[1,"btn","btn-sm","btn-secondary",3,"click","disabled"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"spinner-xs"],[1,"status-badge","synced"],[1,"status-badge","error",3,"title"],[1,"status-badge","pending"],[1,"empty-icon"],[1,"modal-backdrop",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"close-btn",3,"click"],[1,"modal-body"],[1,"form-group"],[1,"form-label"],["type","text","placeholder","0x...",1,"form-input",3,"ngModelChange","ngModel","disabled"],[1,"form-row"],[1,"form-select",3,"ngModelChange","ngModel","disabled"],["value",""],["value","ethereum"],["value","polygon"],["value","bsc"],["value","arbitrum"],["value","optimism"],["value","base"],["value","avalanche"],[1,"form-select",3,"ngModelChange","ngModel"],["value","EXTERNAL"],["value","EXCHANGE"],["value","DEFI"],["value","COLD"],["type","text","placeholder","Mi Wallet Principal",1,"form-input",3,"ngModelChange","ngModel"],["type","text","placeholder","5700001",1,"form-input",3,"ngModelChange","ngModel"],[1,"form-hint"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[1,"modal","modal-lg",3,"click"],[1,"text-center","p-lg"],[1,"table"],[1,"text-right"],[1,"total-value"],[1,"token-cell"],[1,"token-logo",3,"src"],["colspan","3",1,"text-center","text-muted","p-lg"]],template:function(o,i){o&1&&(t(0,"div",0)(1,"header",1)(2,"div")(3,"h1"),a(4,"Wallets Blockchain"),n(),t(5,"p",2),a(6,"Gestiona tus wallets y sincroniza transacciones"),n()(),t(7,"div",3)(8,"button",4),g("click",function(){return i.syncAllWallets()}),u(9,K,1,0,"span",5),a(10," Sincronizar Todas "),n(),t(11,"button",6),g("click",function(){return i.showModal=!0}),a(12," + Agregar Wallet "),n()()(),u(13,J,2,0,"div",7)(14,le,4,1)(15,re,61,11,"div",8)(16,_e,10,2,"div",8),n()),o&2&&(r(8),C("disabled",i.syncingAll()),r(),_(9,i.syncingAll()?9:-1),r(4),_(13,i.loading()?13:14),r(2),_(15,i.showModal?15:-1),r(),_(16,i.showBalancesModal&&i.selectedWallet?16:-1))},dependencies:[z,I,N,Y,j,X,D,$,R,G],styles:[".page[_ngcontent-%COMP%]{padding:var(--spacing-xl)}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:var(--spacing-lg)}.header-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.wallets-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:var(--spacing-lg)}.wallet-card[_ngcontent-%COMP%]{background:var(--white);border-radius:var(--radius-lg);border:1px solid var(--gray-200);overflow:hidden;transition:all var(--transition-normal)}.wallet-card[_ngcontent-%COMP%]:hover{border-color:var(--primary);box-shadow:0 4px 12px #0000001a}.wallet-card.syncing[_ngcontent-%COMP%]{border-color:var(--warning)}.wallet-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--gray-50);border-bottom:1px solid var(--gray-200)}.wallet-chain[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm)}.chain-badge[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-sm);font-size:.75rem;font-weight:600;background:var(--gray-200);color:var(--gray-700)}.chain-badge[data-chain=ethereum][_ngcontent-%COMP%]{background:#627eea20;color:#627eea}.chain-badge[data-chain=polygon][_ngcontent-%COMP%]{background:#8247e520;color:#8247e5}.chain-badge[data-chain=bsc][_ngcontent-%COMP%]{background:#f3ba2f20;color:#c9a227}.chain-badge[data-chain=arbitrum][_ngcontent-%COMP%]{background:#28a0f020;color:#28a0f0}.chain-badge[data-chain=optimism][_ngcontent-%COMP%]{background:#ff042020;color:#ff0420}.chain-badge[data-chain=base][_ngcontent-%COMP%]{background:#0052ff20;color:#0052ff}.chain-badge[data-chain=avalanche][_ngcontent-%COMP%]{background:#e8414420;color:#e84142}.wallet-type[_ngcontent-%COMP%]{font-size:.75rem;color:var(--gray-500)}.status-badge[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-full);font-size:.7rem;font-weight:500}.status-badge.synced[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.status-badge.syncing[_ngcontent-%COMP%]{background:#fef3c7;color:#92400e}.status-badge.error[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.status-badge.pending[_ngcontent-%COMP%]{background:var(--gray-100);color:var(--gray-600)}.wallet-body[_ngcontent-%COMP%]{padding:var(--spacing-lg)}.wallet-label[_ngcontent-%COMP%]{margin:0 0 var(--spacing-sm);font-size:1.125rem}.wallet-address[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm);font-family:monospace;font-size:.875rem;color:var(--gray-500);margin:0}.copy-btn[_ngcontent-%COMP%]{background:none;border:none;color:var(--primary);font-size:.75rem;cursor:pointer;padding:0}.copy-btn[_ngcontent-%COMP%]:hover{text-decoration:underline}.wallet-sync-time[_ngcontent-%COMP%]{margin:var(--spacing-sm) 0 0;font-size:.75rem;color:var(--gray-400)}.wallet-actions[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);padding:var(--spacing-md);border-top:1px solid var(--gray-100)}.empty-state[_ngcontent-%COMP%]{grid-column:1/-1;text-align:center;padding:var(--spacing-2xl);background:var(--white);border-radius:var(--radius-lg);border:2px dashed var(--gray-200)}.empty-state[_ngcontent-%COMP%]   .empty-icon[_ngcontent-%COMP%]{display:block;font-size:3rem;color:var(--gray-300);margin-bottom:var(--spacing-md)}.empty-state[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 var(--spacing-sm)}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--gray-500);margin:0 0 var(--spacing-lg)}.form-row[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:var(--spacing-xs);font-size:.75rem;color:var(--gray-500)}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:var(--white);border-radius:var(--radius-lg);width:100%;max-width:500px;max-height:90vh;overflow:hidden}.modal.modal-lg[_ngcontent-%COMP%]{max-width:700px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-lg);border-bottom:1px solid var(--gray-200)}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.modal-header[_ngcontent-%COMP%]   .close-btn[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer}.modal-body[_ngcontent-%COMP%]{padding:var(--spacing-lg);overflow-y:auto;max-height:60vh}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-md);padding:var(--spacing-lg);border-top:1px solid var(--gray-200)}.token-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:var(--spacing-sm)}.token-logo[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%}.total-value[_ngcontent-%COMP%]{text-align:right;padding:var(--spacing-md);background:var(--gray-50);border-radius:var(--radius-md);margin-top:var(--spacing-md);font-size:1.125rem}.spinner-sm[_ngcontent-%COMP%]{display:inline-block;width:14px;height:14px;border:2px solid currentColor;border-right-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_spin .75s linear infinite}.spinner-xs[_ngcontent-%COMP%]{display:inline-block;width:10px;height:10px;border:2px solid currentColor;border-right-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_spin .75s linear infinite}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})}return l})();export{Se as WalletsListComponent};
