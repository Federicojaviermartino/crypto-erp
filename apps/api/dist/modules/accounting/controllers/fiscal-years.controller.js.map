{"version":3,"sources":["../../../../src/modules/accounting/controllers/fiscal-years.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Patch,\n  Delete,\n  Body,\n  Param,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBearerAuth,\n  ApiParam,\n} from '@nestjs/swagger';\nimport { JwtAuthGuard, TenantGuard } from '../../../common/guards/index.js';\nimport { CurrentCompany } from '../../../common/decorators/index.js';\nimport { FiscalYearsService } from '../services/index.js';\nimport { CreateFiscalYearDto } from '../dto/index.js';\n\n@ApiTags('Fiscal Years')\n@ApiBearerAuth()\n@UseGuards(JwtAuthGuard, TenantGuard)\n@Controller('fiscal-years')\nexport class FiscalYearsController {\n  constructor(private readonly fiscalYearsService: FiscalYearsService) {}\n\n  @Get()\n  @ApiOperation({ summary: 'List all fiscal years' })\n  @ApiResponse({ status: 200, description: 'Returns list of fiscal years' })\n  async findAll(@CurrentCompany() companyId: string) {\n    return this.fiscalYearsService.findAll(companyId);\n  }\n\n  @Get('current')\n  @ApiOperation({ summary: 'Get current fiscal year' })\n  @ApiResponse({ status: 200, description: 'Returns current fiscal year' })\n  @ApiResponse({ status: 404, description: 'No active fiscal year found' })\n  async findCurrent(@CurrentCompany() companyId: string) {\n    const fiscalYear = await this.fiscalYearsService.findCurrent(companyId);\n    if (!fiscalYear) {\n      return { error: 'No active fiscal year found for current date' };\n    }\n    return fiscalYear;\n  }\n\n  @Get(':id')\n  @ApiOperation({ summary: 'Get fiscal year by ID' })\n  @ApiParam({ name: 'id', description: 'Fiscal year ID' })\n  @ApiResponse({ status: 200, description: 'Returns fiscal year details' })\n  @ApiResponse({ status: 404, description: 'Fiscal year not found' })\n  async findById(\n    @CurrentCompany() companyId: string,\n    @Param('id') id: string,\n  ) {\n    return this.fiscalYearsService.findById(companyId, id);\n  }\n\n  @Get(':id/stats')\n  @ApiOperation({ summary: 'Get fiscal year statistics' })\n  @ApiParam({ name: 'id', description: 'Fiscal year ID' })\n  @ApiResponse({ status: 200, description: 'Returns fiscal year statistics' })\n  async getStats(\n    @CurrentCompany() companyId: string,\n    @Param('id') id: string,\n  ) {\n    return this.fiscalYearsService.getStats(companyId, id);\n  }\n\n  @Post()\n  @ApiOperation({ summary: 'Create a new fiscal year' })\n  @ApiResponse({ status: 201, description: 'Fiscal year created successfully' })\n  @ApiResponse({ status: 409, description: 'Overlapping or duplicate fiscal year' })\n  async create(\n    @CurrentCompany() companyId: string,\n    @Body() dto: CreateFiscalYearDto,\n  ) {\n    return this.fiscalYearsService.create(companyId, dto);\n  }\n\n  @Put(':id')\n  @ApiOperation({ summary: 'Update a fiscal year' })\n  @ApiParam({ name: 'id', description: 'Fiscal year ID' })\n  @ApiResponse({ status: 200, description: 'Fiscal year updated successfully' })\n  @ApiResponse({ status: 404, description: 'Fiscal year not found' })\n  @ApiResponse({ status: 409, description: 'Cannot modify closed fiscal year' })\n  async update(\n    @CurrentCompany() companyId: string,\n    @Param('id') id: string,\n    @Body() dto: Partial<CreateFiscalYearDto>,\n  ) {\n    return this.fiscalYearsService.update(companyId, id, dto);\n  }\n\n  @Patch(':id/close')\n  @ApiOperation({ summary: 'Close a fiscal year' })\n  @ApiParam({ name: 'id', description: 'Fiscal year ID' })\n  @ApiResponse({ status: 200, description: 'Fiscal year closed successfully' })\n  @ApiResponse({ status: 400, description: 'Draft entries exist' })\n  @ApiResponse({ status: 409, description: 'Already closed' })\n  @HttpCode(HttpStatus.OK)\n  async close(\n    @CurrentCompany() companyId: string,\n    @Param('id') id: string,\n  ) {\n    return this.fiscalYearsService.close(companyId, id);\n  }\n\n  @Patch(':id/reopen')\n  @ApiOperation({ summary: 'Reopen a closed fiscal year' })\n  @ApiParam({ name: 'id', description: 'Fiscal year ID' })\n  @ApiResponse({ status: 200, description: 'Fiscal year reopened successfully' })\n  @ApiResponse({ status: 409, description: 'Fiscal year is not closed' })\n  @HttpCode(HttpStatus.OK)\n  async reopen(\n    @CurrentCompany() companyId: string,\n    @Param('id') id: string,\n  ) {\n    return this.fiscalYearsService.reopen(companyId, id);\n  }\n\n  @Delete(':id')\n  @ApiOperation({ summary: 'Delete a fiscal year' })\n  @ApiParam({ name: 'id', description: 'Fiscal year ID' })\n  @ApiResponse({ status: 204, description: 'Fiscal year deleted successfully' })\n  @ApiResponse({ status: 404, description: 'Fiscal year not found' })\n  @ApiResponse({ status: 409, description: 'Cannot delete fiscal year with entries' })\n  @HttpCode(HttpStatus.NO_CONTENT)\n  async delete(\n    @CurrentCompany() companyId: string,\n    @Param('id') id: string,\n  ) {\n    await this.fiscalYearsService.delete(companyId, id);\n  }\n}\n"],"names":["FiscalYearsController","findAll","companyId","fiscalYearsService","findCurrent","fiscalYear","error","findById","id","getStats","create","dto","update","close","reopen","delete","summary","status","description","name","OK","NO_CONTENT"],"mappings":"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"}