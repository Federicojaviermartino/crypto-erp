{"version":3,"sources":["../../../src/common/decorators/current-company.decorator.ts"],"sourcesContent":["import { createParamDecorator, ExecutionContext } from '@nestjs/common';\nimport { Request } from 'express';\nimport type { Company, UserRole } from '@prisma/client';\n\n/**\n * Company context attached to request by TenantGuard\n */\nexport interface CompanyContext {\n  company: Company;\n  role: UserRole;\n}\n\n/**\n * Extended request with company context\n */\nexport interface RequestWithCompany extends Request {\n  companyContext: CompanyContext;\n}\n\n/**\n * Decorator to extract current company from request.\n * Must be used after TenantGuard.\n *\n * @example\n * ```typescript\n * @Get('accounts')\n * @UseGuards(JwtAuthGuard, TenantGuard)\n * getAccounts(@CurrentCompany() ctx: CompanyContext) {\n *   return this.accountsService.findAll(ctx.company.id);\n * }\n *\n * // Get only company ID\n * @Get('accounts')\n * @UseGuards(JwtAuthGuard, TenantGuard)\n * getAccounts(@CurrentCompany('companyId') companyId: string) {\n *   return this.accountsService.findAll(companyId);\n * }\n * ```\n */\nexport const CurrentCompany = createParamDecorator(\n  (\n    data: 'company' | 'role' | 'companyId' | undefined,\n    ctx: ExecutionContext,\n  ) => {\n    const request = ctx.switchToHttp().getRequest<RequestWithCompany>();\n    const companyContext = request.companyContext;\n\n    if (!companyContext) {\n      return null;\n    }\n\n    switch (data) {\n      case 'company':\n        return companyContext.company;\n      case 'role':\n        return companyContext.role;\n      case 'companyId':\n        return companyContext.company.id;\n      default:\n        return companyContext;\n    }\n  },\n);"],"names":["CurrentCompany","createParamDecorator","data","ctx","request","switchToHttp","getRequest","companyContext","company","role","id"],"mappings":";;;;+BAuCaA;;;eAAAA;;;wBAvC0C;AAuChD,MAAMA,iBAAiBC,IAAAA,4BAAoB,EAChD,CACEC,MACAC;IAEA,MAAMC,UAAUD,IAAIE,YAAY,GAAGC,UAAU;IAC7C,MAAMC,iBAAiBH,QAAQG,cAAc;IAE7C,IAAI,CAACA,gBAAgB;QACnB,OAAO;IACT;IAEA,OAAQL;QACN,KAAK;YACH,OAAOK,eAAeC,OAAO;QAC/B,KAAK;YACH,OAAOD,eAAeE,IAAI;QAC5B,KAAK;YACH,OAAOF,eAAeC,OAAO,CAACE,EAAE;QAClC;YACE,OAAOH;IACX;AACF"}