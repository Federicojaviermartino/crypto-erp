{"version":3,"sources":["../../../../src/modules/auth/strategies/jwt-refresh.strategy.ts"],"sourcesContent":["import { Injectable, UnauthorizedException } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport { PassportStrategy } from '@nestjs/passport';\nimport { ExtractJwt, Strategy } from 'passport-jwt';\nimport type { JwtPayload } from '../../../common/decorators/current-user.decorator.js';\n\n@Injectable()\nexport class JwtRefreshStrategy extends PassportStrategy(\n  Strategy,\n  'jwt-refresh',\n) {\n  constructor(configService: ConfigService) {\n    const secret = configService.get<string>('jwt.refreshSecret');\n    if (!secret) {\n      throw new Error('JWT_REFRESH_SECRET is not defined');\n    }\n\n    super({\n      jwtFromRequest: ExtractJwt.fromBodyField('refreshToken'),\n      ignoreExpiration: false,\n      secretOrKey: secret,\n    });\n  }\n\n  validate(payload: JwtPayload): JwtPayload {\n    if (!payload.sub || !payload.email) {\n      throw new UnauthorizedException('Invalid refresh token');\n    }\n    return { sub: payload.sub, email: payload.email };\n  }\n}\n"],"names":["JwtRefreshStrategy","PassportStrategy","Strategy","validate","payload","sub","email","UnauthorizedException","configService","secret","get","Error","jwtFromRequest","ExtractJwt","fromBodyField","ignoreExpiration","secretOrKey"],"mappings":";;;;+BAOaA;;;eAAAA;;;wBAPqC;wBACpB;0BACG;6BACI;;;;;;;;;;AAI9B,IAAA,AAAMA,qBAAN,MAAMA,2BAA2BC,IAAAA,0BAAgB,EACtDC,qBAAQ,EACR;IAeAC,SAASC,OAAmB,EAAc;QACxC,IAAI,CAACA,QAAQC,GAAG,IAAI,CAACD,QAAQE,KAAK,EAAE;YAClC,MAAM,IAAIC,6BAAqB,CAAC;QAClC;QACA,OAAO;YAAEF,KAAKD,QAAQC,GAAG;YAAEC,OAAOF,QAAQE,KAAK;QAAC;IAClD;IAlBA,YAAYE,aAA4B,CAAE;QACxC,MAAMC,SAASD,cAAcE,GAAG,CAAS;QACzC,IAAI,CAACD,QAAQ;YACX,MAAM,IAAIE,MAAM;QAClB;QAEA,KAAK,CAAC;YACJC,gBAAgBC,uBAAU,CAACC,aAAa,CAAC;YACzCC,kBAAkB;YAClBC,aAAaP;QACf;IACF;AAQF"}