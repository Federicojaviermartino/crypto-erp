import{d as O}from"./chunk-R5763NNK.js";import{a as B,c as R,e as U,l as W,m as H,n as j,r as $}from"./chunk-OE3B74VB.js";import{a as G}from"./chunk-JU2KEDBD.js";import"./chunk-FXBJWTCM.js";import{$a as x,Da as g,Db as k,Fb as N,Gb as V,Ha as S,Ia as A,Ja as u,Ma as P,Na as w,Oa as e,Pa as t,Qa as D,Ra as f,Sa as m,Ta as p,U as T,Za as n,_a as _,aa as v,ba as C,bb as E,cb as h,db as I,fb as F,hb as y,jb as L,ra as r,sa as M,xa as b}from"./chunk-2V2B4KT2.js";import"./chunk-35PI25VP.js";var q=(a,l)=>l.id;function z(a,l){a&1&&(e(0,"div",19),D(1,"span",20),t())}function J(a,l){a&1&&(e(0,"span",24),n(1,"\u2713"),t())}function K(a,l){a&1&&(e(0,"span",29),n(1,"-"),t())}function Q(a,l){if(a&1){let i=f();e(0,"button",30),m("click",function(){v(i);let o=p().$implicit,c=p(2);return C(c.issueInvoice(o))}),n(1,"Emitir"),t()}}function X(a,l){if(a&1){let i=f();e(0,"button",31),m("click",function(){v(i);let o=p().$implicit,c=p(2);return C(c.markAsPaid(o))}),n(1,"Cobrar"),t()}}function Y(a,l){if(a&1&&(e(0,"tr")(1,"td")(2,"strong"),n(3),t()(),e(4,"td"),n(5),y(6,"date"),t(),e(7,"td"),n(8),t(),e(9,"td",22),n(10),y(11,"number"),t(),e(12,"td")(13,"span",23),n(14),t()(),e(15,"td"),g(16,J,2,0,"span",24)(17,K,2,0),t(),e(18,"td")(19,"div",25)(20,"button",26),n(21,"Ver"),t(),g(22,Q,2,0,"button",27)(23,X,2,0,"button",28),t()()()),a&2){let i=l.$implicit,s=p(2);r(3),_(i.invoiceNumber),r(2),_(L(6,10,i.date,"dd/MM/yyyy")),r(3),_(i.contact==null?null:i.contact.name),r(2),x("",L(11,13,i.totalAmount,"1.2-2")," \u20AC"),r(3),A(s.getStatusBadgeClass(i.status)),r(),x(" ",s.getStatusLabel(i.status)," "),r(2),u(16,i.verifactuHash?16:17),r(6),u(22,i.status==="DRAFT"?22:-1),r(),u(23,i.status==="ISSUED"?23:-1)}}function Z(a,l){a&1&&(e(0,"tr")(1,"td",32),n(2," No se encontraron facturas "),t()())}function ee(a,l){if(a&1&&(e(0,"table",21)(1,"thead")(2,"tr")(3,"th"),n(4,"N\xFAmero"),t(),e(5,"th"),n(6,"Fecha"),t(),e(7,"th"),n(8),t(),e(9,"th",22),n(10,"Importe"),t(),e(11,"th"),n(12,"Estado"),t(),e(13,"th"),n(14,"Verifactu"),t(),e(15,"th"),n(16,"Acciones"),t()()(),e(17,"tbody"),P(18,Y,24,16,"tr",null,q,!1,Z,3,0,"tr"),t()()),a&2){let i=p();r(8),_(i.direction==="SALES"?"Cliente":"Proveedor"),r(10),w(i.invoices())}}var de=(()=>{class a{api;invoices=b([]);loading=b(!0);searchTerm="";filterStatus="";direction="SALES";constructor(i){this.api=i}ngOnInit(){this.loadInvoices()}loadInvoices(){this.loading.set(!0);let i={direction:this.direction};this.searchTerm&&(i.search=this.searchTerm),this.filterStatus&&(i.status=this.filterStatus),this.api.get("/invoices",i).subscribe({next:s=>{this.invoices.set(s.invoices||[]),this.loading.set(!1)},error:()=>this.loading.set(!1)})}onSearch(){setTimeout(()=>this.loadInvoices(),300)}issueInvoice(i){this.api.patch(`/invoices/${i.id}/issue`,{}).subscribe({next:()=>this.loadInvoices()})}markAsPaid(i){this.api.patch(`/invoices/${i.id}/paid`,{}).subscribe({next:()=>this.loadInvoices()})}getStatusBadgeClass(i){return{DRAFT:"badge-warning",ISSUED:"badge-info",SENT:"badge-info",PAID:"badge-success",CANCELLED:"badge-danger"}[i]||"badge-secondary"}getStatusLabel(i){return{DRAFT:"Borrador",ISSUED:"Emitida",SENT:"Enviada",PAID:"Pagada",CANCELLED:"Cancelada"}[i]||i}static \u0275fac=function(s){return new(s||a)(M(G))};static \u0275cmp=T({type:a,selectors:[["app-invoices-list"]],standalone:!0,features:[F],decls:35,vars:7,consts:[[1,"page"],[1,"page-header"],[1,"text-muted"],[1,"d-flex","gap-md"],["routerLink","/invoicing/contacts",1,"btn","btn-secondary"],["routerLink","/invoicing/invoices/new",1,"btn","btn-primary"],[1,"tabs","mb-lg"],[1,"tab",3,"click"],[1,"filters","card"],[1,"card-body","d-flex","gap-md"],["type","text","placeholder","Buscar...",1,"form-input",2,"max-width","250px",3,"ngModelChange","ngModel"],[1,"form-select",2,"max-width","150px",3,"ngModelChange","ngModel"],["value",""],["value","DRAFT"],["value","ISSUED"],["value","PAID"],["value","CANCELLED"],[1,"card"],[1,"card-body",2,"padding","0"],[1,"text-center","p-lg"],[1,"spinner"],[1,"table"],[1,"text-right"],[1,"badge"],["title","Registrada en Verifactu",1,"badge","badge-success"],[1,"d-flex","gap-sm"],[1,"btn","btn-sm","btn-secondary"],[1,"btn","btn-sm","btn-primary"],[1,"btn","btn-sm","btn-success"],[1,"badge","badge-secondary"],[1,"btn","btn-sm","btn-primary",3,"click"],[1,"btn","btn-sm","btn-success",3,"click"],["colspan","7",1,"text-center","text-muted","p-lg"]],template:function(s,o){s&1&&(e(0,"div",0)(1,"header",1)(2,"div")(3,"h1"),n(4,"Facturas"),t(),e(5,"p",2),n(6,"Gestiona tus facturas de venta y compra"),t()(),e(7,"div",3)(8,"a",4),n(9,"Contactos"),t(),e(10,"a",5),n(11,"+ Nueva Factura"),t()()(),e(12,"div",6)(13,"button",7),m("click",function(){return o.direction="SALES",o.loadInvoices()}),n(14," Ventas "),t(),e(15,"button",7),m("click",function(){return o.direction="PURCHASE",o.loadInvoices()}),n(16," Compras "),t()(),e(17,"div",8)(18,"div",9)(19,"input",10),I("ngModelChange",function(d){return h(o.searchTerm,d)||(o.searchTerm=d),d}),m("ngModelChange",function(){return o.onSearch()}),t(),e(20,"select",11),I("ngModelChange",function(d){return h(o.filterStatus,d)||(o.filterStatus=d),d}),m("ngModelChange",function(){return o.loadInvoices()}),e(21,"option",12),n(22,"Todos los estados"),t(),e(23,"option",13),n(24,"Borrador"),t(),e(25,"option",14),n(26,"Emitida"),t(),e(27,"option",15),n(28,"Pagada"),t(),e(29,"option",16),n(30,"Cancelada"),t()()()(),e(31,"div",17)(32,"div",18),g(33,z,2,0,"div",19)(34,ee,21,2),t()()()),s&2&&(r(13),S("active",o.direction==="SALES"),r(2),S("active",o.direction==="PURCHASE"),r(4),E("ngModel",o.searchTerm),r(),E("ngModel",o.filterStatus),r(13),u(33,o.loading()?33:34))},dependencies:[V,N,k,O,$,H,j,B,W,R,U],styles:[".page[_ngcontent-%COMP%]{padding:var(--spacing-xl)}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:var(--spacing-lg)}.tabs[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);border-bottom:2px solid var(--gray-200);padding-bottom:var(--spacing-sm)}.tab[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-lg);background:none;border:none;cursor:pointer;font-weight:500;color:var(--gray-500);border-bottom:2px solid transparent;margin-bottom:-10px;transition:all var(--transition-fast)}.tab[_ngcontent-%COMP%]:hover{color:var(--gray-700)}.tab.active[_ngcontent-%COMP%]{color:var(--primary);border-bottom-color:var(--primary)}.filters[_ngcontent-%COMP%]{margin-bottom:var(--spacing-lg)}"]})}return a})();export{de as InvoicesListComponent};
