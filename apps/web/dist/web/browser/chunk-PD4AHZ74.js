import{a as E}from"./chunk-TRXNC6YO.js";import"./chunk-R5763NNK.js";import{a as y,b as f,c as F,d as N,f as M,h as T,k as O,q as A,s as V}from"./chunk-OE3B74VB.js";import{a as k}from"./chunk-JU2KEDBD.js";import"./chunk-FXBJWTCM.js";import{Da as u,Fa as g,Gb as P,Ja as m,Oa as i,Pa as t,Qa as l,Ra as h,Sa as x,Ta as p,U as b,Za as n,_a as S,aa as v,ba as _,fb as w,ra as a,sa as C,xa as d}from"./chunk-2V2B4KT2.js";import"./chunk-35PI25VP.js";function I(r,c){r&1&&(i(0,"div",3),l(1,"span",4),t())}function q(r,c){r&1&&(i(0,"div",16),n(1,"Perfil actualizado correctamente"),t())}function j(r,c){if(r&1&&(i(0,"div",17),n(1),t()),r&2){let e=p(2);a(),S(e.profileError())}}function D(r,c){r&1&&l(0,"span",4)}function z(r,c){r&1&&(i(0,"div",16),n(1,"Contrase\xF1a cambiada correctamente"),t())}function L(r,c){if(r&1&&(i(0,"div",17),n(1),t()),r&2){let e=p(2);a(),S(e.passwordError())}}function R(r,c){r&1&&l(0,"span",4)}function B(r,c){if(r&1){let e=h();i(0,"form",5),x("ngSubmit",function(){v(e);let s=p();return _(s.onSaveProfile())}),i(1,"div",6)(2,"div",7)(3,"h3"),n(4,"Informaci\xF3n Personal"),t()(),i(5,"div",8)(6,"div",9)(7,"div",10)(8,"label",11),n(9,"Nombre *"),t(),l(10,"input",12),t(),i(11,"div",10)(12,"label",11),n(13,"Apellidos *"),t(),l(14,"input",13),t()(),i(15,"div",10)(16,"label",11),n(17,"Email"),t(),l(18,"input",14),i(19,"small",15),n(20,"El email no se puede cambiar"),t()()()(),u(21,q,2,0,"div",16)(22,j,2,1,"div",17),i(23,"button",18),u(24,D,1,0,"span",4),n(25," Guardar Cambios "),t()(),i(26,"form",5),x("ngSubmit",function(){v(e);let s=p();return _(s.onChangePassword())}),i(27,"div",6)(28,"div",7)(29,"h3"),n(30,"Cambiar Contrase\xF1a"),t()(),i(31,"div",8)(32,"div",10)(33,"label",11),n(34,"Contrase\xF1a Actual *"),t(),l(35,"input",19),t(),i(36,"div",9)(37,"div",10)(38,"label",11),n(39,"Nueva Contrase\xF1a *"),t(),l(40,"input",20),i(41,"small",15),n(42,"M\xEDnimo 8 caracteres"),t()(),i(43,"div",10)(44,"label",11),n(45,"Confirmar Contrase\xF1a *"),t(),l(46,"input",21),t()()()(),u(47,z,2,0,"div",16)(48,L,2,1,"div",17),i(49,"button",22),u(50,R,1,0,"span",4),n(51," Cambiar Contrase\xF1a "),t()(),i(52,"div",23)(53,"div",24)(54,"h3"),n(55,"Sesiones Activas"),t(),i(56,"button",25),x("click",function(){v(e);let s=p();return _(s.logoutAllSessions())}),n(57," Cerrar Todas "),t()(),i(58,"div",8)(59,"div",26)(60,"div",27)(61,"div",28)(62,"span",29),n(63,"Este dispositivo"),t(),i(64,"span",30),n(65,"Sesi\xF3n actual"),t()(),i(66,"span",31),n(67,"Activa"),t()()()()()}if(r&2){let e=p();g("formGroup",e.profileForm),a(21),m(21,e.profileSuccess()?21:-1),a(),m(22,e.profileError()?22:-1),a(),g("disabled",e.savingProfile()),a(),m(24,e.savingProfile()?24:-1),a(2),g("formGroup",e.passwordForm),a(21),m(47,e.passwordSuccess()?47:-1),a(),m(48,e.passwordError()?48:-1),a(),g("disabled",e.savingPassword()),a(),m(50,e.savingPassword()?50:-1)}}var Z=(()=>{class r{fb;auth;api;profileForm;passwordForm;loading=d(!0);savingProfile=d(!1);savingPassword=d(!1);profileSuccess=d(!1);profileError=d(null);passwordSuccess=d(!1);passwordError=d(null);constructor(e,o,s){this.fb=e,this.auth=o,this.api=s,this.profileForm=this.fb.group({firstName:["",f.required],lastName:["",f.required],email:[{value:"",disabled:!0}]}),this.passwordForm=this.fb.group({currentPassword:["",f.required],newPassword:["",[f.required,f.minLength(8)]],confirmPassword:["",f.required]})}ngOnInit(){this.loadProfile()}loadProfile(){let e=this.auth.currentUser();e&&this.profileForm.patchValue({firstName:e.firstName,lastName:e.lastName,email:e.email}),this.loading.set(!1)}onSaveProfile(){if(this.profileForm.invalid){this.profileForm.markAllAsTouched();return}this.savingProfile.set(!0),this.profileSuccess.set(!1),this.profileError.set(null);let{firstName:e,lastName:o}=this.profileForm.getRawValue();this.api.put("/users/profile",{firstName:e,lastName:o}).subscribe({next:()=>{this.savingProfile.set(!1),this.profileSuccess.set(!0),setTimeout(()=>this.profileSuccess.set(!1),3e3)},error:s=>{this.savingProfile.set(!1),this.profileError.set(s.error?.message||"Error al guardar")}})}onChangePassword(){if(this.passwordForm.invalid){this.passwordForm.markAllAsTouched();return}let{currentPassword:e,newPassword:o,confirmPassword:s}=this.passwordForm.value;if(o!==s){this.passwordError.set("Las contrase\xF1as no coinciden");return}this.savingPassword.set(!0),this.passwordSuccess.set(!1),this.passwordError.set(null),this.api.post("/users/change-password",{currentPassword:e,newPassword:o}).subscribe({next:()=>{this.savingPassword.set(!1),this.passwordSuccess.set(!0),this.passwordForm.reset(),setTimeout(()=>this.passwordSuccess.set(!1),3e3)},error:G=>{this.savingPassword.set(!1),this.passwordError.set(G.error?.message||"Error al cambiar contrase\xF1a")}})}logoutAllSessions(){confirm("\xBFCerrar todas las sesiones? Tendr\xE1s que iniciar sesi\xF3n de nuevo.")&&this.auth.logout()}static \u0275fac=function(o){return new(o||r)(C(A),C(E),C(k))};static \u0275cmp=b({type:r,selectors:[["app-profile-settings"]],standalone:!0,features:[w],decls:8,vars:1,consts:[[1,"page"],[1,"page-header"],[1,"text-muted"],[1,"text-center","p-lg"],[1,"spinner"],[3,"ngSubmit","formGroup"],[1,"card","mb-lg"],[1,"card-header"],[1,"card-body"],[1,"form-row"],[1,"form-group"],[1,"form-label"],["type","text","formControlName","firstName",1,"form-input"],["type","text","formControlName","lastName",1,"form-input"],["type","email","formControlName","email",1,"form-input"],[1,"form-hint"],[1,"alert","alert-success","mb-lg"],[1,"alert","alert-danger","mb-lg"],["type","submit",1,"btn","btn-primary","mb-xl",3,"disabled"],["type","password","formControlName","currentPassword",1,"form-input"],["type","password","formControlName","newPassword",1,"form-input"],["type","password","formControlName","confirmPassword",1,"form-input"],["type","submit",1,"btn","btn-secondary",3,"disabled"],[1,"card","mt-xl"],[1,"card-header","d-flex","justify-between","align-center"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"session-list"],[1,"session-item","current"],[1,"session-info"],[1,"session-device"],[1,"session-details"],[1,"badge","badge-success"]],template:function(o,s){o&1&&(i(0,"div",0)(1,"header",1)(2,"h1"),n(3,"Mi Perfil"),t(),i(4,"p",2),n(5,"Gestiona tu informaci\xF3n personal y seguridad"),t()(),u(6,I,2,0,"div",3)(7,B,68,10),t()),o&2&&(a(6),m(6,s.loading()?6:7))},dependencies:[P,V,M,y,F,N,T,O],styles:[".page[_ngcontent-%COMP%]{padding:var(--spacing-xl);max-width:800px}.form-row[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-md)}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.form-hint[_ngcontent-%COMP%]{display:block;margin-top:var(--spacing-xs);font-size:.75rem;color:var(--gray-500)}.alert[_ngcontent-%COMP%]{padding:var(--spacing-md);border-radius:var(--radius-md)}.alert-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534}.alert-danger[_ngcontent-%COMP%]{background:#fee2e2;color:#991b1b}.session-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-md)}.session-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-md);background:var(--gray-50);border-radius:var(--radius-md)}.session-item.current[_ngcontent-%COMP%]{background:#eff6ff;border:1px solid var(--primary-light)}.session-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--spacing-xs)}.session-device[_ngcontent-%COMP%]{font-weight:500}.session-details[_ngcontent-%COMP%]{font-size:.875rem;color:var(--gray-500)}"]})}return r})();export{Z as ProfileSettingsComponent};
