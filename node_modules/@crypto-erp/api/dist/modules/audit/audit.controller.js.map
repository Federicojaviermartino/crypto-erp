{"version":3,"sources":["../../../src/modules/audit/audit.controller.ts"],"sourcesContent":["import { Controller, Get, Query, Param, UseGuards } from '@nestjs/common';\nimport { AuditService } from './audit.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { RolesGuard } from '../auth/guards/roles.guard';\nimport { Roles } from '../auth/decorators/roles.decorator';\nimport { GetUser } from '../auth/decorators/get-user.decorator';\nimport { GetCompany } from '../auth/decorators/get-company.decorator';\nimport { UserRole, AuditAction } from '@prisma/client';\n\n@Controller('audit')\n@UseGuards(JwtAuthGuard)\nexport class AuditController {\n  constructor(private readonly auditService: AuditService) {}\n\n  /**\n   * Get audit logs for a specific entity\n   * Only ADMIN, OWNER, and ACCOUNTANT can view audit logs\n   */\n  @Get('entity/:entity/:entityId')\n  @UseGuards(RolesGuard)\n  @Roles(UserRole.ADMIN, UserRole.OWNER, UserRole.ACCOUNTANT)\n  async getEntityAuditLogs(\n    @Param('entity') entity: string,\n    @Param('entityId') entityId: string,\n  ) {\n    return this.auditService.findByEntity(entity, entityId);\n  }\n\n  /**\n   * Get audit logs for current company\n   */\n  @Get('company')\n  @UseGuards(RolesGuard)\n  @Roles(UserRole.ADMIN, UserRole.OWNER, UserRole.ACCOUNTANT)\n  async getCompanyAuditLogs(\n    @GetCompany() companyId: string,\n    @Query('limit') limit?: string,\n    @Query('offset') offset?: string,\n    @Query('entity') entity?: string,\n    @Query('action') action?: AuditAction,\n  ) {\n    return this.auditService.findByCompany(companyId, {\n      limit: limit ? parseInt(limit, 10) : 100,\n      offset: offset ? parseInt(offset, 10) : 0,\n      entity,\n      action,\n    });\n  }\n\n  /**\n   * Get audit logs for current user\n   */\n  @Get('my-activity')\n  async getMyActivity(@GetUser('id') userId: string, @Query('limit') limit?: string) {\n    return this.auditService.findByUser(userId, limit ? parseInt(limit, 10) : 100);\n  }\n}\n"],"names":["AuditController","getEntityAuditLogs","entity","entityId","auditService","findByEntity","getCompanyAuditLogs","companyId","limit","offset","action","findByCompany","parseInt","getMyActivity","userId","findByUser","ADMIN","OWNER","ACCOUNTANT"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBAX4C;8BAC5B;8BACA;4BACF;gCACL;kCACE;qCACG;wBACW;;;;;;;;;;;;;;;AAI/B,IAAA,AAAMA,kBAAN,MAAMA;IAGX;;;GAGC,GACD,MAGMC,mBACJ,AAAiBC,MAAc,EAC/B,AAAmBC,QAAgB,EACnC;QACA,OAAO,IAAI,CAACC,YAAY,CAACC,YAAY,CAACH,QAAQC;IAChD;IAEA;;GAEC,GACD,MAGMG,oBACJ,AAAcC,SAAiB,EAC/B,AAAgBC,KAAc,EAC9B,AAAiBC,MAAe,EAChC,AAAiBP,MAAe,EAChC,AAAiBQ,MAAoB,EACrC;QACA,OAAO,IAAI,CAACN,YAAY,CAACO,aAAa,CAACJ,WAAW;YAChDC,OAAOA,QAAQI,SAASJ,OAAO,MAAM;YACrCC,QAAQA,SAASG,SAASH,QAAQ,MAAM;YACxCP;YACAQ;QACF;IACF;IAEA;;GAEC,GACD,MACMG,cAAc,AAAeC,MAAc,EAAE,AAAgBN,KAAc,EAAE;QACjF,OAAO,IAAI,CAACJ,YAAY,CAACW,UAAU,CAACD,QAAQN,QAAQI,SAASJ,OAAO,MAAM;IAC5E;IA3CA,YAAY,AAAiBJ,YAA0B,CAAE;aAA5BA,eAAAA;IAA6B;AA4C5D;;;;gDApCkBY,wBAAgBC,wBAAgBC;;;;;;;;;;;;;gDAahCF,wBAAgBC,wBAAgBC"}