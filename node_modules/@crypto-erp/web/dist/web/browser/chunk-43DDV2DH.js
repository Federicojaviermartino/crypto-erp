import{d as B}from"./chunk-R5763NNK.js";import{a as N,c as F,e as W,l as K,m as z,n as R,r as $}from"./chunk-OE3B74VB.js";import{a as j}from"./chunk-JU2KEDBD.js";import"./chunk-FXBJWTCM.js";import{$a as A,Da as h,Db as T,Fa as S,Fb as D,Gb as I,Ia as V,Ja as _,Ma as y,Na as w,Oa as t,Pa as n,Qa as k,Ra as M,Sa as g,Ta as l,U as P,Za as i,_a as x,aa as m,ba as p,bb as b,cb as C,db as v,fb as O,hb as f,jb as E,ra as c,sa as L,xa as u}from"./chunk-2V2B4KT2.js";import"./chunk-35PI25VP.js";var G=(o,s)=>s.id,Y=(o,s)=>s.asset;function q(o,s){o&1&&(t(0,"div",15),k(1,"span",17),n())}function H(o,s){if(o&1){let e=M();t(0,"tr")(1,"td")(2,"div",19)(3,"strong"),i(4),n(),t(5,"small"),i(6),n()()(),t(7,"td"),i(8),n(),t(9,"td")(10,"code"),i(11),n()(),t(12,"td")(13,"span",20),i(14),n()(),t(15,"td"),i(16),f(17,"date"),n(),t(18,"td")(19,"div",21)(20,"button",22),g("click",function(){let a=m(e).$implicit,d=l(2);return p(d.viewBalances(a))}),i(21," \u{1F4B0} "),n(),t(22,"button",23),g("click",function(){let a=m(e).$implicit,d=l(2);return p(d.syncAccount(a))}),i(23," \u{1F504} "),n(),t(24,"button",24),g("click",function(){let a=m(e).$implicit,d=l(2);return p(d.deleteAccount(a))}),i(25," \u{1F5D1}\uFE0F "),n()()()()}if(o&2){let e=s.$implicit,r=l(2);c(4),x(r.getExchangeName(e.exchange)),c(2),x(e.country),c(2),x(e.label),c(3),x(e.apiKey),c(2),V(r.getSyncStatusClass(e.syncStatus)),c(),A(" ",r.getSyncStatusLabel(e.syncStatus)," "),c(2),x(e.lastSyncAt?E(17,9,e.lastSyncAt,"short"):"Nunca"),c(6),S("disabled",e.syncStatus==="SYNCING")}}function J(o,s){o&1&&(t(0,"tr")(1,"td",25),i(2," No tienes exchanges conectados "),n()())}function Q(o,s){if(o&1&&(t(0,"table",18)(1,"thead")(2,"tr")(3,"th"),i(4,"Exchange"),n(),t(5,"th"),i(6,"Etiqueta"),n(),t(7,"th"),i(8,"API Key"),n(),t(9,"th"),i(10,"Estado"),n(),t(11,"th"),i(12,"\xDAltima Sync"),n(),t(13,"th"),i(14,"Acciones"),n()()(),t(15,"tbody"),y(16,H,26,12,"tr",null,G,!1,J,3,0,"tr"),n()()),o&2){let e=l();c(16),w(e.accounts())}}function U(o,s){if(o&1&&(t(0,"option",40),i(1),n()),o&2){let e=l().$implicit;S("value",e.id),c(),x(e.name)}}function X(o,s){if(o&1&&h(0,U,2,2,"option",40),o&2){let e=s.$implicit;_(0,e.supported?0:-1)}}function Z(o,s){if(o&1){let e=M();t(0,"div",26),g("click",function(){m(e);let a=l();return p(a.showAddModal=!1)}),t(1,"div",27),g("click",function(a){return m(e),p(a.stopPropagation())}),t(2,"div",28)(3,"h3"),i(4,"A\xF1adir Exchange"),n(),t(5,"button",29),g("click",function(){m(e);let a=l();return p(a.showAddModal=!1)}),i(6,"\xD7"),n()(),t(7,"div",30)(8,"div",31)(9,"label"),i(10,"Exchange"),n(),t(11,"select",32),v("ngModelChange",function(a){m(e);let d=l();return C(d.newAccount.exchange,a)||(d.newAccount.exchange=a),p(a)}),y(12,X,1,1,null,null,G),n()(),t(14,"div",31)(15,"label"),i(16,"Etiqueta (opcional)"),n(),t(17,"input",33),v("ngModelChange",function(a){m(e);let d=l();return C(d.newAccount.label,a)||(d.newAccount.label=a),p(a)}),n()(),t(18,"div",31)(19,"label"),i(20,"API Key"),n(),t(21,"input",34),v("ngModelChange",function(a){m(e);let d=l();return C(d.newAccount.apiKey,a)||(d.newAccount.apiKey=a),p(a)}),n()(),t(22,"div",31)(23,"label"),i(24,"API Secret"),n(),t(25,"input",35),v("ngModelChange",function(a){m(e);let d=l();return C(d.newAccount.apiSecret,a)||(d.newAccount.apiSecret=a),p(a)}),n()(),t(26,"div",36)(27,"strong"),i(28,"Permisos requeridos:"),n(),i(29," Solo lectura (Read-only). No necesitas permisos de trading o retiro. "),n()(),t(30,"div",37)(31,"button",38),g("click",function(){m(e);let a=l();return p(a.showAddModal=!1)}),i(32,"Cancelar"),n(),t(33,"button",39),g("click",function(){m(e);let a=l();return p(a.addAccount())}),i(34),n()()()()}if(o&2){let e=l();c(11),b("ngModel",e.newAccount.exchange),c(),w(e.supportedExchanges()),c(5),b("ngModel",e.newAccount.label),c(4),b("ngModel",e.newAccount.apiKey),c(4),b("ngModel",e.newAccount.apiSecret),c(8),S("disabled",!e.newAccount.exchange||!e.newAccount.apiKey||!e.newAccount.apiSecret||e.saving()),c(),A(" ",e.saving()?"Conectando...":"Conectar"," ")}}function ee(o,s){o&1&&(t(0,"div",15),k(1,"span",17),n())}function te(o,s){if(o&1&&(t(0,"tr")(1,"td")(2,"strong"),i(3),n()(),t(4,"td",42),i(5),f(6,"number"),n(),t(7,"td",42),i(8),f(9,"number"),n(),t(10,"td",42),i(11),f(12,"number"),n()()),o&2){let e=s.$implicit;c(3),x(e.asset),c(2),x(E(6,4,e.free,"1.8-8")),c(3),x(E(9,7,e.locked,"1.8-8")),c(3),x(E(12,10,e.total,"1.8-8"))}}function ne(o,s){o&1&&(t(0,"tr")(1,"td",43),i(2,"Sin saldos"),n()())}function ie(o,s){if(o&1&&(t(0,"table",18)(1,"thead")(2,"tr")(3,"th"),i(4,"Activo"),n(),t(5,"th",42),i(6,"Disponible"),n(),t(7,"th",42),i(8,"Bloqueado"),n(),t(9,"th",42),i(10,"Total"),n()()(),t(11,"tbody"),y(12,te,13,13,"tr",null,Y,!1,ne,3,0,"tr"),n()()),o&2){let e=l(2);c(12),w(e.balances())}}function ae(o,s){if(o&1){let e=M();t(0,"div",26),g("click",function(){m(e);let a=l();return p(a.showBalancesModal=!1)}),t(1,"div",41),g("click",function(a){return m(e),p(a.stopPropagation())}),t(2,"div",28)(3,"h3"),i(4),n(),t(5,"button",29),g("click",function(){m(e);let a=l();return p(a.showBalancesModal=!1)}),i(6,"\xD7"),n()(),t(7,"div",30),h(8,ee,2,0,"div",15)(9,ie,15,1),n(),t(10,"div",37)(11,"button",38),g("click",function(){m(e);let a=l();return p(a.showBalancesModal=!1)}),i(12,"Cerrar"),n()()()()}if(o&2){let e=l();c(4),A("Saldos - ",e.selectedAccount==null?null:e.selectedAccount.label,""),c(4),_(8,e.loadingBalances()?8:9)}}var xe=(()=>{class o{api;accounts=u([]);supportedExchanges=u([]);balances=u([]);loading=u(!0);saving=u(!1);loadingBalances=u(!1);showAddModal=!1;showBalancesModal=!1;selectedAccount=null;newAccount={exchange:"binance",label:"",apiKey:"",apiSecret:""};constructor(e){this.api=e}ngOnInit(){this.loadSupportedExchanges(),this.loadAccounts()}loadSupportedExchanges(){this.api.get("/crypto/exchanges/supported").subscribe({next:e=>this.supportedExchanges.set(e)})}loadAccounts(){this.loading.set(!0),this.api.get("/crypto/exchanges/accounts").subscribe({next:e=>{this.accounts.set(e),this.loading.set(!1)},error:()=>this.loading.set(!1)})}getExchangeName(e){return this.supportedExchanges().find(a=>a.id===e)?.name||e}getSyncStatusClass(e){return{SYNCED:"badge-success",SYNCING:"badge-info",PENDING:"badge-warning",ERROR:"badge-danger"}[e]||"badge-secondary"}getSyncStatusLabel(e){return{SYNCED:"Sincronizado",SYNCING:"Sincronizando...",PENDING:"Pendiente",ERROR:"Error"}[e]||e}addAccount(){!this.newAccount.exchange||!this.newAccount.apiKey||!this.newAccount.apiSecret||(this.saving.set(!0),this.api.post("/crypto/exchanges/accounts",this.newAccount).subscribe({next:()=>{this.showAddModal=!1,this.newAccount={exchange:"binance",label:"",apiKey:"",apiSecret:""},this.loadAccounts(),this.saving.set(!1)},error:()=>this.saving.set(!1)}))}viewBalances(e){this.selectedAccount=e,this.showBalancesModal=!0,this.loadingBalances.set(!0),this.api.get(`/crypto/exchanges/accounts/${e.id}/balances`).subscribe({next:r=>{this.balances.set(r),this.loadingBalances.set(!1)},error:()=>{this.balances.set([]),this.loadingBalances.set(!1)}})}syncAccount(e){this.api.post(`/crypto/exchanges/accounts/${e.id}/sync/all`,{}).subscribe({next:r=>{alert(`Sincronizaci\xF3n completada:
- Trades: ${r.trades}
- Dep\xF3sitos: ${r.deposits}
- Retiros: ${r.withdrawals}`),this.loadAccounts()},error:r=>{alert("Error al sincronizar: "+r.message)}})}deleteAccount(e){confirm(`\xBFEliminar la conexi\xF3n con ${e.label}?`)&&this.api.delete(`/crypto/exchanges/accounts/${e.id}`).subscribe({next:()=>this.loadAccounts()})}static \u0275fac=function(r){return new(r||o)(L(j))};static \u0275cmp=P({type:o,selectors:[["app-exchanges-list"]],standalone:!0,features:[O],decls:32,vars:3,consts:[[1,"page"],[1,"page-header"],[1,"text-muted"],[1,"d-flex","gap-md"],[1,"btn","btn-primary",3,"click"],[1,"nav-tabs","mb-lg"],["routerLink","/crypto/portfolio",1,"nav-tab"],["routerLink","/crypto/wallets",1,"nav-tab"],["routerLink","/crypto/exchanges",1,"nav-tab","active"],["routerLink","/crypto/transactions",1,"nav-tab"],["routerLink","/crypto/assets",1,"nav-tab"],["routerLink","/crypto/tax-report",1,"nav-tab"],[1,"card","mb-lg"],[1,"card-header"],[1,"card-body",2,"padding","0"],[1,"text-center","p-lg"],[1,"modal-overlay"],[1,"spinner"],[1,"table"],[1,"exchange-info"],[1,"badge"],[1,"d-flex","gap-sm"],["title","Ver saldos",1,"btn","btn-sm","btn-secondary",3,"click"],["title","Sincronizar",1,"btn","btn-sm","btn-primary",3,"click","disabled"],["title","Eliminar",1,"btn","btn-sm","btn-danger",3,"click"],["colspan","6",1,"text-center","text-muted","p-lg"],[1,"modal-overlay",3,"click"],[1,"modal",3,"click"],[1,"modal-header"],[1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-group"],[1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Mi cuenta principal",1,"form-control",3,"ngModelChange","ngModel"],["type","text","placeholder","Tu API Key",1,"form-control",3,"ngModelChange","ngModel"],["type","password","placeholder","Tu API Secret",1,"form-control",3,"ngModelChange","ngModel"],[1,"alert","alert-info"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],[3,"value"],[1,"modal","modal-lg",3,"click"],[1,"text-right"],["colspan","4",1,"text-center","text-muted"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"header",1)(2,"div")(3,"h1"),i(4,"Exchanges"),n(),t(5,"p",2),i(6,"Conecta tus cuentas de exchanges para importar transacciones"),n()(),t(7,"div",3)(8,"button",4),g("click",function(){return a.showAddModal=!0}),i(9,"+ A\xF1adir Exchange"),n()()(),t(10,"div",5)(11,"a",6),i(12,"Portfolio"),n(),t(13,"a",7),i(14,"Wallets"),n(),t(15,"a",8),i(16,"Exchanges"),n(),t(17,"a",9),i(18,"Transacciones"),n(),t(19,"a",10),i(20,"Activos"),n(),t(21,"a",11),i(22,"Informe Fiscal"),n()(),t(23,"div",12)(24,"div",13)(25,"h3"),i(26,"Exchanges Conectados"),n()(),t(27,"div",14),h(28,q,2,0,"div",15)(29,Q,19,1),n()(),h(30,Z,35,6,"div",16)(31,ae,13,2,"div",16),n()),r&2&&(c(28),_(28,a.loading()?28:29),c(2),_(30,a.showAddModal?30:-1),c(),_(31,a.showBalancesModal?31:-1))},dependencies:[I,D,T,B,$,z,R,N,K,F,W],styles:[".page[_ngcontent-%COMP%]{padding:var(--spacing-xl)}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:var(--spacing-xl)}.nav-tabs[_ngcontent-%COMP%]{display:flex;gap:var(--spacing-sm);border-bottom:2px solid var(--gray-200);padding-bottom:var(--spacing-sm)}.nav-tab[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-lg);color:var(--gray-500);text-decoration:none;border-bottom:2px solid transparent;margin-bottom:-10px;transition:all var(--transition-fast)}.nav-tab[_ngcontent-%COMP%]:hover{color:var(--gray-700)}.nav-tab.active[_ngcontent-%COMP%]{color:var(--primary);border-bottom-color:var(--primary)}.exchange-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.exchange-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--gray-500)}.badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:var(--radius-sm);font-size:.75rem;font-weight:500}.badge.badge-success[_ngcontent-%COMP%]{background:var(--success-light);color:var(--success)}.badge.badge-warning[_ngcontent-%COMP%]{background:var(--warning-light);color:var(--warning)}.badge.badge-danger[_ngcontent-%COMP%]{background:var(--danger-light);color:var(--danger)}.badge.badge-info[_ngcontent-%COMP%]{background:var(--info-light);color:var(--info)}.modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#00000080;display:flex;align-items:center;justify-content:center;z-index:1000}.modal[_ngcontent-%COMP%]{background:var(--white);border-radius:var(--radius-lg);width:100%;max-width:500px;max-height:90vh;overflow:auto;box-shadow:var(--shadow-lg)}.modal.modal-lg[_ngcontent-%COMP%]{max-width:700px}.modal-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:var(--spacing-lg);border-bottom:1px solid var(--gray-200)}.modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.btn-close[_ngcontent-%COMP%]{background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--gray-500)}.btn-close[_ngcontent-%COMP%]:hover{color:var(--gray-700)}.modal-body[_ngcontent-%COMP%]{padding:var(--spacing-lg)}.modal-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:var(--spacing-md);padding:var(--spacing-lg);border-top:1px solid var(--gray-200)}.form-group[_ngcontent-%COMP%]{margin-bottom:var(--spacing-md)}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:var(--spacing-xs);font-weight:500}.form-control[_ngcontent-%COMP%]{width:100%;padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--gray-300);border-radius:var(--radius-md);font-size:1rem}.form-control[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-light)}.alert[_ngcontent-%COMP%]{padding:var(--spacing-md);border-radius:var(--radius-md);margin-top:var(--spacing-md)}.alert.alert-info[_ngcontent-%COMP%]{background:var(--info-light);color:var(--info);border:1px solid var(--info)}code[_ngcontent-%COMP%]{background:var(--gray-100);padding:2px 6px;border-radius:var(--radius-sm);font-family:monospace}"]})}return o})();export{xe as ExchangesListComponent};
