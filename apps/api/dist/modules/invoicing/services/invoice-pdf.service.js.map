{"version":3,"sources":["../../../../src/modules/invoicing/services/invoice-pdf.service.ts"],"sourcesContent":["import { Injectable, Logger, NotFoundException } from '@nestjs/common';\nimport { PrismaService } from '@crypto-erp/database';\nimport PDFDocument from 'pdfkit';\nimport * as QRCode from 'qrcode';\nimport { Readable } from 'stream';\n\ninterface InvoiceForPDF {\n  id: string;\n  invoiceNumber: string;\n  type: string;\n  direction: string;\n  date: Date;\n  dueDate: Date | null;\n  status: string;\n  subtotal: { toNumber: () => number };\n  vatAmount: { toNumber: () => number };\n  totalAmount: { toNumber: () => number };\n  notes: string | null;\n  verifactuHash: string | null;\n  metadata: Record<string, unknown> | null;\n  lines: Array<{\n    lineNumber: number;\n    description: string;\n    quantity: { toNumber: () => number };\n    unitPrice: { toNumber: () => number };\n    vatRate: { toNumber: () => number };\n    discountPercent: { toNumber: () => number };\n    lineTotal: { toNumber: () => number };\n  }>;\n  contact: {\n    id: string;\n    name: string;\n    taxId: string | null;\n    email: string | null;\n    address: string | null;\n    city: string | null;\n    postalCode: string | null;\n    country: string | null;\n  };\n  company: {\n    id: string;\n    name: string;\n    taxId: string;\n    address: string | null;\n    city: string | null;\n    postalCode: string | null;\n    country: string | null;\n    phone: string | null;\n    email: string | null;\n  };\n  series: {\n    prefix: string;\n    name: string;\n  } | null;\n}\n\ninterface PDFOptions {\n  language?: 'es' | 'en';\n  includeQR?: boolean;\n  includeLogo?: boolean;\n  logoPath?: string;\n}\n\nconst TRANSLATIONS = {\n  es: {\n    invoice: 'FACTURA',\n    simplifiedInvoice: 'FACTURA SIMPLIFICADA',\n    creditNote: 'FACTURA RECTIFICATIVA',\n    invoiceNumber: 'N\\u00ba Factura',\n    date: 'Fecha',\n    dueDate: 'Vencimiento',\n    from: 'De',\n    to: 'Para',\n    taxId: 'NIF/CIF',\n    description: 'Descripci\\u00f3n',\n    quantity: 'Cant.',\n    unitPrice: 'Precio',\n    vatRate: 'IVA %',\n    discount: 'Dto.',\n    lineTotal: 'Total',\n    subtotal: 'Base Imponible',\n    vatAmount: 'IVA',\n    total: 'TOTAL',\n    notes: 'Notas',\n    paymentTerms: 'Condiciones de pago',\n    verifactuFooter: 'Factura verificable en la AEAT',\n    verifactuHash: 'Huella Verifactu',\n    page: 'P\\u00e1gina',\n    of: 'de',\n    status: {\n      DRAFT: 'Borrador',\n      ISSUED: 'Emitida',\n      SENT: 'Enviada',\n      PAID: 'Pagada',\n      CANCELLED: 'Anulada',\n    },\n  },\n  en: {\n    invoice: 'INVOICE',\n    simplifiedInvoice: 'SIMPLIFIED INVOICE',\n    creditNote: 'CREDIT NOTE',\n    invoiceNumber: 'Invoice No.',\n    date: 'Date',\n    dueDate: 'Due Date',\n    from: 'From',\n    to: 'To',\n    taxId: 'Tax ID',\n    description: 'Description',\n    quantity: 'Qty',\n    unitPrice: 'Price',\n    vatRate: 'VAT %',\n    discount: 'Disc.',\n    lineTotal: 'Total',\n    subtotal: 'Subtotal',\n    vatAmount: 'VAT',\n    total: 'TOTAL',\n    notes: 'Notes',\n    paymentTerms: 'Payment Terms',\n    verifactuFooter: 'Invoice verifiable at AEAT',\n    verifactuHash: 'Verifactu Hash',\n    page: 'Page',\n    of: 'of',\n    status: {\n      DRAFT: 'Draft',\n      ISSUED: 'Issued',\n      SENT: 'Sent',\n      PAID: 'Paid',\n      CANCELLED: 'Cancelled',\n    },\n  },\n};\n\n@Injectable()\nexport class InvoicePdfService {\n  private readonly logger = new Logger(InvoicePdfService.name);\n\n  // Colors\n  private readonly PRIMARY_COLOR = '#1a365d';\n  private readonly SECONDARY_COLOR = '#4a5568';\n  private readonly ACCENT_COLOR = '#3182ce';\n  private readonly LIGHT_GRAY = '#e2e8f0';\n\n  constructor(private readonly prisma: PrismaService) {}\n\n  /**\n   * Genera el PDF de una factura\n   */\n  async generatePdf(\n    companyId: string,\n    invoiceId: string,\n    options: PDFOptions = {},\n  ): Promise<Buffer> {\n    const invoice = await this.getInvoiceData(companyId, invoiceId);\n    const lang = options.language || 'es';\n    const t = TRANSLATIONS[lang];\n\n    return new Promise((resolve, reject) => {\n      const chunks: Buffer[] = [];\n\n      const doc = new PDFDocument({\n        size: 'A4',\n        margin: 50,\n        info: {\n          Title: `${t.invoice} ${invoice.invoiceNumber}`,\n          Author: invoice.company.name,\n          Subject: `${t.invoice} para ${invoice.contact.name}`,\n          Creator: 'Crypto ERP - Sistema de Facturaci\\u00f3n',\n        },\n      });\n\n      doc.on('data', (chunk: Buffer) => chunks.push(chunk));\n      doc.on('end', () => resolve(Buffer.concat(chunks)));\n      doc.on('error', reject);\n\n      // Generate PDF content\n      this.renderPdf(doc, invoice, t, options);\n\n      doc.end();\n    });\n  }\n\n  /**\n   * Genera el PDF como stream\n   */\n  async generatePdfStream(\n    companyId: string,\n    invoiceId: string,\n    options: PDFOptions = {},\n  ): Promise<Readable> {\n    const invoice = await this.getInvoiceData(companyId, invoiceId);\n    const lang = options.language || 'es';\n    const t = TRANSLATIONS[lang];\n\n    const doc = new PDFDocument({\n      size: 'A4',\n      margin: 50,\n    });\n\n    // Render in next tick to allow stream to be returned\n    setImmediate(() => {\n      this.renderPdf(doc, invoice, t, options);\n      doc.end();\n    });\n\n    return doc as unknown as Readable;\n  }\n\n  /**\n   * Obtiene los datos de la factura para el PDF\n   */\n  private async getInvoiceData(companyId: string, invoiceId: string): Promise<InvoiceForPDF> {\n    const invoice = await this.prisma.invoice.findFirst({\n      where: { id: invoiceId, companyId },\n      include: {\n        lines: {\n          orderBy: { lineNumber: 'asc' },\n        },\n        contact: true,\n        company: true,\n        series: true,\n      },\n    });\n\n    if (!invoice) {\n      throw new NotFoundException(`Invoice ${invoiceId} not found`);\n    }\n\n    return invoice as unknown as InvoiceForPDF;\n  }\n\n  /**\n   * Renderiza el contenido del PDF\n   */\n  private async renderPdf(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n    options: PDFOptions,\n  ): Promise<void> {\n    const pageWidth = doc.page.width - 100; // 50px margin on each side\n\n    // Header\n    this.renderHeader(doc, invoice, t, pageWidth);\n\n    // Company and client info\n    this.renderParties(doc, invoice, t);\n\n    // Line items table\n    this.renderLineItems(doc, invoice, t, pageWidth);\n\n    // Totals\n    this.renderTotals(doc, invoice, t);\n\n    // Notes\n    if (invoice.notes) {\n      this.renderNotes(doc, invoice, t);\n    }\n\n    // Verifactu footer with QR\n    if (invoice.verifactuHash || invoice.metadata?.huella) {\n      await this.renderVerifactuFooter(doc, invoice, t, options.includeQR !== false);\n    }\n\n    // Page numbers\n    this.addPageNumbers(doc, t);\n  }\n\n  /**\n   * Renderiza el encabezado\n   */\n  private renderHeader(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n    pageWidth: number,\n  ): void {\n    const startY = doc.y;\n\n    // Invoice type title\n    let title = t.invoice;\n    if (invoice.type === 'SIMPLIFIED') title = t.simplifiedInvoice;\n    if (invoice.type === 'CREDIT_NOTE') title = t.creditNote;\n\n    doc\n      .fillColor(this.PRIMARY_COLOR)\n      .fontSize(24)\n      .font('Helvetica-Bold')\n      .text(title, 50, startY);\n\n    // Invoice number and dates on the right\n    const rightColumnX = 350;\n\n    doc\n      .fontSize(10)\n      .font('Helvetica')\n      .fillColor(this.SECONDARY_COLOR)\n      .text(`${t.invoiceNumber}:`, rightColumnX, startY)\n      .font('Helvetica-Bold')\n      .fillColor(this.PRIMARY_COLOR)\n      .text(invoice.invoiceNumber, rightColumnX + 80, startY);\n\n    doc\n      .font('Helvetica')\n      .fillColor(this.SECONDARY_COLOR)\n      .text(`${t.date}:`, rightColumnX, startY + 15)\n      .fillColor(this.PRIMARY_COLOR)\n      .text(this.formatDate(invoice.date), rightColumnX + 80, startY + 15);\n\n    if (invoice.dueDate) {\n      doc\n        .fillColor(this.SECONDARY_COLOR)\n        .text(`${t.dueDate}:`, rightColumnX, startY + 30)\n        .fillColor(this.PRIMARY_COLOR)\n        .text(this.formatDate(invoice.dueDate), rightColumnX + 80, startY + 30);\n    }\n\n    // Status badge\n    const statusText = t.status[invoice.status as keyof typeof t.status] || invoice.status;\n    const statusColor = this.getStatusColor(invoice.status);\n\n    doc\n      .roundedRect(rightColumnX, startY + 50, 100, 20, 3)\n      .fill(statusColor);\n\n    doc\n      .fillColor('#ffffff')\n      .fontSize(10)\n      .font('Helvetica-Bold')\n      .text(statusText, rightColumnX + 10, startY + 55, { width: 80, align: 'center' });\n\n    doc.moveDown(4);\n  }\n\n  /**\n   * Renderiza la informaci\\u00f3n de emisor y receptor\n   */\n  private renderParties(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n  ): void {\n    const startY = doc.y;\n    const leftColumnX = 50;\n    const rightColumnX = 320;\n\n    // From (Company)\n    doc\n      .fontSize(10)\n      .font('Helvetica-Bold')\n      .fillColor(this.ACCENT_COLOR)\n      .text(t.from, leftColumnX, startY);\n\n    doc\n      .fontSize(12)\n      .font('Helvetica-Bold')\n      .fillColor(this.PRIMARY_COLOR)\n      .text(invoice.company.name, leftColumnX, startY + 15);\n\n    doc\n      .fontSize(9)\n      .font('Helvetica')\n      .fillColor(this.SECONDARY_COLOR);\n\n    let companyY = startY + 30;\n    doc.text(`${t.taxId}: ${invoice.company.taxId}`, leftColumnX, companyY);\n    companyY += 12;\n\n    if (invoice.company.address) {\n      doc.text(invoice.company.address, leftColumnX, companyY);\n      companyY += 12;\n    }\n\n    if (invoice.company.postalCode || invoice.company.city) {\n      doc.text(\n        `${invoice.company.postalCode || ''} ${invoice.company.city || ''}`.trim(),\n        leftColumnX,\n        companyY,\n      );\n      companyY += 12;\n    }\n\n    if (invoice.company.email) {\n      doc.text(invoice.company.email, leftColumnX, companyY);\n    }\n\n    // To (Contact)\n    doc\n      .fontSize(10)\n      .font('Helvetica-Bold')\n      .fillColor(this.ACCENT_COLOR)\n      .text(t.to, rightColumnX, startY);\n\n    doc\n      .fontSize(12)\n      .font('Helvetica-Bold')\n      .fillColor(this.PRIMARY_COLOR)\n      .text(invoice.contact.name, rightColumnX, startY + 15);\n\n    doc\n      .fontSize(9)\n      .font('Helvetica')\n      .fillColor(this.SECONDARY_COLOR);\n\n    let contactY = startY + 30;\n\n    if (invoice.contact.taxId) {\n      doc.text(`${t.taxId}: ${invoice.contact.taxId}`, rightColumnX, contactY);\n      contactY += 12;\n    }\n\n    if (invoice.contact.address) {\n      doc.text(invoice.contact.address, rightColumnX, contactY);\n      contactY += 12;\n    }\n\n    if (invoice.contact.postalCode || invoice.contact.city) {\n      doc.text(\n        `${invoice.contact.postalCode || ''} ${invoice.contact.city || ''}`.trim(),\n        rightColumnX,\n        contactY,\n      );\n      contactY += 12;\n    }\n\n    if (invoice.contact.email) {\n      doc.text(invoice.contact.email, rightColumnX, contactY);\n    }\n\n    doc.y = Math.max(companyY, contactY) + 30;\n  }\n\n  /**\n   * Renderiza la tabla de l\\u00edneas\n   */\n  private renderLineItems(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n    pageWidth: number,\n  ): void {\n    const startY = doc.y;\n    const tableTop = startY + 10;\n\n    // Column widths\n    const cols = {\n      description: { x: 50, width: 200 },\n      quantity: { x: 255, width: 50 },\n      unitPrice: { x: 310, width: 70 },\n      vatRate: { x: 385, width: 45 },\n      discount: { x: 435, width: 45 },\n      total: { x: 485, width: 70 },\n    };\n\n    // Table header\n    doc\n      .rect(50, tableTop, pageWidth, 20)\n      .fill(this.PRIMARY_COLOR);\n\n    doc\n      .fontSize(9)\n      .font('Helvetica-Bold')\n      .fillColor('#ffffff');\n\n    doc.text(t.description, cols.description.x + 5, tableTop + 6);\n    doc.text(t.quantity, cols.quantity.x, tableTop + 6, { width: cols.quantity.width, align: 'right' });\n    doc.text(t.unitPrice, cols.unitPrice.x, tableTop + 6, { width: cols.unitPrice.width, align: 'right' });\n    doc.text(t.vatRate, cols.vatRate.x, tableTop + 6, { width: cols.vatRate.width, align: 'right' });\n    doc.text(t.discount, cols.discount.x, tableTop + 6, { width: cols.discount.width, align: 'right' });\n    doc.text(t.lineTotal, cols.total.x, tableTop + 6, { width: cols.total.width, align: 'right' });\n\n    // Table rows\n    let rowY = tableTop + 25;\n\n    invoice.lines.forEach((line, index) => {\n      // Alternate row background\n      if (index % 2 === 0) {\n        doc.rect(50, rowY - 3, pageWidth, 18).fill('#f7fafc');\n      }\n\n      doc\n        .fontSize(9)\n        .font('Helvetica')\n        .fillColor(this.SECONDARY_COLOR);\n\n      // Description (may need word wrap)\n      const description = line.description.length > 40\n        ? line.description.substring(0, 40) + '...'\n        : line.description;\n\n      doc.text(description, cols.description.x + 5, rowY);\n      doc.text(\n        line.quantity.toNumber().toString(),\n        cols.quantity.x,\n        rowY,\n        { width: cols.quantity.width, align: 'right' },\n      );\n      doc.text(\n        this.formatCurrency(line.unitPrice.toNumber()),\n        cols.unitPrice.x,\n        rowY,\n        { width: cols.unitPrice.width, align: 'right' },\n      );\n      doc.text(\n        `${line.vatRate.toNumber()}%`,\n        cols.vatRate.x,\n        rowY,\n        { width: cols.vatRate.width, align: 'right' },\n      );\n      doc.text(\n        line.discountPercent.toNumber() > 0 ? `${line.discountPercent.toNumber()}%` : '-',\n        cols.discount.x,\n        rowY,\n        { width: cols.discount.width, align: 'right' },\n      );\n      doc.text(\n        this.formatCurrency(line.lineTotal.toNumber()),\n        cols.total.x,\n        rowY,\n        { width: cols.total.width, align: 'right' },\n      );\n\n      rowY += 18;\n\n      // Check if we need a new page\n      if (rowY > doc.page.height - 200) {\n        doc.addPage();\n        rowY = 50;\n      }\n    });\n\n    // Table bottom border\n    doc\n      .moveTo(50, rowY + 5)\n      .lineTo(50 + pageWidth, rowY + 5)\n      .stroke(this.LIGHT_GRAY);\n\n    doc.y = rowY + 20;\n  }\n\n  /**\n   * Renderiza los totales\n   */\n  private renderTotals(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n  ): void {\n    const startY = doc.y;\n    const rightX = 400;\n    const valueX = 500;\n\n    doc\n      .fontSize(10)\n      .font('Helvetica')\n      .fillColor(this.SECONDARY_COLOR);\n\n    // Subtotal\n    doc.text(t.subtotal, rightX, startY);\n    doc.text(\n      this.formatCurrency(invoice.subtotal.toNumber()),\n      valueX,\n      startY,\n      { width: 55, align: 'right' },\n    );\n\n    // VAT\n    doc.text(t.vatAmount, rightX, startY + 18);\n    doc.text(\n      this.formatCurrency(invoice.vatAmount.toNumber()),\n      valueX,\n      startY + 18,\n      { width: 55, align: 'right' },\n    );\n\n    // Total line\n    doc\n      .moveTo(rightX, startY + 38)\n      .lineTo(555, startY + 38)\n      .stroke(this.PRIMARY_COLOR);\n\n    // Total\n    doc\n      .fontSize(14)\n      .font('Helvetica-Bold')\n      .fillColor(this.PRIMARY_COLOR)\n      .text(t.total, rightX, startY + 45);\n\n    doc.text(\n      this.formatCurrency(invoice.totalAmount.toNumber()),\n      valueX,\n      startY + 45,\n      { width: 55, align: 'right' },\n    );\n\n    doc.y = startY + 80;\n  }\n\n  /**\n   * Renderiza las notas\n   */\n  private renderNotes(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n  ): void {\n    const startY = doc.y;\n\n    doc\n      .fontSize(10)\n      .font('Helvetica-Bold')\n      .fillColor(this.SECONDARY_COLOR)\n      .text(t.notes, 50, startY);\n\n    doc\n      .fontSize(9)\n      .font('Helvetica')\n      .text(invoice.notes!, 50, startY + 15, { width: 400 });\n\n    doc.moveDown(2);\n  }\n\n  /**\n   * Renderiza el footer con Verifactu\n   */\n  private async renderVerifactuFooter(\n    doc: PDFKit.PDFDocument,\n    invoice: InvoiceForPDF,\n    t: typeof TRANSLATIONS['es'],\n    includeQR: boolean,\n  ): Promise<void> {\n    const footerY = doc.page.height - 120;\n    const hash = (invoice.verifactuHash || invoice.metadata?.huella) as string;\n    const urlVerificacion = invoice.metadata?.urlVerificacion as string;\n\n    // Separator line\n    doc\n      .moveTo(50, footerY - 10)\n      .lineTo(545, footerY - 10)\n      .stroke(this.LIGHT_GRAY);\n\n    // Verifactu badge\n    doc\n      .rect(50, footerY, 100, 20)\n      .fill(this.ACCENT_COLOR);\n\n    doc\n      .fontSize(8)\n      .font('Helvetica-Bold')\n      .fillColor('#ffffff')\n      .text('VERIFACTU', 60, footerY + 6);\n\n    // Hash info\n    doc\n      .fontSize(8)\n      .font('Helvetica')\n      .fillColor(this.SECONDARY_COLOR)\n      .text(`${t.verifactuHash}: ${hash.substring(0, 32)}...`, 160, footerY + 6);\n\n    doc\n      .fontSize(7)\n      .text(t.verifactuFooter, 50, footerY + 30);\n\n    // QR Code\n    if (includeQR && urlVerificacion) {\n      try {\n        const qrDataUrl = await QRCode.toDataURL(urlVerificacion, {\n          width: 80,\n          margin: 1,\n          color: {\n            dark: this.PRIMARY_COLOR,\n            light: '#ffffff',\n          },\n        });\n\n        const qrBuffer = Buffer.from(qrDataUrl.split(',')[1], 'base64');\n        doc.image(qrBuffer, 480, footerY - 5, { width: 60, height: 60 });\n      } catch (error) {\n        this.logger.warn(`Failed to generate QR code: ${error}`);\n      }\n    }\n  }\n\n  /**\n   * A\\u00f1ade n\\u00fameros de p\\u00e1gina\n   */\n  private addPageNumbers(doc: PDFKit.PDFDocument, t: typeof TRANSLATIONS['es']): void {\n    const pages = doc.bufferedPageRange();\n\n    for (let i = 0; i < pages.count; i++) {\n      doc.switchToPage(i);\n\n      doc\n        .fontSize(8)\n        .font('Helvetica')\n        .fillColor(this.SECONDARY_COLOR)\n        .text(\n          `${t.page} ${i + 1} ${t.of} ${pages.count}`,\n          50,\n          doc.page.height - 30,\n          { align: 'center', width: doc.page.width - 100 },\n        );\n    }\n  }\n\n  // Helpers\n\n  private formatDate(date: Date): string {\n    return new Date(date).toLocaleDateString('es-ES', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n    });\n  }\n\n  private formatCurrency(amount: number): string {\n    return new Intl.NumberFormat('es-ES', {\n      style: 'currency',\n      currency: 'EUR',\n    }).format(amount);\n  }\n\n  private getStatusColor(status: string): string {\n    const colors: Record<string, string> = {\n      DRAFT: '#718096',\n      ISSUED: '#3182ce',\n      SENT: '#38a169',\n      PAID: '#2f855a',\n      CANCELLED: '#e53e3e',\n    };\n    return colors[status] || '#718096';\n  }\n}\n"],"names":["InvoicePdfService","TRANSLATIONS","es","invoice","simplifiedInvoice","creditNote","invoiceNumber","date","dueDate","from","to","taxId","description","quantity","unitPrice","vatRate","discount","lineTotal","subtotal","vatAmount","total","notes","paymentTerms","verifactuFooter","verifactuHash","page","of","status","DRAFT","ISSUED","SENT","PAID","CANCELLED","en","generatePdf","companyId","invoiceId","options","getInvoiceData","lang","language","t","Promise","resolve","reject","chunks","doc","PDFDocument","size","margin","info","Title","Author","company","name","Subject","contact","Creator","on","chunk","push","Buffer","concat","renderPdf","end","generatePdfStream","setImmediate","prisma","findFirst","where","id","include","lines","orderBy","lineNumber","series","NotFoundException","pageWidth","width","renderHeader","renderParties","renderLineItems","renderTotals","renderNotes","metadata","huella","renderVerifactuFooter","includeQR","addPageNumbers","startY","y","title","type","fillColor","PRIMARY_COLOR","fontSize","font","text","rightColumnX","SECONDARY_COLOR","formatDate","statusText","statusColor","getStatusColor","roundedRect","fill","align","moveDown","leftColumnX","ACCENT_COLOR","companyY","address","postalCode","city","trim","email","contactY","Math","max","tableTop","cols","x","rect","rowY","forEach","line","index","length","substring","toNumber","toString","formatCurrency","discountPercent","height","addPage","moveTo","lineTo","stroke","LIGHT_GRAY","rightX","valueX","totalAmount","footerY","hash","urlVerificacion","qrDataUrl","QRCode","toDataURL","color","dark","light","qrBuffer","split","image","error","logger","warn","pages","bufferedPageRange","i","count","switchToPage","Date","toLocaleDateString","year","month","day","amount","Intl","NumberFormat","style","currency","format","colors","Logger"],"mappings":"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"}