{"version":3,"sources":["../../../../src/modules/crypto/blockchain/transaction-parser.ts"],"sourcesContent":["import { Injectable, Logger } from '@nestjs/common';\nimport { CryptoTxType } from '@prisma/client';\nimport { CovalentTransaction, CovalentLogEvent, ChainName } from './covalent.client';\n\nexport interface ParsedTransaction {\n  type: CryptoTxType;\n  subtype?: string;\n  assetIn?: string;\n  amountIn?: string;\n  assetOut?: string;\n  amountOut?: string;\n  feeAsset?: string;\n  feeAmount?: string;\n  confidence: number;\n  reasoning: string;\n}\n\n// Known DEX router addresses (multi-chain)\nconst DEX_ROUTERS: Record<string, string> = {\n  // Ethereum mainnet\n  '0x7a250d5630b4cf539739df2c5dacb4c659f2488d': 'uniswap_v2',\n  '0xe592427a0aece92de3edee1f18e0157c05861564': 'uniswap_v3',\n  '0x68b3465833fb72a70ecdf485e0e4c7bd8665fc45': 'uniswap_v3_router2',\n  '0xd9e1ce17f2641f24ae83637ab66a2cca9c378b9f': 'sushiswap',\n  '0x1111111254fb6c44bac0bed2854e76f90643097d': '1inch',\n  '0xdef1c0ded9bec7f1a1670819833240f027b25eff': '0x_protocol',\n  '0x3fc91a3afd70395cd496c647d5a6cc9d4b2b7fad': 'uniswap_universal',\n  '0x881d40237659c251811cec9c364ef91dc08d300c': 'metamask_swap',\n\n  // BSC\n  '0x10ed43c718714eb63d5aa57b78b54704e256024e': 'pancakeswap', // BSC\n  '0x13f4ea83d0bd40e75c8222255bc855a974568dd4': 'pancakeswap_v3', // BSC\n\n  // Arbitrum\n  '0x1b02da8cb0d097eb8d57a175b88c7d8b47997506': 'sushiswap_arbitrum',\n  '0x4752ba5dbc23f44d87826276bf6fd6b1c372ad24': 'gmx_arbitrum',\n  '0xc873fecbd354f5a56e00e710b90ef4201db2448d': 'camelot_arbitrum',\n\n  // Optimism\n  '0x9c12939390052919af3155f41bf4160fd3666a6f': 'velodrome_optimism',\n  '0xa062ae8a9c5e11aaa026fc2670b0d65ccc8b2858': 'uniswap_v3_optimism',\n\n  // Base\n  '0x327df1e6de05895d2ab08513aadd9313fe505d86': 'aerodrome_base',\n  '0x2626664c2603336e57b271c5c0b26f421741e481': 'uniswap_v3_base',\n\n  // Avalanche\n  '0x60ae616a2155ee3d9a68541ba4544862310933d4': 'traderjoe_avalanche',\n  '0xe54ca86531e17ef3616d22ca28b0d458b6c89106': 'pangolin_avalanche',\n  '0xbb4646a764358ee93c2a9c4a147d5aded527ab73': 'sushiswap_avalanche',\n};\n\n// Known staking protocol addresses\nconst STAKING_PROTOCOLS: Record<string, string> = {\n  '0xae7ab96520de3a18e5e111b5eaab095312d7fe84': 'lido_steth',\n  '0x7f39c581f595b53c5cb19bd0b3f8da6c935e2ca0': 'lido_wsteth',\n  '0xdd9bc35ae942ef0cfa76930954a156b3ff30a4e1': 'rocket_pool',\n  '0xac3e018457b222d93114458476f3e3416abbe38f': 'frax_staking',\n  '0xbe9895146f7af43049ca1c1ae358b0541ea49704': 'coinbase_cbeth',\n  '0xa35b1b31ce002fbf2058d22f30f95d405200a15b': 'eigen_layer',\n};\n\n// Known bridge addresses\nconst BRIDGE_PROTOCOLS: Record<string, string> = {\n  '0x3ee18b2214aff97000d974cf647e7c347e8fa585': 'wormhole',\n  '0x40ec5b33f54e0e8a33a975908c5ba1c14e5bbbdf': 'polygon_bridge',\n  '0xa0c68c638235ee32657e8f720a23cec1bfc77c77': 'polygon_plasma',\n  '0x99c9fc46f92e8a1c0dec1b1747d010903e884be1': 'optimism_bridge',\n  '0x4dbd4fc535ac27206064b68ffcf827b0a60bab3f': 'arbitrum_bridge',\n  '0x3154cf16ccdb4c6d922629664174b904d80f2c35': 'base_bridge',\n  '0x5427fefa711eff984124bfbb1ab6fbf5e3da1820': 'hop_protocol',\n  '0xabea9132b05a70803a4e85094fd0e1800777fbef': 'zkSync_bridge',\n};\n\n// Event signatures for different operations\nconst EVENT_SIGNATURES: Record<string, { type: CryptoTxType; name: string }> = {\n  // ERC20 Transfer\n  '0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef': { type: 'TRANSFER_IN', name: 'Transfer' },\n  // ERC20 Approval\n  '0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925': { type: 'APPROVE', name: 'Approval' },\n  // Uniswap V2 Swap\n  '0xd78ad95fa46c994b6551d0da85fc275fe613ce37657fb8d5e3d130840159d822': { type: 'SWAP', name: 'Swap' },\n  // Uniswap V3 Swap\n  '0xc42079f94a6350d7e6235f29174924f928cc2ac818eb64fed8004e115fbcca67': { type: 'SWAP', name: 'Swap' },\n  // Mint (LP add)\n  '0x4c209b5fc8ad50758f13e2e1088ba56a560dff690a1c6fef26394f4c03821c4f': { type: 'LIQUIDITY_ADD', name: 'Mint' },\n  // Burn (LP remove)\n  '0xdccd412f0b1252819cb1fd330b93224ca42612892bb3f4f789976e6d81936496': { type: 'LIQUIDITY_REMOVE', name: 'Burn' },\n  // Staked (generic)\n  '0x9e71bc8eea02a63969f509818f2dafb9254532904319f9dbda79b67bd34a5f3d': { type: 'STAKE', name: 'Staked' },\n  // Submitted (Lido)\n  '0x96a25c8ce0baabc1fdefd93e9ed25d8e092a3332f3aa9a41722b5697231d1d1a': { type: 'STAKE', name: 'Submitted' },\n  // Withdrawn\n  '0x7fcf532c15f0a6db0bd6d0e038bea71d30d808c7d98cb3bf7268a95bf5081b65': { type: 'UNSTAKE', name: 'Withdrawal' },\n  // NFT Transfer (ERC721)\n  '0xc3d58168c5ae7397731d063d5bbf3d657854427343f4c083240f7aacaa2d0f62': { type: 'NFT_TRANSFER', name: 'TransferSingle' },\n};\n\n// Known token addresses for native wrapping (EVM chains only)\nconst WRAPPED_NATIVE: Record<ChainName, string> = {\n  'eth-mainnet': '0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2', // WETH\n  'matic-mainnet': '0x0d500b1d8e8ef31e21c99d1db9a6444d3adf1270', // WMATIC\n  'bsc-mainnet': '0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c', // WBNB\n  'arbitrum-mainnet': '0x82af49447d8a07e3bd95bd0d56f35241523fbab1', // WETH\n  'optimism-mainnet': '0x4200000000000000000000000000000000000006', // WETH\n  'base-mainnet': '0x4200000000000000000000000000000000000006', // WETH\n  'avalanche-mainnet': '0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7', // WAVAX\n  'solana-mainnet': 'So11111111111111111111111111111111111111112', // Wrapped SOL (SPL token)\n  'bitcoin-mainnet': '', // No wrapped BTC on Bitcoin mainnet (no smart contracts)\n};\n\n@Injectable()\nexport class TransactionParser {\n  private readonly logger = new Logger(TransactionParser.name);\n\n  parseTransaction(\n    tx: CovalentTransaction,\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction {\n    const walletLower = walletAddress.toLowerCase();\n    const fromLower = tx.from_address.toLowerCase();\n    const toLower = tx.to_address?.toLowerCase() || '';\n\n    // Check for failed transactions\n    if (!tx.successful) {\n      return {\n        type: 'CONTRACT_INTERACTION',\n        confidence: 1,\n        reasoning: 'Failed transaction',\n        feeAsset: this.getNativeSymbol(chain),\n        feeAmount: this.calculateGasFee(tx),\n      };\n    }\n\n    // Try to detect transaction type from various sources\n    const result =\n      this.detectFromDexSwap(tx, walletLower, chain) ||\n      this.detectFromStaking(tx, walletLower, chain) ||\n      this.detectFromBridge(tx, walletLower, chain) ||\n      this.detectFromLogs(tx, walletLower, chain) ||\n      this.detectFromValue(tx, walletLower, chain);\n\n    // Add gas fee to result\n    result.feeAsset = this.getNativeSymbol(chain);\n    result.feeAmount = this.calculateGasFee(tx);\n\n    return result;\n  }\n\n  private detectFromDexSwap(\n    tx: CovalentTransaction,\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction | null {\n    const toAddress = tx.to_address?.toLowerCase();\n\n    // Check if interacting with known DEX router\n    if (toAddress && DEX_ROUTERS[toAddress]) {\n      const dexName = DEX_ROUTERS[toAddress];\n\n      // Look for swap events in logs\n      const swapDetails = this.extractSwapDetails(tx.log_events, walletAddress, chain);\n\n      if (swapDetails) {\n        return {\n          type: 'SWAP',\n          subtype: dexName,\n          assetIn: swapDetails.assetIn,\n          amountIn: swapDetails.amountIn,\n          assetOut: swapDetails.assetOut,\n          amountOut: swapDetails.amountOut,\n          confidence: 0.95,\n          reasoning: `Swap detected on ${dexName}`,\n        };\n      }\n\n      // DEX interaction but couldn't parse swap details\n      return {\n        type: 'SWAP',\n        subtype: dexName,\n        confidence: 0.7,\n        reasoning: `Interaction with ${dexName} router`,\n      };\n    }\n\n    // Check for DEX details from Covalent\n    if (tx.dex_details) {\n      const { protocol_name, token_0, token_1 } = tx.dex_details;\n      return {\n        type: 'SWAP',\n        subtype: protocol_name?.toLowerCase().replace(/\\s+/g, '_'),\n        assetIn: token_0?.contract_ticker_symbol,\n        amountIn: token_0?.amount,\n        assetOut: token_1?.contract_ticker_symbol,\n        amountOut: token_1?.amount,\n        confidence: 0.98,\n        reasoning: `Swap on ${protocol_name} via Covalent DEX details`,\n      };\n    }\n\n    return null;\n  }\n\n  private detectFromStaking(\n    tx: CovalentTransaction,\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction | null {\n    const toAddress = tx.to_address?.toLowerCase();\n\n    if (toAddress && STAKING_PROTOCOLS[toAddress]) {\n      const protocol = STAKING_PROTOCOLS[toAddress];\n\n      // Check for staking/unstaking events\n      const hasStakeEvent = tx.log_events.some(e =>\n        e.decoded?.name?.toLowerCase().includes('stake') ||\n        e.decoded?.name?.toLowerCase().includes('submit') ||\n        e.decoded?.name?.toLowerCase().includes('deposit')\n      );\n\n      const hasUnstakeEvent = tx.log_events.some(e =>\n        e.decoded?.name?.toLowerCase().includes('unstake') ||\n        e.decoded?.name?.toLowerCase().includes('withdraw') ||\n        e.decoded?.name?.toLowerCase().includes('redeem')\n      );\n\n      if (hasUnstakeEvent) {\n        return {\n          type: 'UNSTAKE',\n          subtype: protocol,\n          confidence: 0.9,\n          reasoning: `Unstaking from ${protocol}`,\n        };\n      }\n\n      if (hasStakeEvent || BigInt(tx.value) > 0) {\n        const nativeSymbol = this.getNativeSymbol(chain);\n        return {\n          type: 'STAKE',\n          subtype: protocol,\n          assetIn: nativeSymbol,\n          amountIn: this.formatWeiToEther(tx.value),\n          confidence: 0.9,\n          reasoning: `Staking on ${protocol}`,\n        };\n      }\n    }\n\n    return null;\n  }\n\n  private detectFromBridge(\n    tx: CovalentTransaction,\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction | null {\n    const toAddress = tx.to_address?.toLowerCase();\n\n    if (toAddress && BRIDGE_PROTOCOLS[toAddress]) {\n      const protocol = BRIDGE_PROTOCOLS[toAddress];\n\n      // Determine if bridging out (sending) or in (receiving)\n      const isBridgeOut = tx.from_address.toLowerCase() === walletAddress;\n\n      if (BigInt(tx.value) > 0) {\n        const nativeSymbol = this.getNativeSymbol(chain);\n        return {\n          type: isBridgeOut ? 'BRIDGE_OUT' : 'BRIDGE_IN',\n          subtype: protocol,\n          assetIn: isBridgeOut ? nativeSymbol : undefined,\n          amountIn: isBridgeOut ? this.formatWeiToEther(tx.value) : undefined,\n          confidence: 0.85,\n          reasoning: `Bridge ${isBridgeOut ? 'out' : 'in'} via ${protocol}`,\n        };\n      }\n\n      // Token bridge (not native)\n      const transfers = this.extractTokenTransfers(tx.log_events, walletAddress);\n      if (transfers.length > 0) {\n        const transfer = transfers[0];\n        return {\n          type: isBridgeOut ? 'BRIDGE_OUT' : 'BRIDGE_IN',\n          subtype: protocol,\n          assetIn: transfer.symbol,\n          amountIn: transfer.amount,\n          confidence: 0.85,\n          reasoning: `Token bridge ${isBridgeOut ? 'out' : 'in'} via ${protocol}`,\n        };\n      }\n    }\n\n    return null;\n  }\n\n  private detectFromLogs(\n    tx: CovalentTransaction,\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction | null {\n    // Check for liquidity operations\n    const hasLiquidityAdd = tx.log_events.some(e =>\n      e.decoded?.name === 'Mint' ||\n      e.decoded?.name === 'AddLiquidity' ||\n      e.decoded?.name?.toLowerCase().includes('liquidity') && e.decoded?.name?.toLowerCase().includes('add')\n    );\n\n    const hasLiquidityRemove = tx.log_events.some(e =>\n      e.decoded?.name === 'Burn' ||\n      e.decoded?.name === 'RemoveLiquidity' ||\n      e.decoded?.name?.toLowerCase().includes('liquidity') && e.decoded?.name?.toLowerCase().includes('remove')\n    );\n\n    if (hasLiquidityAdd) {\n      return {\n        type: 'LIQUIDITY_ADD',\n        confidence: 0.85,\n        reasoning: 'Liquidity addition detected from logs',\n      };\n    }\n\n    if (hasLiquidityRemove) {\n      return {\n        type: 'LIQUIDITY_REMOVE',\n        confidence: 0.85,\n        reasoning: 'Liquidity removal detected from logs',\n      };\n    }\n\n    // Check for approval\n    const approvalEvent = tx.log_events.find(e => e.decoded?.name === 'Approval');\n    if (approvalEvent && tx.log_events.length === 1) {\n      return {\n        type: 'APPROVE',\n        confidence: 0.95,\n        reasoning: 'Token approval transaction',\n      };\n    }\n\n    // Check for rewards claim\n    const hasClaimEvent = tx.log_events.some(e =>\n      e.decoded?.name?.toLowerCase().includes('claim') ||\n      e.decoded?.name?.toLowerCase().includes('reward') ||\n      e.decoded?.name === 'Harvested' ||\n      e.decoded?.name === 'RewardPaid'\n    );\n\n    if (hasClaimEvent) {\n      const transfers = this.extractTokenTransfers(tx.log_events, walletAddress);\n      const incomingTransfer = transfers.find(t => t.direction === 'IN');\n\n      return {\n        type: 'CLAIM_REWARD',\n        assetOut: incomingTransfer?.symbol,\n        amountOut: incomingTransfer?.amount,\n        confidence: 0.85,\n        reasoning: 'Reward claim detected from logs',\n      };\n    }\n\n    // Check for simple token transfers\n    const transfers = this.extractTokenTransfers(tx.log_events, walletAddress);\n    if (transfers.length === 1) {\n      const transfer = transfers[0];\n      return {\n        type: transfer.direction === 'IN' ? 'TRANSFER_IN' : 'TRANSFER_OUT',\n        assetIn: transfer.direction === 'IN' ? transfer.symbol : undefined,\n        amountIn: transfer.direction === 'IN' ? transfer.amount : undefined,\n        assetOut: transfer.direction === 'OUT' ? transfer.symbol : undefined,\n        amountOut: transfer.direction === 'OUT' ? transfer.amount : undefined,\n        confidence: 0.9,\n        reasoning: `ERC20 transfer ${transfer.direction.toLowerCase()}`,\n      };\n    }\n\n    return null;\n  }\n\n  private detectFromValue(\n    tx: CovalentTransaction,\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction {\n    const nativeSymbol = this.getNativeSymbol(chain);\n    const value = BigInt(tx.value);\n    const from = tx.from_address.toLowerCase();\n    const to = tx.to_address?.toLowerCase();\n\n    // Simple native transfer\n    if (value > 0 && tx.log_events.length === 0) {\n      const isIncoming = to === walletAddress;\n      return {\n        type: isIncoming ? 'TRANSFER_IN' : 'TRANSFER_OUT',\n        assetIn: isIncoming ? nativeSymbol : undefined,\n        amountIn: isIncoming ? this.formatWeiToEther(tx.value) : undefined,\n        assetOut: !isIncoming ? nativeSymbol : undefined,\n        amountOut: !isIncoming ? this.formatWeiToEther(tx.value) : undefined,\n        confidence: 0.95,\n        reasoning: `Native ${nativeSymbol} transfer ${isIncoming ? 'in' : 'out'}`,\n      };\n    }\n\n    // Contract interaction without clear type\n    if (tx.log_events.length > 0) {\n      return {\n        type: 'CONTRACT_INTERACTION',\n        confidence: 0.5,\n        reasoning: 'Unknown contract interaction - needs manual review',\n      };\n    }\n\n    // Empty transaction (possible failed or internal)\n    return {\n      type: 'UNKNOWN',\n      confidence: 0.3,\n      reasoning: 'Unable to determine transaction type',\n    };\n  }\n\n  private extractSwapDetails(\n    logs: CovalentLogEvent[],\n    walletAddress: string,\n    chain: ChainName,\n  ): { assetIn: string; amountIn: string; assetOut: string; amountOut: string } | null {\n    // Look for swap events\n    const swapEvent = logs.find(e =>\n      e.decoded?.name === 'Swap' ||\n      e.decoded?.name === 'TokenExchange' ||\n      e.decoded?.name === 'Fill'\n    );\n\n    if (swapEvent?.decoded?.params) {\n      const params = swapEvent.decoded.params;\n\n      // Try to extract amounts from params\n      const amount0In = params.find(p => p.name.toLowerCase().includes('amount0in'))?.value;\n      const amount1In = params.find(p => p.name.toLowerCase().includes('amount1in'))?.value;\n      const amount0Out = params.find(p => p.name.toLowerCase().includes('amount0out'))?.value;\n      const amount1Out = params.find(p => p.name.toLowerCase().includes('amount1out'))?.value;\n\n      // Determine which token was sold and which was bought\n      if (amount0In && amount1Out && BigInt(amount0In) > 0 && BigInt(amount1Out) > 0) {\n        return {\n          assetIn: 'TOKEN0',\n          amountIn: amount0In,\n          assetOut: 'TOKEN1',\n          amountOut: amount1Out,\n        };\n      }\n      if (amount1In && amount0Out && BigInt(amount1In) > 0 && BigInt(amount0Out) > 0) {\n        return {\n          assetIn: 'TOKEN1',\n          amountIn: amount1In,\n          assetOut: 'TOKEN0',\n          amountOut: amount0Out,\n        };\n      }\n    }\n\n    // Fallback: look for Transfer events (in/out pattern)\n    const transfers = this.extractTokenTransfers(logs, walletAddress);\n    const incoming = transfers.filter(t => t.direction === 'IN');\n    const outgoing = transfers.filter(t => t.direction === 'OUT');\n\n    if (incoming.length === 1 && outgoing.length === 1) {\n      return {\n        assetIn: outgoing[0].symbol,\n        amountIn: outgoing[0].amount,\n        assetOut: incoming[0].symbol,\n        amountOut: incoming[0].amount,\n      };\n    }\n\n    return null;\n  }\n\n  private extractTokenTransfers(\n    logs: CovalentLogEvent[],\n    walletAddress: string,\n  ): Array<{ symbol: string; amount: string; direction: 'IN' | 'OUT'; from: string; to: string }> {\n    const transfers: Array<{ symbol: string; amount: string; direction: 'IN' | 'OUT'; from: string; to: string }> = [];\n\n    for (const log of logs) {\n      if (log.decoded?.name === 'Transfer' && log.decoded?.params) {\n        const params = log.decoded.params;\n        const from = params.find(p => p.name === 'from')?.value?.toLowerCase();\n        const to = params.find(p => p.name === 'to')?.value?.toLowerCase();\n        const value = params.find(p => p.name === 'value' || p.name === 'amount')?.value;\n\n        if (from && to && value) {\n          const direction = to === walletAddress ? 'IN' : from === walletAddress ? 'OUT' : null;\n          if (direction) {\n            transfers.push({\n              symbol: log.sender_name || 'UNKNOWN',\n              amount: value,\n              direction,\n              from,\n              to,\n            });\n          }\n        }\n      }\n    }\n\n    return transfers;\n  }\n\n  private calculateGasFee(tx: CovalentTransaction): string {\n    const gasUsed = BigInt(tx.gas_spent);\n    const gasPrice = BigInt(tx.gas_price);\n    const feeWei = gasUsed * gasPrice;\n    return this.formatWeiToEther(feeWei.toString());\n  }\n\n  private formatWeiToEther(weiValue: string): string {\n    const wei = BigInt(weiValue);\n    const ether = Number(wei) / 1e18;\n    return ether.toFixed(18);\n  }\n\n  private getNativeSymbol(chain: ChainName): string {\n    const symbols: Record<ChainName, string> = {\n      'eth-mainnet': 'ETH',\n      'matic-mainnet': 'MATIC',\n      'bsc-mainnet': 'BNB',\n      'arbitrum-mainnet': 'ETH',\n      'optimism-mainnet': 'ETH',\n      'base-mainnet': 'ETH',\n      'avalanche-mainnet': 'AVAX',\n    };\n    return symbols[chain] || 'ETH';\n  }\n\n  // Batch parse multiple transactions\n  parseTransactions(\n    transactions: CovalentTransaction[],\n    walletAddress: string,\n    chain: ChainName,\n  ): ParsedTransaction[] {\n    return transactions.map(tx => this.parseTransaction(tx, walletAddress, chain));\n  }\n}\n"],"names":["TransactionParser","DEX_ROUTERS","STAKING_PROTOCOLS","BRIDGE_PROTOCOLS","EVENT_SIGNATURES","type","name","WRAPPED_NATIVE","parseTransaction","tx","walletAddress","chain","walletLower","toLowerCase","fromLower","from_address","toLower","to_address","successful","confidence","reasoning","feeAsset","getNativeSymbol","feeAmount","calculateGasFee","result","detectFromDexSwap","detectFromStaking","detectFromBridge","detectFromLogs","detectFromValue","toAddress","dexName","swapDetails","extractSwapDetails","log_events","subtype","assetIn","amountIn","assetOut","amountOut","dex_details","protocol_name","token_0","token_1","replace","contract_ticker_symbol","amount","protocol","hasStakeEvent","some","e","decoded","includes","hasUnstakeEvent","BigInt","value","nativeSymbol","formatWeiToEther","isBridgeOut","undefined","transfers","extractTokenTransfers","length","transfer","symbol","hasLiquidityAdd","hasLiquidityRemove","approvalEvent","find","hasClaimEvent","incomingTransfer","t","direction","from","to","isIncoming","logs","swapEvent","params","amount0In","p","amount1In","amount0Out","amount1Out","incoming","filter","outgoing","log","push","sender_name","gasUsed","gas_spent","gasPrice","gas_price","feeWei","toString","weiValue","wei","ether","Number","toFixed","symbols","parseTransactions","transactions","map","logger","Logger"],"mappings":"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"}