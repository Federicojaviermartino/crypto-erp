{"version":3,"sources":["../../../src/modules/partners/partners.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Post,\n  Put,\n  Body,\n  Param,\n  Query,\n  UseGuards,\n  BadRequestException,\n} from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard.js';\nimport { PartnersService } from './partners.service.js';\nimport { CreatePartnerDto } from './dto/create-partner.dto.js';\nimport { UpdatePartnerDto } from './dto/update-partner.dto.js';\nimport { CreateCommissionDto } from './dto/create-commission.dto.js';\n\n/**\n * Partners Controller\n *\n * Endpoints for managing the partner/reseller program:\n * - Partner CRUD\n * - Customer assignment\n * - Commission tracking\n * - Payouts\n * - Analytics\n */\n@Controller('partners')\n@UseGuards(JwtAuthGuard)\nexport class PartnersController {\n  constructor(private readonly partnersService: PartnersService) {}\n\n  /**\n   * Create a new partner\n   * POST /partners\n   *\n   * Body:\n   * {\n   *   \"name\": \"Partner Name\",\n   *   \"legalName\": \"Partner Legal Name\",\n   *   \"email\": \"partner@example.com\",\n   *   \"commissionRate\": 20,\n   *   \"revenueShareModel\": \"PERCENTAGE\"\n   * }\n   */\n  @Post()\n  async createPartner(@Body() dto: CreatePartnerDto) {\n    return this.partnersService.createPartner(dto);\n  }\n\n  /**\n   * List all partners\n   * GET /partners?status=ACTIVE&isActive=true\n   */\n  @Get()\n  async listPartners(\n    @Query('status') status?: string,\n    @Query('isActive') isActive?: string,\n  ) {\n    return this.partnersService.listPartners({\n      status,\n      isActive: isActive === 'true' ? true : isActive === 'false' ? false : undefined,\n    });\n  }\n\n  /**\n   * Get partner by ID\n   * GET /partners/:id\n   */\n  @Get(':id')\n  async getPartnerById(@Param('id') partnerId: string) {\n    return this.partnersService.getPartnerById(partnerId);\n  }\n\n  /**\n   * Update partner\n   * PUT /partners/:id\n   */\n  @Put(':id')\n  async updatePartner(@Param('id') partnerId: string, @Body() dto: UpdatePartnerDto) {\n    return this.partnersService.updatePartner(partnerId, dto);\n  }\n\n  /**\n   * Get partner analytics\n   * GET /partners/:id/analytics\n   */\n  @Get(':id/analytics')\n  async getPartnerAnalytics(@Param('id') partnerId: string) {\n    return this.partnersService.getPartnerAnalytics(partnerId);\n  }\n\n  /**\n   * Assign a company to a partner\n   * POST /partners/:id/customers\n   *\n   * Body:\n   * {\n   *   \"companyId\": \"uuid\"\n   * }\n   */\n  @Post(':id/customers')\n  async assignCustomerToPartner(\n    @Param('id') partnerId: string,\n    @Body('companyId') companyId: string,\n  ) {\n    if (!companyId) {\n      throw new BadRequestException('companyId is required');\n    }\n\n    return this.partnersService.assignCustomerToPartner(partnerId, companyId);\n  }\n\n  /**\n   * Get partner commissions\n   * GET /partners/:id/commissions?status=PENDING&startDate=2025-01-01&endDate=2025-12-31\n   */\n  @Get(':id/commissions')\n  async getPartnerCommissions(\n    @Param('id') partnerId: string,\n    @Query('status') status?: string,\n    @Query('startDate') startDate?: string,\n    @Query('endDate') endDate?: string,\n  ) {\n    return this.partnersService.getPartnerCommissions(partnerId, {\n      status,\n      startDate: startDate ? new Date(startDate) : undefined,\n      endDate: endDate ? new Date(endDate) : undefined,\n    });\n  }\n\n  /**\n   * Record a commission\n   * POST /partners/:id/commissions\n   *\n   * Body:\n   * {\n   *   \"companyId\": \"uuid\",\n   *   \"transactionType\": \"subscription\",\n   *   \"baseAmount\": 100.00,\n   *   \"commissionRate\": 20,\n   *   \"commissionAmount\": 20.00\n   * }\n   */\n  @Post(':id/commissions')\n  async createCommission(\n    @Param('id') partnerId: string,\n    @Body() dto: Omit<CreateCommissionDto, 'partnerId'>,\n  ) {\n    return this.partnersService.createCommission({\n      ...dto,\n      partnerId,\n    } as CreateCommissionDto);\n  }\n\n  /**\n   * Create a payout for partner\n   * POST /partners/:id/payouts\n   *\n   * Body:\n   * {\n   *   \"periodStart\": \"2025-01-01\",\n   *   \"periodEnd\": \"2025-01-31\",\n   *   \"paymentMethod\": \"bank_transfer\"\n   * }\n   */\n  @Post(':id/payouts')\n  async createPayout(\n    @Param('id') partnerId: string,\n    @Body('periodStart') periodStart: string,\n    @Body('periodEnd') periodEnd: string,\n    @Body('paymentMethod') paymentMethod?: string,\n  ) {\n    if (!periodStart || !periodEnd) {\n      throw new BadRequestException('periodStart and periodEnd are required');\n    }\n\n    return this.partnersService.createPayout(\n      partnerId,\n      new Date(periodStart),\n      new Date(periodEnd),\n      paymentMethod,\n    );\n  }\n\n  /**\n   * Mark payout as paid\n   * PUT /partners/payouts/:payoutId/paid\n   *\n   * Body:\n   * {\n   *   \"paymentReference\": \"TXN123456\"\n   * }\n   */\n  @Put('payouts/:payoutId/paid')\n  async markPayoutAsPaid(\n    @Param('payoutId') payoutId: string,\n    @Body('paymentReference') paymentReference?: string,\n  ) {\n    return this.partnersService.markPayoutAsPaid(payoutId, paymentReference);\n  }\n}\n"],"names":["PartnersController","createPartner","dto","partnersService","listPartners","status","isActive","undefined","getPartnerById","partnerId","updatePartner","getPartnerAnalytics","assignCustomerToPartner","companyId","BadRequestException","getPartnerCommissions","startDate","endDate","Date","createCommission","createPayout","periodStart","periodEnd","paymentMethod","markPayoutAsPaid","payoutId","paymentReference"],"mappings":";;;;+BA6BaA;;;eAAAA;;;wBAnBN;8BACsB;iCACG;kCACC;kCACA;;;;;;;;;;;;;;;AAe1B,IAAA,AAAMA,qBAAN,MAAMA;IAGX;;;;;;;;;;;;GAYC,GACD,MACMC,cAAc,AAAQC,GAAqB,EAAE;QACjD,OAAO,IAAI,CAACC,eAAe,CAACF,aAAa,CAACC;IAC5C;IAEA;;;GAGC,GACD,MACME,aACJ,AAAiBC,MAAe,EAChC,AAAmBC,QAAiB,EACpC;QACA,OAAO,IAAI,CAACH,eAAe,CAACC,YAAY,CAAC;YACvCC;YACAC,UAAUA,aAAa,SAAS,OAAOA,aAAa,UAAU,QAAQC;QACxE;IACF;IAEA;;;GAGC,GACD,MACMC,eAAe,AAAaC,SAAiB,EAAE;QACnD,OAAO,IAAI,CAACN,eAAe,CAACK,cAAc,CAACC;IAC7C;IAEA;;;GAGC,GACD,MACMC,cAAc,AAAaD,SAAiB,EAAE,AAAQP,GAAqB,EAAE;QACjF,OAAO,IAAI,CAACC,eAAe,CAACO,aAAa,CAACD,WAAWP;IACvD;IAEA;;;GAGC,GACD,MACMS,oBAAoB,AAAaF,SAAiB,EAAE;QACxD,OAAO,IAAI,CAACN,eAAe,CAACQ,mBAAmB,CAACF;IAClD;IAEA;;;;;;;;GAQC,GACD,MACMG,wBACJ,AAAaH,SAAiB,EAC9B,AAAmBI,SAAiB,EACpC;QACA,IAAI,CAACA,WAAW;YACd,MAAM,IAAIC,2BAAmB,CAAC;QAChC;QAEA,OAAO,IAAI,CAACX,eAAe,CAACS,uBAAuB,CAACH,WAAWI;IACjE;IAEA;;;GAGC,GACD,MACME,sBACJ,AAAaN,SAAiB,EAC9B,AAAiBJ,MAAe,EAChC,AAAoBW,SAAkB,EACtC,AAAkBC,OAAgB,EAClC;QACA,OAAO,IAAI,CAACd,eAAe,CAACY,qBAAqB,CAACN,WAAW;YAC3DJ;YACAW,WAAWA,YAAY,IAAIE,KAAKF,aAAaT;YAC7CU,SAASA,UAAU,IAAIC,KAAKD,WAAWV;QACzC;IACF;IAEA;;;;;;;;;;;;GAYC,GACD,MACMY,iBACJ,AAAaV,SAAiB,EAC9B,AAAQP,GAA2C,EACnD;QACA,OAAO,IAAI,CAACC,eAAe,CAACgB,gBAAgB,CAAC;YAC3C,GAAGjB,GAAG;YACNO;QACF;IACF;IAEA;;;;;;;;;;GAUC,GACD,MACMW,aACJ,AAAaX,SAAiB,EAC9B,AAAqBY,WAAmB,EACxC,AAAmBC,SAAiB,EACpC,AAAuBC,aAAsB,EAC7C;QACA,IAAI,CAACF,eAAe,CAACC,WAAW;YAC9B,MAAM,IAAIR,2BAAmB,CAAC;QAChC;QAEA,OAAO,IAAI,CAACX,eAAe,CAACiB,YAAY,CACtCX,WACA,IAAIS,KAAKG,cACT,IAAIH,KAAKI,YACTC;IAEJ;IAEA;;;;;;;;GAQC,GACD,MACMC,iBACJ,AAAmBC,QAAgB,EACnC,AAA0BC,gBAAyB,EACnD;QACA,OAAO,IAAI,CAACvB,eAAe,CAACqB,gBAAgB,CAACC,UAAUC;IACzD;IA1KA,YAAY,AAAiBvB,eAAgC,CAAE;aAAlCA,kBAAAA;IAAmC;AA2KlE"}