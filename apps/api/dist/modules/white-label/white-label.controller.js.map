{"version":3,"sources":["../../../src/modules/white-label/white-label.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Get,\n  Put,\n  Delete,\n  Body,\n  Headers,\n  BadRequestException,\n  UseGuards,\n  Post,\n  Param,\n} from '@nestjs/common';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard.js';\nimport { WhiteLabelService } from './white-label.service.js';\nimport { UpdateWhiteLabelDto } from './dto/update-white-label.dto.js';\n\n/**\n * White-Label Controller\n *\n * Endpoints:\n * GET /white-label - Get current company's white-label config\n * GET /white-label/theme.css - Get theme CSS for current company\n * PUT /white-label - Update white-label configuration\n * POST /white-label/verify-domain - Verify custom domain\n * DELETE /white-label - Reset to defaults\n */\n@Controller('white-label')\n@UseGuards(JwtAuthGuard)\nexport class WhiteLabelController {\n  constructor(private readonly whiteLabelService: WhiteLabelService) {}\n\n  private getCompanyId(headers: Record<string, string>): string {\n    const companyId = headers['x-company-id'];\n    if (!companyId) {\n      throw new BadRequestException('X-Company-Id header is required');\n    }\n    return companyId;\n  }\n\n  /**\n   * Get white-label configuration for current company\n   * GET /white-label\n   */\n  @Get()\n  async getWhiteLabelConfig(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    return this.whiteLabelService.getWhiteLabelConfig(companyId);\n  }\n\n  /**\n   * Get theme CSS for current company\n   * GET /white-label/theme.css\n   *\n   * Returns CSS with custom color variables\n   */\n  @Get('theme.css')\n  async getThemeCss(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    const css = await this.whiteLabelService.getThemeCss(companyId);\n\n    return {\n      css,\n      contentType: 'text/css',\n    };\n  }\n\n  /**\n   * Get email branding configuration\n   * GET /white-label/email-branding\n   */\n  @Get('email-branding')\n  async getEmailBranding(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    return this.whiteLabelService.getEmailBranding(companyId);\n  }\n\n  /**\n   * Check if feature is enabled\n   * GET /white-label/features/:feature\n   */\n  @Get('features/:feature')\n  async isFeatureEnabled(\n    @Headers() headers: Record<string, string>,\n    @Param('feature') feature: string,\n  ) {\n    const companyId = this.getCompanyId(headers);\n    const enabled = await this.whiteLabelService.isFeatureEnabled(companyId, feature);\n\n    return {\n      feature,\n      enabled,\n    };\n  }\n\n  /**\n   * Update white-label configuration\n   * PUT /white-label\n   *\n   * Example:\n   * {\n   *   \"brandName\": \"My Brand\",\n   *   \"primaryColor\": \"#FF0000\",\n   *   \"logoUrl\": \"https://cdn.example.com/logo.png\",\n   *   \"customDomain\": \"app.mybrand.com\",\n   *   \"enabledFeatures\": [\"invoicing\", \"crypto\"]\n   * }\n   */\n  @Put()\n  async updateWhiteLabelConfig(\n    @Headers() headers: Record<string, string>,\n    @Body() dto: UpdateWhiteLabelDto,\n  ) {\n    const companyId = this.getCompanyId(headers);\n    return this.whiteLabelService.updateWhiteLabelConfig(companyId, dto);\n  }\n\n  /**\n   * Verify custom domain ownership\n   * POST /white-label/verify-domain\n   *\n   * Checks DNS records to verify domain ownership\n   */\n  @Post('verify-domain')\n  async verifyCustomDomain(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    const verified = await this.whiteLabelService.verifyCustomDomain(companyId);\n\n    return {\n      verified,\n      message: verified ? 'Domain verified successfully' : 'Domain verification failed',\n    };\n  }\n\n  /**\n   * Reset white-label configuration to defaults\n   * DELETE /white-label\n   */\n  @Delete()\n  async deleteWhiteLabelConfig(@Headers() headers: Record<string, string>) {\n    const companyId = this.getCompanyId(headers);\n    return this.whiteLabelService.deleteWhiteLabelConfig(companyId);\n  }\n}\n"],"names":["WhiteLabelController","getCompanyId","headers","companyId","BadRequestException","getWhiteLabelConfig","whiteLabelService","getThemeCss","css","contentType","getEmailBranding","isFeatureEnabled","feature","enabled","updateWhiteLabelConfig","dto","verifyCustomDomain","verified","message","deleteWhiteLabelConfig"],"mappings":";;;;+BA4BaA;;;eAAAA;;;wBAjBN;8BACsB;mCACK;qCACE;;;;;;;;;;;;;;;AAc7B,IAAA,AAAMA,uBAAN,MAAMA;IAGHC,aAAaC,OAA+B,EAAU;QAC5D,MAAMC,YAAYD,OAAO,CAAC,eAAe;QACzC,IAAI,CAACC,WAAW;YACd,MAAM,IAAIC,2BAAmB,CAAC;QAChC;QACA,OAAOD;IACT;IAEA;;;GAGC,GACD,MACME,oBAAoB,AAAWH,OAA+B,EAAE;QACpE,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,OAAO,IAAI,CAACI,iBAAiB,CAACD,mBAAmB,CAACF;IACpD;IAEA;;;;;GAKC,GACD,MACMI,YAAY,AAAWL,OAA+B,EAAE;QAC5D,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,MAAMM,MAAM,MAAM,IAAI,CAACF,iBAAiB,CAACC,WAAW,CAACJ;QAErD,OAAO;YACLK;YACAC,aAAa;QACf;IACF;IAEA;;;GAGC,GACD,MACMC,iBAAiB,AAAWR,OAA+B,EAAE;QACjE,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,OAAO,IAAI,CAACI,iBAAiB,CAACI,gBAAgB,CAACP;IACjD;IAEA;;;GAGC,GACD,MACMQ,iBACJ,AAAWT,OAA+B,EAC1C,AAAkBU,OAAe,EACjC;QACA,MAAMT,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,MAAMW,UAAU,MAAM,IAAI,CAACP,iBAAiB,CAACK,gBAAgB,CAACR,WAAWS;QAEzE,OAAO;YACLA;YACAC;QACF;IACF;IAEA;;;;;;;;;;;;GAYC,GACD,MACMC,uBACJ,AAAWZ,OAA+B,EAC1C,AAAQa,GAAwB,EAChC;QACA,MAAMZ,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,OAAO,IAAI,CAACI,iBAAiB,CAACQ,sBAAsB,CAACX,WAAWY;IAClE;IAEA;;;;;GAKC,GACD,MACMC,mBAAmB,AAAWd,OAA+B,EAAE;QACnE,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,MAAMe,WAAW,MAAM,IAAI,CAACX,iBAAiB,CAACU,kBAAkB,CAACb;QAEjE,OAAO;YACLc;YACAC,SAASD,WAAW,iCAAiC;QACvD;IACF;IAEA;;;GAGC,GACD,MACME,uBAAuB,AAAWjB,OAA+B,EAAE;QACvE,MAAMC,YAAY,IAAI,CAACF,YAAY,CAACC;QACpC,OAAO,IAAI,CAACI,iBAAiB,CAACa,sBAAsB,CAAChB;IACvD;IAhHA,YAAY,AAAiBG,iBAAoC,CAAE;aAAtCA,oBAAAA;IAAuC;AAiHtE"}