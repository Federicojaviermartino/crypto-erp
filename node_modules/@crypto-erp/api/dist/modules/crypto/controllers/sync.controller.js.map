{"version":3,"sources":["../../../../src/modules/crypto/controllers/sync.controller.ts"],"sourcesContent":["import {\n  Controller,\n  Post,\n  Get,\n  Patch,\n  Body,\n  Param,\n  UseGuards,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport {\n  ApiTags,\n  ApiOperation,\n  ApiResponse,\n  ApiBearerAuth,\n  ApiParam,\n} from '@nestjs/swagger';\nimport { JwtAuthGuard, TenantGuard } from '../../../common/guards/index.js';\nimport { CurrentCompany } from '../../../common/decorators/index.js';\nimport { BlockchainSyncService, SyncResult } from '../services/blockchain-sync.service.js';\nimport { CryptoTxType } from '@prisma/client';\nimport { IsEnum, IsOptional, IsString } from 'class-validator';\n\nclass UpdateTransactionTypeDto {\n  @IsEnum(CryptoTxType)\n  type: CryptoTxType;\n\n  @IsOptional()\n  @IsString()\n  notes?: string;\n}\n\n@ApiTags('Crypto - Blockchain Sync')\n@ApiBearerAuth()\n@UseGuards(JwtAuthGuard, TenantGuard)\n@Controller('crypto/sync')\nexport class SyncController {\n  constructor(private readonly syncService: BlockchainSyncService) {}\n\n  @Post('wallet/:id')\n  @ApiOperation({ summary: 'Sync a wallet with blockchain data' })\n  @ApiParam({ name: 'id', description: 'Wallet ID' })\n  @ApiResponse({\n    status: 200,\n    description: 'Wallet sync completed',\n  })\n  async syncWallet(\n    @CurrentCompany() companyId: string,\n    @Param('id') walletId: string,\n  ): Promise<SyncResult> {\n    // TODO: Verify wallet belongs to company\n    return this.syncService.syncWallet(walletId);\n  }\n\n  @Post('all')\n  @ApiOperation({ summary: 'Sync all active wallets' })\n  @ApiResponse({\n    status: 200,\n    description: 'All wallets synced',\n  })\n  async syncAll(@CurrentCompany() companyId: string): Promise<{ results: SyncResult[] }> {\n    const results = await this.syncService.syncAllWallets(companyId);\n    return { results };\n  }\n\n  @Get('wallet/:id/status')\n  @ApiOperation({ summary: 'Check if wallet is currently syncing' })\n  @ApiParam({ name: 'id', description: 'Wallet ID' })\n  async getSyncStatus(\n    @Param('id') walletId: string,\n  ): Promise<{ syncing: boolean }> {\n    return { syncing: this.syncService.isSyncing(walletId) };\n  }\n\n  @Get('transactions/review')\n  @ApiOperation({ summary: 'Get transactions needing manual review' })\n  @ApiResponse({\n    status: 200,\n    description: 'List of transactions needing review',\n  })\n  async getTransactionsNeedingReview(\n    @CurrentCompany() companyId: string,\n  ): Promise<{ transactions: any[] }> {\n    const transactions = await this.syncService.getTransactionsNeedingReview(companyId);\n    return { transactions };\n  }\n\n  @Patch('transactions/:id/type')\n  @HttpCode(HttpStatus.OK)\n  @ApiOperation({ summary: 'Manually update transaction type' })\n  @ApiParam({ name: 'id', description: 'Transaction ID' })\n  @ApiResponse({\n    status: 200,\n    description: 'Transaction type updated',\n  })\n  async updateTransactionType(\n    @CurrentCompany() companyId: string,\n    @Param('id') transactionId: string,\n    @Body() dto: UpdateTransactionTypeDto,\n  ): Promise<{ success: boolean }> {\n    await this.syncService.updateTransactionType(\n      companyId,\n      transactionId,\n      dto.type,\n      dto.notes,\n    );\n    return { success: true };\n  }\n}\n"],"names":["SyncController","UpdateTransactionTypeDto","syncWallet","companyId","walletId","syncService","syncAll","results","syncAllWallets","getSyncStatus","syncing","isSyncing","getTransactionsNeedingReview","transactions","updateTransactionType","transactionId","dto","type","notes","success","summary","name","description","status","OK"],"mappings":";;;;+BAqCaA;;;eAAAA;;;wBA3BN;yBAOA;uBACmC;wBACX;uCACmB;wBACrB;gCACgB;;;;;;;;;;;;;;;AAE7C,IAAA,AAAMC,2BAAN,MAAMA;AAON;;;;;;;;;;AAMO,IAAA,AAAMD,iBAAN,MAAMA;IAGX,MAOME,WACJ,AAAkBC,SAAiB,EACnC,AAAaC,QAAgB,EACR;QACrB,yCAAyC;QACzC,OAAO,IAAI,CAACC,WAAW,CAACH,UAAU,CAACE;IACrC;IAEA,MAMME,QAAQ,AAAkBH,SAAiB,EAAsC;QACrF,MAAMI,UAAU,MAAM,IAAI,CAACF,WAAW,CAACG,cAAc,CAACL;QACtD,OAAO;YAAEI;QAAQ;IACnB;IAEA,MAGME,cACJ,AAAaL,QAAgB,EACE;QAC/B,OAAO;YAAEM,SAAS,IAAI,CAACL,WAAW,CAACM,SAAS,CAACP;QAAU;IACzD;IAEA,MAMMQ,6BACJ,AAAkBT,SAAiB,EACD;QAClC,MAAMU,eAAe,MAAM,IAAI,CAACR,WAAW,CAACO,4BAA4B,CAACT;QACzE,OAAO;YAAEU;QAAa;IACxB;IAEA,MAQMC,sBACJ,AAAkBX,SAAiB,EACnC,AAAaY,aAAqB,EAClC,AAAQC,GAA6B,EACN;QAC/B,MAAM,IAAI,CAACX,WAAW,CAACS,qBAAqB,CAC1CX,WACAY,eACAC,IAAIC,IAAI,EACRD,IAAIE,KAAK;QAEX,OAAO;YAAEC,SAAS;QAAK;IACzB;IAtEA,YAAY,AAAiBd,WAAkC,CAAE;aAApCA,cAAAA;IAAqC;AAuEpE;;;;QApEkBe,SAAS;;;QACbC,MAAM;QAAMC,aAAa;;;QAEnCC,QAAQ;QACRD,aAAa;;;;;;;;;;;;;;QAWCF,SAAS;;;QAEvBG,QAAQ;QACRD,aAAa;;;;;;;;;;;;QAQCF,SAAS;;;QACbC,MAAM;QAAMC,aAAa;;;;;;;;;;;;QAQrBF,SAAS;;;QAEvBG,QAAQ;QACRD,aAAa;;;;;;;;;;;6CAUME;;QACLJ,SAAS;;;QACbC,MAAM;QAAMC,aAAa;;;QAEnCC,QAAQ;QACRD,aAAa"}