{"version":3,"sources":["../../src/config/env.validation.ts"],"sourcesContent":["import { z } from 'zod';\n\n/**\n * Environment variables schema for validation at startup.\n */\nexport const envSchema = z.object({\n  // Application\n  NODE_ENV: z\n    .enum(['development', 'production', 'test'])\n    .default('development'),\n  PORT: z.string().transform(Number).default('3000'),\n  FRONTEND_URL: z.string().url().default('http://localhost:4200'),\n\n  // Database (required)\n  DATABASE_URL: z.string().min(1, 'DATABASE_URL is required'),\n\n  // Redis\n  REDIS_URL: z.string().default('redis://localhost:6379'),\n\n  // JWT (required in production)\n  JWT_SECRET: z.string().min(1),\n  JWT_REFRESH_SECRET: z.string().min(1),\n  JWT_ACCESS_EXPIRES_IN: z.string().default('15m'),\n  JWT_REFRESH_EXPIRES_IN: z.string().default('7d'),\n\n  // AI Providers (optional)\n  ANTHROPIC_API_KEY: z.string().optional(),\n  OPENAI_API_KEY: z.string().optional(),\n  OLLAMA_BASE_URL: z.string().default('http://localhost:11434'),\n\n  // Blockchain (optional)\n  COVALENT_API_KEY: z.string().optional(),\n  COINGECKO_API_KEY: z.string().optional(),\n\n  // Verifactu (optional)\n  VERIFACTU_ENV: z.enum(['test', 'production']).default('test'),\n  VERIFACTU_CERTIFICATE_PATH: z.string().optional(),\n  VERIFACTU_CERTIFICATE_PASSWORD: z.string().optional(),\n\n  // Rate Limiting\n  RATE_LIMIT_TTL: z.string().transform(Number).default('60000'),\n  RATE_LIMIT_MAX: z.string().transform(Number).default('100'),\n\n  // Feature Flags\n  FEATURE_VERIFACTU_ENABLED: z\n    .string()\n    .transform((v) => v === 'true')\n    .default('false'),\n  FEATURE_AI_ENABLED: z\n    .string()\n    .transform((v) => v !== 'false')\n    .default('true'),\n  FEATURE_CRYPTO_ENABLED: z\n    .string()\n    .transform((v) => v !== 'false')\n    .default('true'),\n});\n\nexport type EnvConfig = z.infer<typeof envSchema>;\n\n/**\n * Validate environment variables at startup.\n * Throws if validation fails with descriptive error messages.\n */\nexport function validateEnv(\n  config: Record<string, unknown>,\n): Record<string, unknown> {\n  const result = envSchema.safeParse(config);\n\n  if (!result.success) {\n    const errors = result.error.errors\n      .map((e) => `  - ${e.path.join('.')}: ${e.message}`)\n      .join('\\n');\n\n    throw new Error(`Environment validation failed:\\n${errors}`);\n  }\n\n  return result.data;\n}"],"names":["envSchema","validateEnv","z","object","NODE_ENV","enum","default","PORT","string","transform","Number","FRONTEND_URL","url","DATABASE_URL","min","REDIS_URL","JWT_SECRET","JWT_REFRESH_SECRET","JWT_ACCESS_EXPIRES_IN","JWT_REFRESH_EXPIRES_IN","ANTHROPIC_API_KEY","optional","OPENAI_API_KEY","OLLAMA_BASE_URL","COVALENT_API_KEY","COINGECKO_API_KEY","VERIFACTU_ENV","VERIFACTU_CERTIFICATE_PATH","VERIFACTU_CERTIFICATE_PASSWORD","RATE_LIMIT_TTL","RATE_LIMIT_MAX","FEATURE_VERIFACTU_ENABLED","v","FEATURE_AI_ENABLED","FEATURE_CRYPTO_ENABLED","config","result","safeParse","success","errors","error","map","e","path","join","message","Error","data"],"mappings":";;;;;;;;;;;QAKaA;eAAAA;;QA2DGC;eAAAA;;;qBAhEE;AAKX,MAAMD,YAAYE,MAAC,CAACC,MAAM,CAAC;IAChC,cAAc;IACdC,UAAUF,MAAC,CACRG,IAAI,CAAC;QAAC;QAAe;QAAc;KAAO,EAC1CC,OAAO,CAAC;IACXC,MAAML,MAAC,CAACM,MAAM,GAAGC,SAAS,CAACC,QAAQJ,OAAO,CAAC;IAC3CK,cAAcT,MAAC,CAACM,MAAM,GAAGI,GAAG,GAAGN,OAAO,CAAC;IAEvC,sBAAsB;IACtBO,cAAcX,MAAC,CAACM,MAAM,GAAGM,GAAG,CAAC,GAAG;IAEhC,QAAQ;IACRC,WAAWb,MAAC,CAACM,MAAM,GAAGF,OAAO,CAAC;IAE9B,+BAA+B;IAC/BU,YAAYd,MAAC,CAACM,MAAM,GAAGM,GAAG,CAAC;IAC3BG,oBAAoBf,MAAC,CAACM,MAAM,GAAGM,GAAG,CAAC;IACnCI,uBAAuBhB,MAAC,CAACM,MAAM,GAAGF,OAAO,CAAC;IAC1Ca,wBAAwBjB,MAAC,CAACM,MAAM,GAAGF,OAAO,CAAC;IAE3C,0BAA0B;IAC1Bc,mBAAmBlB,MAAC,CAACM,MAAM,GAAGa,QAAQ;IACtCC,gBAAgBpB,MAAC,CAACM,MAAM,GAAGa,QAAQ;IACnCE,iBAAiBrB,MAAC,CAACM,MAAM,GAAGF,OAAO,CAAC;IAEpC,wBAAwB;IACxBkB,kBAAkBtB,MAAC,CAACM,MAAM,GAAGa,QAAQ;IACrCI,mBAAmBvB,MAAC,CAACM,MAAM,GAAGa,QAAQ;IAEtC,uBAAuB;IACvBK,eAAexB,MAAC,CAACG,IAAI,CAAC;QAAC;QAAQ;KAAa,EAAEC,OAAO,CAAC;IACtDqB,4BAA4BzB,MAAC,CAACM,MAAM,GAAGa,QAAQ;IAC/CO,gCAAgC1B,MAAC,CAACM,MAAM,GAAGa,QAAQ;IAEnD,gBAAgB;IAChBQ,gBAAgB3B,MAAC,CAACM,MAAM,GAAGC,SAAS,CAACC,QAAQJ,OAAO,CAAC;IACrDwB,gBAAgB5B,MAAC,CAACM,MAAM,GAAGC,SAAS,CAACC,QAAQJ,OAAO,CAAC;IAErD,gBAAgB;IAChByB,2BAA2B7B,MAAC,CACzBM,MAAM,GACNC,SAAS,CAAC,CAACuB,IAAMA,MAAM,QACvB1B,OAAO,CAAC;IACX2B,oBAAoB/B,MAAC,CAClBM,MAAM,GACNC,SAAS,CAAC,CAACuB,IAAMA,MAAM,SACvB1B,OAAO,CAAC;IACX4B,wBAAwBhC,MAAC,CACtBM,MAAM,GACNC,SAAS,CAAC,CAACuB,IAAMA,MAAM,SACvB1B,OAAO,CAAC;AACb;AAQO,SAASL,YACdkC,MAA+B;IAE/B,MAAMC,SAASpC,UAAUqC,SAAS,CAACF;IAEnC,IAAI,CAACC,OAAOE,OAAO,EAAE;QACnB,MAAMC,SAASH,OAAOI,KAAK,CAACD,MAAM,CAC/BE,GAAG,CAAC,CAACC,IAAM,CAAC,IAAI,EAAEA,EAAEC,IAAI,CAACC,IAAI,CAAC,KAAK,EAAE,EAAEF,EAAEG,OAAO,EAAE,EAClDD,IAAI,CAAC;QAER,MAAM,IAAIE,MAAM,CAAC,gCAAgC,EAAEP,QAAQ;IAC7D;IAEA,OAAOH,OAAOW,IAAI;AACpB"}